<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />

    

    

    <title>Category: backend | Vince的學習筆記</title>
    <meta name="author" content="Vince Lo" />
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />

    
    <link rel="alternate" href="/atom.xml" title="Vince的學習筆記" type="application/atom+xml">
    
    
    <link rel="icon" href="/images/favicon.ico">
    

    <style type="text/css">
    @font-face {
        font-family: 'icomoon';
        src: url("/fonts/icomoon.eot?q628ml");
        src: url("/fonts/icomoon.eot?q628ml#iefix") format('embedded-opentype'),
             url("/fonts/icomoon.ttf?q628ml") format('truetype'),
             url("/fonts/icomoon.woff?q628ml") format('woff'),
             url("/fonts/icomoon.svg?q628ml#icomoon") format('svg');
        font-weight: normal;
        font-style: normal;
    }
    </style>
    
<link rel="stylesheet" href="/css/style.css">


    <!--[if lt IE 9]>
    <style type="text/css">
    .nav-inner {top:0;}
    .author-meta {position:static;top:0;}
    .search-form {height:36px;}
    </style>
    <script type="text/javascript" src="https://unpkg.com/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
    <![endif]-->
<meta name="generator" content="Hexo 4.2.0"></head>
<body>

    <main class="app">
        <header id="header" class="header clearfix">
    <div id="nav" class="nav">
    <div class="nav-mobile">
        <button id="open-panel" class="open-panel nav-mobile-item"><i class="icon-documents"></i></button>
        <h1 class="nav-mobile-title nav-mobile-item">Vince的學習筆記</h1>
        <button id="open-menus" class="open-panel nav-mobile-item"><i class="icon-library"></i></button>
    </div>

    <nav id="nav-inner" class="nav-inner">
        
            <a class="nav-item" href="/">
                <span class="nav-text">首頁</span>
            </a>
        
            <a class="nav-item" href="/categories/design">
                <span class="nav-text">設計</span>
            </a>
        
            <a class="nav-item" href="/categories/frontend">
                <span class="nav-text">前端</span>
            </a>
        
            <a class="nav-item active" href="/categories/backend">
                <span class="nav-text">後端</span>
            </a>
        
            <a class="nav-item" href="/tags">
                <span class="nav-text">標籤</span>
            </a>
        
            <a class="nav-item" href="/archives">
                <span class="nav-text">歸檔</span>
            </a>
        
            <a class="nav-item" href="/about">
                <span class="nav-text">關於</span>
            </a>
        
    </nav>
</div>

    <aside id="aside" class="aside">
    <div id="aside-mask" class="aside-mask"></div>
    <div id="aside-inner" class="aside-inner">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"><i class="icon-search-stroke"></i></button><input type="hidden" name="sitesearch" value="http://vince115.github.io"></form>

        
        

        
        <div class="author-meta">
            
            <div class="author-avatar">
                <a href="/">
                    <img src="/images/avatar.png" title="Vince Lo">
                </a>
            </div>
            
            <div class="author-name">Vince Lo</div>
            <div class="author-work">Designer &amp; Developer</div>
            <div class="author-location">
                <i class="icon-location vm"></i>
                <span class="vm">Taipei, Taiwan</span>
            </div>
            
            <div class="author-thread-wrap">
                <div class="author-threads clearfix">
                    
                        <a class="thread-item" href="https://github.com/vince115" target="_blank" rel="noopener">
                            <?xml version="1.0" encoding="iso-8859-1"?>
<!-- Generator: Adobe Illustrator 16.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="438.549px" height="438.549px" viewBox="0 0 438.549 438.549" style="enable-background:new 0 0 438.549 438.549;"
	 xml:space="preserve">
<g>
	<path d="M409.132,114.573c-19.608-33.596-46.205-60.194-79.798-79.8C295.736,15.166,259.057,5.365,219.271,5.365
		c-39.781,0-76.472,9.804-110.063,29.408c-33.596,19.605-60.192,46.204-79.8,79.8C9.803,148.168,0,184.854,0,224.63
		c0,47.78,13.94,90.745,41.827,128.906c27.884,38.164,63.906,64.572,108.063,79.227c5.14,0.954,8.945,0.283,11.419-1.996
		c2.475-2.282,3.711-5.14,3.711-8.562c0-0.571-0.049-5.708-0.144-15.417c-0.098-9.709-0.144-18.179-0.144-25.406l-6.567,1.136
		c-4.187,0.767-9.469,1.092-15.846,1c-6.374-0.089-12.991-0.757-19.842-1.999c-6.854-1.231-13.229-4.086-19.13-8.559
		c-5.898-4.473-10.085-10.328-12.56-17.556l-2.855-6.57c-1.903-4.374-4.899-9.233-8.992-14.559
		c-4.093-5.331-8.232-8.945-12.419-10.848l-1.999-1.431c-1.332-0.951-2.568-2.098-3.711-3.429c-1.142-1.331-1.997-2.663-2.568-3.997
		c-0.572-1.335-0.098-2.43,1.427-3.289c1.525-0.859,4.281-1.276,8.28-1.276l5.708,0.853c3.807,0.763,8.516,3.042,14.133,6.851
		c5.614,3.806,10.229,8.754,13.846,14.842c4.38,7.806,9.657,13.754,15.846,17.847c6.184,4.093,12.419,6.136,18.699,6.136
		c6.28,0,11.704-0.476,16.274-1.423c4.565-0.952,8.848-2.383,12.847-4.285c1.713-12.758,6.377-22.559,13.988-29.41
		c-10.848-1.14-20.601-2.857-29.264-5.14c-8.658-2.286-17.605-5.996-26.835-11.14c-9.235-5.137-16.896-11.516-22.985-19.126
		c-6.09-7.614-11.088-17.61-14.987-29.979c-3.901-12.374-5.852-26.648-5.852-42.826c0-23.035,7.52-42.637,22.557-58.817
		c-7.044-17.318-6.379-36.732,1.997-58.24c5.52-1.715,13.706-0.428,24.554,3.853c10.85,4.283,18.794,7.952,23.84,10.994
		c5.046,3.041,9.089,5.618,12.135,7.708c17.705-4.947,35.976-7.421,54.818-7.421s37.117,2.474,54.823,7.421l10.849-6.849
		c7.419-4.57,16.18-8.758,26.262-12.565c10.088-3.805,17.802-4.853,23.134-3.138c8.562,21.509,9.325,40.922,2.279,58.24
		c15.036,16.18,22.559,35.787,22.559,58.817c0,16.178-1.958,30.497-5.853,42.966c-3.9,12.471-8.941,22.457-15.125,29.979
		c-6.191,7.521-13.901,13.85-23.131,18.986c-9.232,5.14-18.182,8.85-26.84,11.136c-8.662,2.286-18.415,4.004-29.263,5.146
		c9.894,8.562,14.842,22.077,14.842,40.539v60.237c0,3.422,1.19,6.279,3.572,8.562c2.379,2.279,6.136,2.95,11.276,1.995
		c44.163-14.653,80.185-41.062,108.068-79.226c27.88-38.161,41.825-81.126,41.825-128.906
		C438.536,184.851,428.728,148.168,409.132,114.573z"/>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
</svg>

                        </a>
                    
                        <a class="thread-item" href="https://www.pinterest.com/vince115/" target="_blank" rel="noopener">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 0c-6.627 0-12 5.372-12 12 0 5.084 3.163 9.426 7.627 11.174-.105-.949-.2-2.405.042-3.441.218-.937 1.407-5.965 1.407-5.965s-.359-.719-.359-1.782c0-1.668.967-2.914 2.171-2.914 1.023 0 1.518.769 1.518 1.69 0 1.029-.655 2.568-.994 3.995-.283 1.194.599 2.169 1.777 2.169 2.133 0 3.772-2.249 3.772-5.495 0-2.873-2.064-4.882-5.012-4.882-3.414 0-5.418 2.561-5.418 5.207 0 1.031.397 2.138.893 2.738.098.119.112.224.083.345l-.333 1.36c-.053.22-.174.267-.402.161-1.499-.698-2.436-2.889-2.436-4.649 0-3.785 2.75-7.262 7.929-7.262 4.163 0 7.398 2.967 7.398 6.931 0 4.136-2.607 7.464-6.227 7.464-1.216 0-2.359-.631-2.75-1.378l-.748 2.853c-.271 1.043-1.002 2.35-1.492 3.146 1.124.347 2.317.535 3.554.535 6.627 0 12-5.373 12-12 0-6.628-5.373-12-12-12z" fill-rule="evenodd" clip-rule="evenodd"/></svg>
                        </a>
                    
                        <a class="thread-item" href="https://www.twitter.com/vince115tw/" target="_blank" rel="noopener">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.066 9.645c.183 4.04-2.83 8.544-8.164 8.544-1.622 0-3.131-.476-4.402-1.291 1.524.18 3.045-.244 4.252-1.189-1.256-.023-2.317-.854-2.684-1.995.451.086.895.061 1.298-.049-1.381-.278-2.335-1.522-2.304-2.853.388.215.83.344 1.301.359-1.279-.855-1.641-2.544-.889-3.835 1.416 1.738 3.533 2.881 5.92 3.001-.419-1.796.944-3.527 2.799-3.527.825 0 1.572.349 2.096.907.654-.128 1.27-.368 1.824-.697-.215.671-.67 1.233-1.263 1.589.581-.07 1.135-.224 1.649-.453-.384.578-.87 1.084-1.433 1.489z"/></svg>
                        </a>
                    
                        <a class="thread-item" href="https://www.facebook.com/vince115" target="_blank" rel="noopener">
                            <svg height="512pt" viewBox="0 0 512 512" width="512pt" xmlns="http://www.w3.org/2000/svg"><path d="m297.277344 508.667969c-2.132813.347656-4.273438.667969-6.421875.960937 2.148437-.292968 4.289062-.613281 6.421875-.960937zm0 0"/><path d="m302.398438 507.792969c-1.019532.1875-2.039063.359375-3.058594.535156 1.019531-.175781 2.039062-.347656 3.058594-.535156zm0 0"/><path d="m285.136719 510.339844c-2.496094.28125-5.007813.53125-7.527344.742187 2.519531-.210937 5.03125-.460937 7.527344-.742187zm0 0"/><path d="m290.054688 509.738281c-1.199219.160157-2.40625.308594-3.609376.449219 1.203126-.140625 2.410157-.289062 3.609376-.449219zm0 0"/><path d="m309.367188 506.410156c-.898438.191406-1.800782.382813-2.703126.566406.902344-.183593 1.804688-.375 2.703126-.566406zm0 0"/><path d="m326.664062 502.113281c-.726562.207031-1.453124.402344-2.179687.605469.726563-.203125 1.453125-.398438 2.179687-.605469zm0 0"/><path d="m321.433594 503.542969c-.789063.207031-1.582032.417969-2.375.617187.792968-.199218 1.585937-.40625 2.375-.617187zm0 0"/><path d="m314.589844 505.253906c-.835938.195313-1.679688.378906-2.523438.566406.84375-.1875 1.6875-.371093 2.523438-.566406zm0 0"/><path d="m277.527344 511.089844c-1.347656.113281-2.695313.214844-4.046875.304687 1.351562-.089843 2.699219-.191406 4.046875-.304687zm0 0"/><path d="m512 256c0-141.363281-114.636719-256-256-256s-256 114.636719-256 256 114.636719 256 256 256c1.503906 0 3-.03125 4.5-.058594v-199.285156h-55v-64.097656h55v-47.167969c0-54.703125 33.394531-84.476563 82.191406-84.476563 23.367188 0 43.453125 1.742188 49.308594 2.519532v57.171875h-33.648438c-26.546874 0-31.6875 12.617187-31.6875 31.128906v40.824219h63.476563l-8.273437 64.097656h-55.203126v189.453125c107.003907-30.675781 185.335938-129.257813 185.335938-246.109375zm0 0"/><path d="m272.914062 511.429688c-2.664062.171874-5.339843.308593-8.023437.398437 2.683594-.089844 5.359375-.226563 8.023437-.398437zm0 0"/><path d="m264.753906 511.835938c-1.414062.046874-2.832031.082031-4.25.105468 1.417969-.023437 2.835938-.058594 4.25-.105468zm0 0"/></svg>
                        </a>
                    
                        <a class="thread-item" href="https://www.linkedin.com/in/vince-lo-06a9928b/" target="_blank" rel="noopener">
                            <svg height="512pt" viewBox="0 0 512 512" width="512pt" xmlns="http://www.w3.org/2000/svg"><path d="m256 0c-141.363281 0-256 114.636719-256 256s114.636719 256 256 256 256-114.636719 256-256-114.636719-256-256-256zm-74.390625 387h-62.347656v-187.574219h62.347656zm-31.171875-213.1875h-.40625c-20.921875 0-34.453125-14.402344-34.453125-32.402344 0-18.40625 13.945313-32.410156 35.273437-32.410156 21.328126 0 34.453126 14.003906 34.859376 32.410156 0 18-13.53125 32.402344-35.273438 32.402344zm255.984375 213.1875h-62.339844v-100.347656c0-25.21875-9.027343-42.417969-31.585937-42.417969-17.222656 0-27.480469 11.601563-31.988282 22.800781-1.648437 4.007813-2.050781 9.609375-2.050781 15.214844v104.75h-62.34375s.816407-169.976562 0-187.574219h62.34375v26.558594c8.285157-12.78125 23.109375-30.960937 56.1875-30.960937 41.019531 0 71.777344 26.808593 71.777344 84.421874zm0 0"/></svg>
                        </a>
                    
                        <a class="thread-item" href="https://line.me/ti/p/n5ZevZknIM" target="_blank" rel="noopener">
                            <svg id="Bold" enable-background="new 0 0 24 24" height="512" viewBox="0 0 24 24" width="512" xmlns="http://www.w3.org/2000/svg"><path d="m12 .5c-6.615 0-12 4.398-12 9.803 0 4.841 4.27 8.897 10.035 9.668.391.083.923.26 1.058.594.12.303.079.771.038 1.087l-.164 1.026c-.045.303-.24 1.193 1.049.649 1.291-.542 6.916-4.104 9.436-7.019 1.724-1.9 2.548-3.847 2.548-6.005 0-5.405-5.385-9.803-12-9.803zm-4.697 13.017h-2.386c-.345 0-.63-.287-.63-.633v-4.801c0-.347.285-.634.63-.634.348 0 .63.287.63.634v4.167h1.756c.348 0 .629.285.629.634 0 .346-.282.633-.629.633zm2.466-.633c0 .346-.282.633-.631.633-.345 0-.627-.287-.627-.633v-4.801c0-.347.282-.634.63-.634.346 0 .628.287.628.634zm5.741 0c0 .272-.174.513-.432.6-.064.021-.133.031-.199.031-.211 0-.391-.091-.51-.252l-2.443-3.338v2.958c0 .346-.279.633-.631.633-.346 0-.626-.287-.626-.633v-4.8c0-.272.173-.513.43-.599.06-.023.136-.033.194-.033.195 0 .375.105.495.256l2.462 3.351v-2.975c0-.347.282-.634.63-.634.345 0 .63.287.63.634zm3.855-3.035c.349 0 .63.287.63.635 0 .347-.281.634-.63.634h-1.755v1.132h1.755c.349 0 .63.285.63.634 0 .346-.281.633-.63.633h-2.386c-.345 0-.627-.287-.627-.633v-4.801c0-.347.282-.634.63-.634h2.386c.346 0 .627.287.627.634 0 .351-.281.634-.63.634h-1.755v1.132z"/></svg>
                        </a>
                    
                </div>
            </div>
            
        </div>
        
    </div>
</aside>

</header>

        <div id="content" class="content">
            <div id="wrapper" class="wrapper" style="max-width: 800px">
                
    <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            <a href="/2020/06/29/laravel-13/">laravel-13 編寫API</a>
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="http://vince115.github.io/categories/backend/index.html">
    
    <i class="icon-calendar"></i>
    
    <time datetime="2020-06-29T08:20:10.000Z" itemprop="datePublished">2020-06-29</time>
</a>

            

        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <p>###類Rest Json API 基礎<br />
13-1 常見的REST API端點結構</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">GET /api/cats</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        id: <span class="number">1</span>,</span><br><span class="line">        name: <span class="string">'Fluffy'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        id: <span class="number">2</span>,</span><br><span class="line">        name: <span class="string">'Killer'</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line">GET /api/cats/<span class="number">2</span></span><br><span class="line">    &#123;</span><br><span class="line">        id: <span class="number">2</span>,</span><br><span class="line">        name: <span class="string">'Killer'</span></span><br><span class="line">    &#125;</span><br><span class="line">DELETE /api/cats/<span class="number">2</span></span><br><span class="line">deletes cat</span><br><span class="line">POST /api/cats with body:</span><br><span class="line">&#123;</span><br><span class="line">    name: <span class="string">'Mr Bigglesworth'</span></span><br><span class="line">&#125;</span><br><span class="line">(creates <span class="keyword">new</span> cat)</span><br><span class="line">PATCH /api/cats/<span class="number">3</span> with body:</span><br><span class="line">&#123;</span><br><span class="line">    name: <span class="string">'Mr. Bigglesworth'</span></span><br><span class="line">&#125;</span><br><span class="line">(updates cat)</span><br></pre></td></tr></table></figure>
<p>13-2 生成的資源控制器</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>\<span class="title">Api</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Requests</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>\<span class="title">Controller</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DogsController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Display a listing of the resource.</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> \Illuminate\Http\Response</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Show the form for creating a new resource.</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> \Illuminate\Http\Response</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">create</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Store a newly created resource in storage.</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> \Illuminate\Http\Request $request</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> \Illuminate\Http\Response</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">store</span><span class="params">(Request $request)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Display the specified resource.</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> int $id</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> \Illuminate\Http\Response</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span><span class="params">($id)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Show the form for editing the specified resource.</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> int $id</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> \Illuminate\Http\Response</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">edit</span><span class="params">($id)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Update the specified resource in storage.</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> \Illuminate\Http\Request $request</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> int $id</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> \Illuminate\Http\Response</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span><span class="params">(Request $request, $id)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Remove the specified resource from storage.</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> int $id</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> \Illuminate\Http\Response</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">destroy</span><span class="params">($id)</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>13-3 Dog 實例的資源控制器樣本</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DogsController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Dog::all();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">store</span><span class="params">(Request $request)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Dog::create($request-&gt;all());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span><span class="params">($id)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Dog::findOrFail($id);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span><span class="params">(Request $request, $id)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $dog = Dog::findOrFail($id);</span><br><span class="line">        $dog-&gt;update($request-&gt;all());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">destroy</span><span class="params">($id)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $dog = Dog::findOrFail($id);</span><br><span class="line">        $dog-&gt;delete();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>13-4 綁定資源控制器路由</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Routes.php</span></span><br><span class="line">Route::group([<span class="string">'prefix'</span> =&gt; <span class="string">'api'</span>, <span class="string">'namespace'</span> =&gt; <span class="string">'Api'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    Route::resource(<span class="string">'dogs'</span>, <span class="string">'DogsController'</span>);</span><br><span class="line">&#125;]);</span><br></pre></td></tr></table></figure>
<p>13-5 在Laravel中傳送回應標頭</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">'dogs'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> response(Dog::all())</span><br><span class="line">    -&gt;header(<span class="string">'X-Greatness-Index'</span>, <span class="number">9</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>13-6 在Laravel中讀取請求標頭</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">'dogs'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Request $request)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> $request-&gt;header(<span class="string">'Accept'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="eloquent-分頁"><a class="markdownIt-Anchor" href="#eloquent-分頁"></a> Eloquent 分頁</h3>
<p>13-7 分頁後的API路由</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">'dogs'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> Dog::paginate(<span class="number">20</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Laravel會根據網頁查詢參數的設定值，來得之為我們拉出哪20筆結果<br />
GET /dogs - Return results 1-20<br />
GET /dogs?page=1 - Return results 1-20<br />
GET /dogs?page=2 - Return results 21-40</p>
<p>13-8 在查詢產生器呼叫式使用paginate()方法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">'dogs'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> DB::table(<span class="string">'dogs'</span>)-&gt;paginate(<span class="number">20</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>13-9 分頁後的資料庫呼叫式的輸出範例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"total"</span>:<span class="number">50</span>,</span><br><span class="line">    <span class="string">"per_page"</span>:<span class="number">3</span>,</span><br><span class="line">    <span class="string">"current_page"</span>:<span class="number">1</span>,</span><br><span class="line">    <span class="string">"last_page"</span>: <span class="number">17</span>,</span><br><span class="line">    <span class="string">"next_page_url"</span>: <span class="string">"http://myapp.com/api/dogs?page=2"</span>,</span><br><span class="line">    <span class="string">"prev_page_url"</span>: <span class="keyword">null</span>,</span><br><span class="line">    <span class="string">"from"</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">"to"</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="string">"data"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">'name'</span>: <span class="string">'Fido'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">'name'</span>: <span class="string">'Pickles'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">'name'</span>: <span class="string">'Spot'</span></span><br><span class="line">    &#125;</span><br><span class="line"> ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="排序你的api結果"><a class="markdownIt-Anchor" href="#排序你的api結果"></a> 排序你的API結果</h3>
<p>13-10 最簡單的API排序</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">'dogs'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Request $request)</span> </span>&#123;</span><br><span class="line"><span class="comment">// Get the sort query parameter (or fall back to default sort "name")</span></span><br><span class="line">$sortCol = $request-&gt;input(<span class="string">'sort'</span>, <span class="string">'name'</span>);</span><br><span class="line"><span class="keyword">return</span> Dog::orderBy($sortCol)-&gt;paginate(<span class="number">20</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>13-11 單欄位API排序，使用方向控制</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Handles /dogs?sort=name and /dogs?sort=-name</span></span><br><span class="line">Route::get(<span class="string">'dogs'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Request $request)</span> </span>&#123;</span><br><span class="line"><span class="comment">// Get the sort query parameter (or fall back to default sort "name")</span></span><br><span class="line">$sortCol = $request-&gt;input(<span class="string">'sort'</span>, <span class="string">'name'</span>);</span><br><span class="line"><span class="comment">// Set the sort direction based on whether the key starts with -</span></span><br><span class="line"><span class="comment">// using Laravel's starts_with() helper function</span></span><br><span class="line">$sortDir = starts_with($sortCol, <span class="string">'-'</span>) ? <span class="string">'desc'</span> : <span class="string">'asc'</span>;</span><br><span class="line">$sortCol = ltrim($sort, <span class="string">'-'</span>);</span><br><span class="line"><span class="keyword">return</span> Dog::orderBy($sortCol, $sortDir)</span><br><span class="line">-&gt;paginate(<span class="number">20</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>13-12 JSON API　風格排序</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Handles ?sort=name,-weight</span></span><br><span class="line">Route::get(<span class="string">'dogs'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Request $request)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Grab the query parameter and turn it into an array exploded by ,</span></span><br><span class="line">    $sorts = explode(<span class="string">','</span>, $request-&gt;input(<span class="string">'sort'</span>, <span class="string">''</span>));</span><br><span class="line">    <span class="comment">// Create a query</span></span><br><span class="line">    $query = Dog::query();</span><br><span class="line">    <span class="comment">// Add the sorts one by one</span></span><br><span class="line">    <span class="keyword">foreach</span> ($sorts <span class="keyword">as</span> $sortCol) &#123;</span><br><span class="line">        $sortDir = starts_with($sortCol, <span class="string">'-'</span>) ? <span class="string">'desc'</span> : <span class="string">'asc'</span>;</span><br><span class="line">        $sortCol = ltrim($sort, <span class="string">'-'</span>);</span><br><span class="line">        $query-&gt;orderBy($sortCol, $sortDir);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Return</span></span><br><span class="line">    <span class="keyword">return</span> $query-&gt;paginate(<span class="number">20</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="篩選你的api結果"><a class="markdownIt-Anchor" href="#篩選你的api結果"></a> 篩選你的API結果</h3>
<p>13-13 對 API 結果使用單個filter</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">'dogs'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Request $request)</span> </span>&#123;</span><br><span class="line">    $query = Dog::query();</span><br><span class="line">    <span class="keyword">if</span> ($request-&gt;has(<span class="string">'filter'</span>)) &#123;</span><br><span class="line">        <span class="keyword">list</span>($criteria, $value) = explode(<span class="string">':'</span>, $request-&gt;input(<span class="string">'filter'</span>));</span><br><span class="line">        $query-&gt;where($criteria, $value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $query-&gt;paginate(<span class="number">20</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>13-14 對 API 結果使用多個filter</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">'dogs'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Request $request)</span> </span>&#123;</span><br><span class="line">    $query = Dog::query();</span><br><span class="line">    <span class="keyword">if</span> ($request-&gt;has(<span class="string">'filter'</span>)) &#123;</span><br><span class="line">        $filters = explode(<span class="string">','</span>, $request-&gt;input(<span class="string">'filter'</span>));</span><br><span class="line">        <span class="keyword">foreach</span> ($filters <span class="keyword">as</span> $filter) &#123;</span><br><span class="line">            <span class="keyword">list</span>($criteria, $value) = explode(<span class="string">':'</span>, $filter);</span><br><span class="line">            $query-&gt;where($criteria, $value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $query-&gt;paginate(<span class="number">20</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="轉換結果"><a class="markdownIt-Anchor" href="#轉換結果"></a> 轉換結果</h3>
<h4 id="編寫你自己的轉換器"><a class="markdownIt-Anchor" href="#編寫你自己的轉換器"></a> 編寫你自己的轉換器</h4>
<p>13-15 簡單的轉換器</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">'users/&#123;id&#125;'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($userId)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">new</span> UserTransformer(User::findOrFail($userId)));</span><br><span class="line">&#125;);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserTransformer</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $user;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($user)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;user = $user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">toArray</span><span class="params">()</span>   </span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">    <span class="string">'id'</span> =&gt; <span class="keyword">$this</span>-&gt;user-&gt;id,</span><br><span class="line">    <span class="string">'name'</span> =&gt; sprintf(</span><br><span class="line">        <span class="string">"%s %s"</span>,</span><br><span class="line">        <span class="keyword">$this</span>-&gt;user-&gt;first_name,</span><br><span class="line">        <span class="keyword">$this</span>-&gt;user-&gt;last_name</span><br><span class="line">    ),</span><br><span class="line">    <span class="string">'friendsCount'</span> =&gt; <span class="keyword">$this</span>-&gt;user-&gt;friends-&gt;count()</span><br><span class="line">    ];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">toJson</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> json_encode(<span class="keyword">$this</span>-&gt;toArray());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;toJson();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="嵌套與關係"><a class="markdownIt-Anchor" href="#嵌套與關係"></a> 嵌套與關係</h4>
<p>13-16 在轉換器內，允許選擇性內嵌資源</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">'users/&#123;id&#125;'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($userId, Request $request)</span> </span>&#123;</span><br><span class="line"><span class="comment">// Get the embeds query parameter and split by commas</span></span><br><span class="line">$embeds = explode(<span class="string">','</span>, $request-&gt;input(<span class="string">'embed'</span>, <span class="string">''</span>));</span><br><span class="line"><span class="comment">// Pass both user and embeds to the user transformer</span></span><br><span class="line"><span class="keyword">return</span> (<span class="keyword">new</span> UserTransformer(User::findOrFail($userId), $embeds));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserTransformer</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="keyword">protected</span> $user;</span><br><span class="line"><span class="keyword">protected</span> $embeds;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($user, $embeds = [])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;user = $user;</span><br><span class="line"><span class="keyword">$this</span>-&gt;embeds = $embeds;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">toArray</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $append = [];</span><br><span class="line">    <span class="keyword">if</span> (in_array(<span class="string">'friends'</span>, <span class="keyword">$this</span>-&gt;embeds)) &#123;</span><br><span class="line">        <span class="comment">// If you have more than one embed, you'll want to generalize this</span></span><br><span class="line">        $append[<span class="string">'friends'</span>] = <span class="keyword">$this</span>-&gt;user-&gt;friends-&gt;map(<span class="function"><span class="keyword">function</span> <span class="params">($friend)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">new</span> FriendTransformer($friend))-&gt;toArray();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> array_merge([</span><br><span class="line">    <span class="string">'id'</span> =&gt; <span class="keyword">$this</span>-&gt;user-&gt;id,</span><br><span class="line">    <span class="string">'name'</span> =&gt; sprintf(</span><br><span class="line">        <span class="string">"%s %s"</span>,</span><br><span class="line">        <span class="keyword">$this</span>-&gt;user-&gt;first_name,</span><br><span class="line">        <span class="keyword">$this</span>-&gt;user-&gt;last_name</span><br><span class="line">    )</span><br><span class="line">    ], $append);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="使用laravel-passport-來做api身分驗證"><a class="markdownIt-Anchor" href="#使用laravel-passport-來做api身分驗證"></a> 使用Laravel Passport 來做API身分驗證</h3>
<h4 id="oath-20-簡介"><a class="markdownIt-Anchor" href="#oath-20-簡介"></a> OAth 2.0 簡介</h4>
<h4 id="安裝passport"><a class="markdownIt-Anchor" href="#安裝passport"></a> 安裝Passport</h4>
<p>13-17 使用Passport auth中介層</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// routes/api.php</span></span><br><span class="line">Route::get(<span class="string">'/user'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Request $request)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $request-&gt;user();</span><br><span class="line">&#125;)-&gt;middleware(<span class="string">'auth:api'</span>);</span><br></pre></td></tr></table></figure>
<p>13-18 使用Bearer權杖來發抒簡單的API請求</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$http = <span class="keyword">new</span> GuzzleHttp\Client;</span><br><span class="line">$response = $http-&gt;request(<span class="string">'GET'</span>, <span class="string">'http://speakr.dev/api/user'</span>, [</span><br><span class="line">    <span class="string">'headers'</span> =&gt; [</span><br><span class="line">        <span class="string">'Accept'</span> =&gt; <span class="string">'application/json'</span>,</span><br><span class="line">        <span class="string">'Authorization'</span> =&gt; <span class="string">'Bearer '</span> . $accessToken,</span><br><span class="line">    ],</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>
<h4 id="passport的api"><a class="markdownIt-Anchor" href="#passport的api"></a> Passport的API</h4>
<h4 id="passport可用的授權類型"><a class="markdownIt-Anchor" href="#passport可用的授權類型"></a> Passport可用的授權類型</h4>
<p>13-19 使用密碼授權類型來發出請求</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Assuming SpaceBook is not an external app, but actually</span></span><br><span class="line"><span class="comment">// a trusted internal app... this is SpaceBook's routes/web.php</span></span><br><span class="line">Route::get(<span class="string">'speakr/password-grant-auth'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    $http = <span class="keyword">new</span> GuzzleHttp\Client;</span><br><span class="line">    $response = $http-&gt;post(<span class="string">'http://speakr.dev/oauth/token'</span>, [</span><br><span class="line">    <span class="string">'form_params'</span> =&gt; [</span><br><span class="line">        <span class="string">'grant_type'</span> =&gt; <span class="string">'password'</span>,</span><br><span class="line">        <span class="string">'client_id'</span> =&gt; config(<span class="string">'speakr.id'</span>),</span><br><span class="line">        <span class="string">'client_secret'</span> =&gt; config(<span class="string">'speakr.secret'</span>),</span><br><span class="line">        <span class="string">'username'</span> =&gt; <span class="string">'matt@mattstauffer.co'</span>,</span><br><span class="line">        <span class="string">'password'</span> =&gt; <span class="string">'my-speakr-password'</span>,</span><br><span class="line">        ],</span><br><span class="line">    ]);</span><br><span class="line">    $thisUsersTokens = json_decode((string) $response-&gt;getBody(), <span class="keyword">true</span>);</span><br><span class="line">    <span class="comment">// do stuff with the tokens</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="密碼授權"><a class="markdownIt-Anchor" href="#密碼授權"></a> 密碼授權</h4>
<h4 id="授權密碼授予"><a class="markdownIt-Anchor" href="#授權密碼授予"></a> 授權密碼授予</h4>
<p>13-20 一個取用者app將用戶轉址到OAuth伺服器</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// In SpaceBook's routes/web.php:</span></span><br><span class="line">Route::get(<span class="string">'speakr/redirect'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    $query = http_build_query([</span><br><span class="line">        <span class="string">'client_id'</span> =&gt; config(<span class="string">'speakr.id'</span>),</span><br><span class="line">        <span class="string">'redirect_uri'</span> =&gt; url(<span class="string">'speakr/callback'</span>),</span><br><span class="line">        <span class="string">'response_type'</span> =&gt; <span class="string">'code'</span>,</span><br><span class="line">    ]);</span><br><span class="line">    <span class="comment">// Builds a string like:</span></span><br><span class="line">    <span class="comment">// client_id=&#123;$client_id&#125;&amp;redirect_uri=&#123;$redirect_uri&#125;&amp;response_type=code</span></span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">'http://speakr.dev/oauth/authorize?'</span> . $query);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>13-21 我們的取用app中的授權回呼路由</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// In SpaceBook's routes/web.php:</span></span><br><span class="line">Route::get(<span class="string">'speakr/callback'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Request $request)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ($request-&gt;has(<span class="string">'error'</span>)) &#123;</span><br><span class="line">    <span class="comment">// handle error condition</span></span><br><span class="line">    &#125;</span><br><span class="line">$http = <span class="keyword">new</span> GuzzleHttp\Client;</span><br><span class="line">$response = $http-&gt;post(<span class="string">'http://speakr.dev/oauth/token'</span>, [</span><br><span class="line"><span class="string">'form_params'</span> =&gt; [</span><br><span class="line">    <span class="string">'grant_type'</span> =&gt; <span class="string">'authorization_code'</span>,</span><br><span class="line">    <span class="string">'client_id'</span> =&gt; config(<span class="string">'speakr.id'</span>),</span><br><span class="line">    <span class="string">'client_secret'</span> =&gt; config(<span class="string">'speakr.secret'</span>),</span><br><span class="line">    <span class="string">'redirect_uri'</span> =&gt; url(<span class="string">'speakr/callback'</span>),</span><br><span class="line">    <span class="string">'code'</span> =&gt; $request-&gt;code,</span><br><span class="line">    ],</span><br><span class="line">]);</span><br><span class="line">$thisUsersTokens = json_decode((string) $response-&gt;getBody(), <span class="keyword">true</span>);</span><br><span class="line"><span class="comment">// do stuff with the tokens</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="使用刷新權杖"><a class="markdownIt-Anchor" href="#使用刷新權杖"></a> 使用刷新權杖</h4>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AuthServiceProvider's boot() method</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;registerPolicies();</span><br><span class="line">    Passport::routes();</span><br><span class="line">    <span class="comment">// How long a token lasts before needing refreshing</span></span><br><span class="line">    Passport::tokensExpireIn(</span><br><span class="line">        Carbon::now()-&gt;addDays(<span class="number">15</span>)</span><br><span class="line">    );</span><br><span class="line">    <span class="comment">// How long a refresh token will last before re-auth</span></span><br><span class="line">    Passport::refreshTokensExpireIn(</span><br><span class="line">        Carbon::now()-&gt;addDays(<span class="number">30</span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// In SpaceBook's routes/web.php:</span></span><br><span class="line">Route::get(</span><br><span class="line"><span class="string">'speakr/request-refresh'</span>,</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">(Request $request)</span> </span>&#123;</span><br><span class="line">    $http = <span class="keyword">new</span> GuzzleHttp\Client;</span><br><span class="line">    $params = [</span><br><span class="line">        <span class="string">'grant_type'</span> =&gt; <span class="string">'refresh_token'</span>,</span><br><span class="line">        <span class="string">'client_id'</span> =&gt; config(<span class="string">'speakr.id'</span>),</span><br><span class="line">        <span class="string">'client_secret'</span> =&gt; config(<span class="string">'speakr.secret'</span>),</span><br><span class="line">        <span class="string">'redirect_uri'</span> =&gt; url(<span class="string">'speakr/callback'</span>),</span><br><span class="line">        <span class="string">'refresh_token'</span> =&gt; $theTokenYouSavedEarlier,</span><br><span class="line">    ];</span><br><span class="line">    $response = $http-&gt;post(</span><br><span class="line">        <span class="string">'http://speakr.dev/oauth/token'</span>,</span><br><span class="line">        [<span class="string">'form_params'</span> =&gt; $params,]</span><br><span class="line">    );</span><br><span class="line">    $thisUsersTokens = json_decode(</span><br><span class="line">        (string) $response-&gt;getBody(),</span><br><span class="line">        <span class="keyword">true</span></span><br><span class="line">    );</span><br><span class="line">    <span class="comment">// do stuff with the tokens</span></span><br><span class="line">    &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h4 id="使用刷新權杖-2"><a class="markdownIt-Anchor" href="#使用刷新權杖-2"></a> 使用刷新權杖</h4>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="個人造訪權杖"><a class="markdownIt-Anchor" href="#個人造訪權杖"></a> 個人造訪權杖</h4>
<h4 id="laravel-session-認證產生的權杖"><a class="markdownIt-Anchor" href="#laravel-session-認證產生的權杖"></a> Laravel session 認證產生的權杖</h4>
<h4 id="json-web-tokenjwt"><a class="markdownIt-Anchor" href="#json-web-tokenjwt"></a> JSON Web Token(JWT)</h4>
<p>13-22</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.ajaxSetup(&#123;</span><br><span class="line">    headers: &#123;</span><br><span class="line">    <span class="string">'X-CSRF-TOKEN'</span>: <span class="string">"&#123;&#123; csrf_token() &#125;&#125;"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="使用passwort-api與vue元件來管理用戶端與權杖"><a class="markdownIt-Anchor" href="#使用passwort-api與vue元件來管理用戶端與權杖"></a> 使用Passwort API與Vue元件來管理用戶端與權杖</h4>
<h4 id="路由"><a class="markdownIt-Anchor" href="#路由"></a> 路由</h4>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/oauth/clients (GET, POST)</span><br><span class="line">/oauth/clients/&#123;id&#125; (DELETE, PUT)</span><br><span class="line">/oauth/personal-access-tokens (GET, POST)</span><br><span class="line">/oauth/personal-access-tokens/&#123;id&#125; (DELETE)</span><br><span class="line">/oauth/scopes (GET)</span><br><span class="line">/oauth/tokens (GET)</span><br><span class="line">/oauth/tokens/&#123;id&#125; (DELETE)</span><br></pre></td></tr></table></figure>
<h4 id="vue元件"><a class="markdownIt-Anchor" href="#vue元件"></a> Vue元件</h4>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan vendor:publish --tag=passport-components</span><br></pre></td></tr></table></figure>
<p>13-23 將Passport的Vue元件匯入app.js</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="密碼範圍"><a class="markdownIt-Anchor" href="#密碼範圍"></a> 密碼範圍</h4>
<p>13-24 定義Passport範圍</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>13-25 請求身分驗證來使用特定的範圍</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>13-26 檢查一個user用來驗證的權狀是否可執行指定的動作</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>13-27 使用中介層，根據權杖範圍來限制使用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="laravel-52-api-權杖驗證"><a class="markdownIt-Anchor" href="#laravel-52-api-權杖驗證"></a> Laravel 5.2 + API 權杖驗證</h4>
<p>13-28 對路由群組套用API auth中介層</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Route::group([<span class="string">'prefix'</span> =&gt; <span class="string">'api'</span>, <span class="string">'middleware'</span> =&gt; <span class="string">'auth:api'</span>], <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">user = auth()-&gt;guard(<span class="string">'api'</span>)-&gt;user();</span><br></pre></td></tr></table></figure>
<p>13-29 常見API測試模式</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DogsApiTest</span> <span class="keyword">extends</span> <span class="title">TestCase</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">WithoutMiddleware</span>, <span class="title">DatabaseMigrations</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_it_gets_all_dogs</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;be(factory(User::class)-&gt;create());</span><br><span class="line">        $dog1 = factory(Dog::class)-&gt;create();</span><br><span class="line">        $dog2 = factory(Dog::class)-&gt;create();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">$this</span>-&gt;visit(<span class="string">'api/dogs'</span>);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;seeJson([</span><br><span class="line">            <span class="string">'name'</span> =&gt; $dog1-&gt;name</span><br><span class="line">        ]);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;seeJson([</span><br><span class="line">            <span class="string">'name'</span> =&gt; $dog2-&gt;name</span><br><span class="line">        ]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        
    </section>
</article>


    <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            <a href="/2020/06/29/laravel-12/">laravel-12 測試</a>
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="http://vince115.github.io/categories/backend/index.html">
    
    <i class="icon-calendar"></i>
    
    <time datetime="2020-06-29T06:14:25.000Z" itemprop="datePublished">2020-06-29</time>
</a>

            

        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <h3 id="測試基礎"><a class="markdownIt-Anchor" href="#測試基礎"></a> 測試基礎</h3>
<p>12-1　tests/ExampleTest.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Testing</span>\<span class="title">WithoutMiddleware</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Testing</span>\<span class="title">DatabaseMigrations</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Testing</span>\<span class="title">DatabaseTransactions</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExampleTest</span> <span class="keyword">extends</span> <span class="title">TestCase</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * A basic functional test example.</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">testBasicExample</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;visit(<span class="string">'/'</span>)</span><br><span class="line">        -&gt;see(<span class="string">'Laravel'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>12-2 ExampleTest輸出範例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PHPUnit <span class="number">5.5</span><span class="number">.2</span> by Sebastian Bergmann <span class="keyword">and</span> contributors.</span><br><span class="line">.</span><br><span class="line">Time: <span class="number">139</span> ms, Memory: <span class="number">12.00</span>Mb</span><br><span class="line">OK (<span class="number">1</span> test, <span class="number">2</span> assertions)</span><br></pre></td></tr></table></figure>
<p>12-3 test/ExampleTest.php 編輯為失敗</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">testBasicExample</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;visit(<span class="string">'/'</span>)</span><br><span class="line">    -&gt;see(<span class="string">'Applesauce'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>12-4 ExampleTest 失敗輸出範例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">PHPUnit <span class="number">5.5</span><span class="number">.2</span> by Sebastian Bergmann <span class="keyword">and</span> contributors.</span><br><span class="line">F</span><br><span class="line">Time: <span class="number">115</span> ms, Memory: <span class="number">12.00</span>Mb</span><br><span class="line">There was <span class="number">1</span> failure:</span><br><span class="line"><span class="number">1</span>) ExampleTest::testBasicExample</span><br><span class="line">&lt;source of page here&gt;</span><br><span class="line">Failed asserting that the page contains the HTML [Applesauce].</span><br><span class="line">Please check the content above.</span><br><span class="line">/path-to-your-app/vendor/.../Foundation/Testing/Constraints/PageConstraint.php:<span class="number">90</span></span><br><span class="line">/path-to-your-app/vendor/.../Foundation/Testing/Concerns/InteractsWithPages.php:<span class="number">271</span></span><br><span class="line">/path-to-your-app/vendor/.../Foundation/Testing/Concerns/InteractsWithPages.php:<span class="number">287</span></span><br><span class="line">/path-to-your-app/tests/ExampleTest.php:<span class="number">21</span></span><br><span class="line">FAILURES!</span><br><span class="line">Tests: <span class="number">1</span>, Assertions: <span class="number">2</span>, Failures: <span class="number">1.</span></span><br></pre></td></tr></table></figure>
<h4 id="json-測試範例"><a class="markdownIt-Anchor" href="#json-測試範例"></a> JSON 測試範例</h4>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_people_list_shows_person_after_creation</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;json(<span class="string">'post'</span>, <span class="string">'people'</span>, [<span class="string">'name'</span> =&gt; <span class="string">'matt'</span>]);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;json(<span class="string">'get'</span>, <span class="string">'people'</span>);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;seeJson([<span class="string">'name'</span> =&gt; <span class="string">'matt'</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>12-5 命名PHPUnit方法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Naming</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_it_names_things_well</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    <span class="comment">// Runs as "test it names things well"  </span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">testItNamesThingsWell</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    <span class="comment">// Runs as "It names things well"</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/** <span class="doctag">@test</span> */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">it_names_things_well</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    <span class="comment">// Runs as "it names things well"</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">it_names_things_well</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    <span class="comment">// Doesn't run</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="測試環境"><a class="markdownIt-Anchor" href="#測試環境"></a> 測試環境</h3>
<h3 id="測試特徵"><a class="markdownIt-Anchor" href="#測試特徵"></a> 測試特徵</h3>
<p>WithoutMiddleware<br />
DatabaseMigrations<br />
DatabaseTransactions</p>
<h3 id="應用測試"><a class="markdownIt-Anchor" href="#應用測試"></a> 應用測試</h3>
<h3 id="testcase"><a class="markdownIt-Anchor" href="#testcase"></a> TestCase</h3>
<h3 id="造訪路由"><a class="markdownIt-Anchor" href="#造訪路由"></a> &quot;造訪&quot;路由</h3>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">$this</span>-&gt;vist($uri)</span><br><span class="line"></span><br><span class="line"><span class="keyword">$this</span>-&gt;call($method, $uri, $params = [], $cookies = [], $files = [], $server = [],</span><br><span class="line">$content = <span class="keyword">null</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">$this</span>-&gt;get($uri, $headers = []), -&gt;post($uri, $data = [], $headers = []),</span><br><span class="line">-&gt;put($uri, $data = [], $headers = []), -&gt;patch(), <span class="keyword">and</span> -&gt;delete()</span><br><span class="line"></span><br><span class="line"><span class="keyword">$this</span>-&gt;json($method, $uri, $data = [], $headers = [])</span><br><span class="line"></span><br><span class="line"><span class="keyword">$this</span>-&gt;followRedirects()</span><br></pre></td></tr></table></figure>
<p>###自訂應用測試判斷式</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">$this</span>-&gt;assertPageLoaded()</span><br><span class="line"></span><br><span class="line"><span class="keyword">$this</span>-&gt;see() <span class="keyword">and</span> -&gt;dontSee()</span><br><span class="line"></span><br><span class="line"><span class="keyword">$this</span>-&gt;seeHeader()</span><br><span class="line"></span><br><span class="line"><span class="keyword">$this</span>-&gt;seeCookie()</span><br><span class="line"></span><br><span class="line"><span class="keyword">$this</span>-&gt;seeInField() <span class="keyword">and</span> -&gt;dontSeeInField()</span><br><span class="line"></span><br><span class="line"><span class="keyword">$this</span>-&gt;seeIsChecked() <span class="keyword">and</span> -&gt;dontSeeIsChecked()</span><br><span class="line"></span><br><span class="line"><span class="keyword">$this</span>-&gt;seeIsSelected() <span class="keyword">and</span> -&gt;dontSeeIsSelected()</span><br><span class="line"></span><br><span class="line"><span class="keyword">$this</span>-&gt;seePageIs()</span><br><span class="line"></span><br><span class="line"><span class="keyword">$this</span>-&gt;seeInDatabase() <span class="keyword">and</span> -&gt;dontSeeInDatabase()</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_database_has_user_after_registration</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span></span><br><span class="line">        -&gt;visit(<span class="string">'register'</span>)</span><br><span class="line">        -&gt;fillForm([</span><br><span class="line">            <span class="string">'email'</span> =&gt; <span class="string">'matt@mattstauffer.co'</span></span><br><span class="line">        ])</span><br><span class="line">        -&gt;submitForm();</span><br><span class="line">    <span class="keyword">$this</span>-&gt;seeInDatabase(<span class="string">'emails'</span>, [<span class="string">'email'</span> =&gt; <span class="string">'matt@mattstauffer.co'</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="json與非visit應用測試判斷式"><a class="markdownIt-Anchor" href="#json與非visit應用測試判斷式"></a> JSON與非visit()應用測試判斷式</h3>
<p>$this-&gt;seeJson(), -&gt;dontSeeJson(), -&gt;seeJsonEquals()</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_api_returns_certain_json</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;json(<span class="string">'get'</span>, <span class="string">'users'</span>);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;seeJson([<span class="string">'username'</span> =&gt; <span class="string">'mattstauffer'</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi><mi>h</mi><mi>i</mi><mi>s</mi><mo>−</mo><mo>&gt;</mo><mi>a</mi><mi>s</mi><mi>s</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>R</mi><mi>e</mi><mi>s</mi><mi>p</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>e</mi><mi>O</mi><mi>K</mi><mo stretchy="false">(</mo><mo stretchy="false">)</mo><mi>a</mi><mi>n</mi><mi>d</mi><mo>−</mo><mo>&gt;</mo><mi>a</mi><mi>s</mi><mi>s</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>R</mi><mi>e</mi><mi>s</mi><mi>p</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>e</mi><mi>S</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>u</mi><mi>s</mi><mo stretchy="false">(</mo></mrow><annotation encoding="application/x-tex">this-&gt;assertResponseOK() and -&gt;assertResponseStatus(</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mord">−</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">a</span><span class="mord mathdefault">s</span><span class="mord mathdefault">s</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault">e</span><span class="mord mathdefault">s</span><span class="mord mathdefault">p</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mord mathdefault">s</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class="mopen">(</span><span class="mclose">)</span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span><span class="mord mathdefault">d</span><span class="mord">−</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">a</span><span class="mord mathdefault">s</span><span class="mord mathdefault">s</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault">e</span><span class="mord mathdefault">s</span><span class="mord mathdefault">p</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mord mathdefault">s</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault">t</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">u</span><span class="mord mathdefault">s</span><span class="mopen">(</span></span></span></span>status)</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_pages_load_the_way_we_want</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;get(<span class="string">'people'</span>);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;assertResponseOK();</span><br><span class="line">    <span class="keyword">$this</span>-&gt;call(<span class="string">'post'</span>, <span class="string">'owners'</span>);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;assertResponseStatus(<span class="number">405</span>); <span class="comment">// Method not allowed</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi><mi>h</mi><mi>i</mi><mi>s</mi><mo>−</mo><mo>&gt;</mo><mi>a</mi><mi>s</mi><mi>s</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>V</mi><mi>i</mi><mi>e</mi><mi>w</mi><mi>H</mi><mi>a</mi><mi>s</mi><mo stretchy="false">(</mo></mrow><annotation encoding="application/x-tex">this-&gt;assertViewHas(</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mord">−</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">a</span><span class="mord mathdefault">s</span><span class="mord mathdefault">s</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mord mathdefault">i</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="mord mathdefault">a</span><span class="mord mathdefault">s</span><span class="mopen">(</span></span></span></span>key, $value = null), -&gt;assertViewHasAll(array <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>b</mi><mi>i</mi><mi>n</mi><mi>d</mi><mi>i</mi><mi>n</mi><mi>g</mi><mi>s</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mo>−</mo><mo>&gt;</mo><mi>a</mi><mi>s</mi><mi>s</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>V</mi><mi>i</mi><mi>e</mi><mi>w</mi><mi>M</mi><mi>i</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>n</mi><mi>g</mi><mo stretchy="false">(</mo></mrow><annotation encoding="application/x-tex">bindings), -&gt;assertViewMissing(</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">b</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault">d</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord mathdefault">s</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">−</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">a</span><span class="mord mathdefault">s</span><span class="mord mathdefault">s</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mord mathdefault">i</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mopen">(</span></span></span></span>key)</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Route</span></span><br><span class="line">Route::get(<span class="string">'test'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> view(<span class="string">'test'</span>)-&gt;with(<span class="string">'foo'</span>, <span class="string">'bar'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_view_gets_data</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;get(<span class="string">'test'</span>);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;assertViewHas(<span class="string">'foo'</span>); <span class="comment">// true</span></span><br><span class="line">    <span class="keyword">$this</span>-&gt;assertViewHas(<span class="string">'foo'</span>, <span class="string">'bar'</span>); <span class="comment">// true</span></span><br><span class="line">    <span class="keyword">$this</span>-&gt;assertViewHas(<span class="string">'foo'</span>, <span class="string">'baz'</span>); <span class="comment">// false</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Route</span></span><br><span class="line">Route::get(<span class="string">'test'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> view(<span class="string">'test'</span>)</span><br><span class="line">    -&gt;with(<span class="string">'foo'</span>, <span class="string">'bar'</span>)</span><br><span class="line">    -&gt;with(<span class="string">'baz'</span>, <span class="string">'qux'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_view_gets_data</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;get(<span class="string">'test'</span>);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;assertViewHasAll([</span><br><span class="line">        <span class="string">'foo'</span> =&gt; <span class="string">'bar'</span>,</span><br><span class="line">        <span class="string">'baz'</span> =&gt; <span class="string">'qux'</span></span><br><span class="line">    ]); <span class="comment">// true</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//In Laravel 5.3</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_events_are_owned_by_user_1</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;get(<span class="string">'events'</span>);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;assertViewHas(<span class="string">'events'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($events)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $events-&gt;reject(<span class="function"><span class="keyword">function</span> <span class="params">($event)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> $event-&gt;user_id === <span class="number">1</span>;</span><br><span class="line">        &#125;)-&gt;isEmpty();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>$this-&gt;assertRedirectedTo(), -&gt;assertRedirectedToRoute(), -&gt;assertRedirectedToAction()</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Route</span></span><br><span class="line">Route::get(<span class="string">'redirector'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">'/'</span>);</span><br><span class="line">&#125;);</span><br><span class="line">Route::get(<span class="string">'/'</span>, <span class="string">'HomeController@index'</span>)-&gt;name(<span class="string">'home'</span>);</span><br><span class="line"><span class="comment">// Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_redirector_works</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;get(<span class="string">'redirector'</span>);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;assertRedirectedTo(<span class="string">'/'</span>);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;assertRedirectedToRoute(<span class="string">'home'</span>);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;assertRedirectedToAction(<span class="string">'HomeController@index'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi><mi>h</mi><mi>i</mi><mi>s</mi><mo>−</mo><mo>&gt;</mo><mi>a</mi><mi>s</mi><mi>s</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>S</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>H</mi><mi>a</mi><mi>s</mi><mo stretchy="false">(</mo></mrow><annotation encoding="application/x-tex">this-&gt;assertSessionHas(</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mord">−</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">a</span><span class="mord mathdefault">s</span><span class="mord mathdefault">s</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault">e</span><span class="mord mathdefault">s</span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="mord mathdefault">a</span><span class="mord mathdefault">s</span><span class="mopen">(</span></span></span></span>key, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>v</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><msup><mo>=</mo><mrow><mo mathvariant="normal">′</mo><mo mathvariant="normal">′</mo></mrow></msup><mo stretchy="false">)</mo><mo separator="true">,</mo><mo>−</mo><mo>&gt;</mo><mi>a</mi><mi>s</mi><mi>s</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>S</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>H</mi><mi>a</mi><mi>s</mi><mi>A</mi><mi>l</mi><mi>l</mi><mo stretchy="false">(</mo></mrow><annotation encoding="application/x-tex">value = &#x27;&#x27;),
-&gt;assertSessionHasAll(</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">u</span><span class="mord mathdefault">e</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel"><span class="mrel">=</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">−</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">a</span><span class="mord mathdefault">s</span><span class="mord mathdefault">s</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault">e</span><span class="mord mathdefault">s</span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="mord mathdefault">a</span><span class="mord mathdefault">s</span><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mopen">(</span></span></span></span>bindings), -&gt;assertSessionHasErrors(<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>b</mi><mi>i</mi><mi>n</mi><mi>d</mi><mi>i</mi><mi>n</mi><mi>g</mi><mi>s</mi><mo>=</mo><mo stretchy="false">[</mo><mo stretchy="false">]</mo><mo separator="true">,</mo></mrow><annotation encoding="application/x-tex">bindings = [],
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">b</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault">d</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mclose">]</span><span class="mpunct">,</span></span></span></span>format = null), -&gt;assertHasOldInput()</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_session_has_stuff</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Session::put(<span class="string">'foo'</span>, <span class="string">'bar'</span>);</span><br><span class="line">    Session::put(<span class="string">'baz'</span>, <span class="string">'qux'</span>);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;assertSessionHas(<span class="string">'foo'</span>);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;assertSessionHas(<span class="string">'foo'</span>, <span class="string">'bar'</span>);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;assertSessionHasAll([</span><br><span class="line">        <span class="string">'foo'</span> =&gt; <span class="string">'bar'</span>,</span><br><span class="line">        <span class="string">'baz'</span> =&gt; <span class="string">'qux'</span></span><br><span class="line">    ]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_posting_empty_errors_out</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// assuming the "/form" route requires an email field, and we're</span></span><br><span class="line">    <span class="comment">// posting an empty form to it to trigger the error</span></span><br><span class="line">    <span class="keyword">$this</span>-&gt;post(<span class="string">'form'</span>, []);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;assertSessionHasErrors();</span><br><span class="line">    <span class="keyword">$this</span>-&gt;assertSessionHasErrors([<span class="string">'email'</span> =&gt; <span class="string">'The email field is required.'</span>]);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;assertSessionHasErrors(</span><br><span class="line">        [<span class="string">'email'</span> =&gt; <span class="string">'&lt;p&gt;The email field is required.&lt;/p&gt;'</span>],</span><br><span class="line">        <span class="string">'&lt;p&gt;:message&lt;/p&gt;'</span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="點擊與表單"><a class="markdownIt-Anchor" href="#點擊與表單"></a> 點擊與表單</h3>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">$this</span>-&gt;click($name);</span><br><span class="line"></span><br><span class="line"><span class="keyword">$this</span>-&gt;type($text, $element)</span><br><span class="line"></span><br><span class="line"><span class="keyword">$this</span>-&gt;check($element)</span><br><span class="line"></span><br><span class="line"><span class="keyword">$this</span>-&gt;uncheck($element)</span><br><span class="line"></span><br><span class="line"><span class="keyword">$this</span>-&gt;select($option, $element)</span><br><span class="line"></span><br><span class="line"><span class="keyword">$this</span>-&gt;attach($filePath, $element)</span><br><span class="line"></span><br><span class="line"><span class="keyword">$this</span>-&gt;press($buttonText)</span><br><span class="line"></span><br><span class="line"><span class="keyword">$this</span>-&gt;submitForm($buttonText, $inputs = [], $uploads = [])</span><br><span class="line"></span><br><span class="line"><span class="keyword">$this</span>-&gt;fillForm($buttonText, $inputs = [])</span><br><span class="line"></span><br><span class="line"><span class="keyword">$this</span>-&gt;clearInputs()</span><br></pre></td></tr></table></figure>
<h3 id="工作與事件"><a class="markdownIt-Anchor" href="#工作與事件"></a> 工作與事件</h3>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi><mi>h</mi><mi>i</mi><mi>s</mi><mo>−</mo><mo>&gt;</mo><mi>e</mi><mi>x</mi><mi>p</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>s</mi><mi>E</mi><mi>v</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>s</mi><mo stretchy="false">(</mo></mrow><annotation encoding="application/x-tex">this-&gt;expectsEvents(</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mord">−</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">e</span><span class="mord mathdefault">x</span><span class="mord mathdefault">p</span><span class="mord mathdefault">e</span><span class="mord mathdefault">c</span><span class="mord mathdefault">t</span><span class="mord mathdefault">s</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mord mathdefault">e</span><span class="mord mathdefault">n</span><span class="mord mathdefault">t</span><span class="mord mathdefault">s</span><span class="mopen">(</span></span></span></span>eventClassName)</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_usersubscribed_event_fires_when_subscribing</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;expectsEvents(App\Events\UserSubscribed::class);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;visit(<span class="string">'subscribe'</span>)-&gt;type(<span class="string">'me@me.com'</span>, <span class="string">'email'</span>)-&gt;press(<span class="string">'Subscribe'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi><mi>h</mi><mi>i</mi><mi>s</mi><mo>−</mo><mo>&gt;</mo><mi>w</mi><mi>i</mi><mi>t</mi><mi>h</mi><mi>o</mi><mi>u</mi><mi>t</mi><mi>E</mi><mi>v</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>s</mi><mo stretchy="false">(</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">this-&gt;withoutEvents()
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mord">−</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord mathdefault">i</span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault">o</span><span class="mord mathdefault">u</span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mord mathdefault">e</span><span class="mord mathdefault">n</span><span class="mord mathdefault">t</span><span class="mord mathdefault">s</span><span class="mopen">(</span><span class="mclose">)</span></span></span></span>this-&gt;expectsJobs()</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_number_of_subscriptions_crunches_reports</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;expectsJobs(App\Jobs\CrunchReports::class);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;visit(<span class="string">'subscribe'</span>)-&gt;type(<span class="string">'me@me.com'</span>, <span class="string">'email'</span>)-&gt;press(<span class="string">'Subscribe'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="身分驗證與session"><a class="markdownIt-Anchor" href="#身分驗證與session"></a> 身分驗證與session</h3>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">$this</span>-&gt;session([<span class="string">'key'</span> =&gt; <span class="string">'value'</span>])</span><br><span class="line"><span class="keyword">$this</span>-&gt;flushSession()</span><br><span class="line"><span class="keyword">$this</span>-&gt;be($authenticatable)</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_members_cant_see_admin_dashboard</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $member = factory(\App\User::class, <span class="string">'member'</span>)-&gt;create();</span><br><span class="line">    <span class="keyword">$this</span>-&gt;be($member);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;get(<span class="string">'admin-dashboard'</span>);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;assertResponseStatus(<span class="number">403</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_admins_can_see_admin_dashboard</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $admin = factory(\App\User::class, <span class="string">'admin'</span>)-&gt;create();</span><br><span class="line">    <span class="keyword">$this</span>-&gt;be($admin);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;get(<span class="string">'admin-dashboard'</span>);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;assertResponseOK();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="artisan與種子"><a class="markdownIt-Anchor" href="#artisan與種子"></a> Artisan與種子</h3>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi><mi>h</mi><mi>i</mi><mi>s</mi><mo>−</mo><mo>&gt;</mo><mi>a</mi><mi>r</mi><mi>t</mi><mi>i</mi><mi>s</mi><mi>a</mi><mi>n</mi><mo stretchy="false">(</mo></mrow><annotation encoding="application/x-tex">this-&gt;artisan(</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mord">−</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">t</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span><span class="mopen">(</span></span></span></span>command, $parameters = [])</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_returns_certain_code</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;artisan(<span class="string">'do:thing'</span>, [<span class="string">'--flagOfSomeSort'</span> =&gt; <span class="keyword">true</span>]);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;assertEquals(<span class="number">0</span>, <span class="keyword">$this</span>-&gt;code); <span class="comment">// 0 means "no errors were returned"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi><mi>h</mi><mi>i</mi><mi>s</mi><mo>−</mo><mo>&gt;</mo><mi>s</mi><mi>e</mi><mi>e</mi><mi>d</mi><mo stretchy="false">(</mo></mrow><annotation encoding="application/x-tex">this-&gt;seed(</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mord">−</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault">e</span><span class="mord mathdefault">e</span><span class="mord mathdefault">d</span><span class="mopen">(</span></span></span></span>seederClassName = ‘DatabaseSeeder’)<br />
seed()提供功能與執行$this-&gt;artisan(‘db:seed’)相同</p>
<h3 id="模仿程式"><a class="markdownIt-Anchor" href="#模仿程式"></a> 模仿程式</h3>
<h3 id="mockery"><a class="markdownIt-Anchor" href="#mockery"></a> Mockery</h3>
<p>12-6 在Laravel中使用Mockery</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app/SlackClient.php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SlackClient</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">send</span><span class="params">($message, $channel)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// Actually sends a message to Slack</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// app/Notifier.php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Notifier</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $slack;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(SlackClient $slack)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;slack = $slack;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">notifyAdmins</span><span class="params">($message)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;slack-&gt;send($message, <span class="string">'admins'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// tests/NotifierTest.php</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_notifier_notifies_admins</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $slackMock = Mockery::mock(SlackClient::class)-&gt;shouldIgnoreMissing();</span><br><span class="line">    $notifier = <span class="keyword">new</span> Notifier($slackMock);</span><br><span class="line">    $notifier-&gt;notifyAdmins(<span class="string">'Test message'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>12-7 在Mockery模仿物中使用shouldReceive方法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_notifier_notifies_admins</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $slackMock = Mockery::mock(SlackClient::class);</span><br><span class="line">    $slackMock-&gt;shouldReceive(<span class="string">'send'</span>)-&gt;once();</span><br><span class="line">    $notifier = <span class="keyword">new</span> Notifier($slackMock);</span><br><span class="line">    $notifier-&gt;notifyAdmins(<span class="string">'Test message'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>12-8 綁定一個Mockery實例到容器</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_notifier_notifies_admins</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $slackMock = Mockery::mock(SlackClient::class);</span><br><span class="line">    $slackMock-&gt;shouldReceive(<span class="string">'send'</span>)-&gt;once();</span><br><span class="line">    app()-&gt;instance(SlackClient::class, $slackMock);</span><br><span class="line">    $notifier = app(Notifier::class);</span><br><span class="line">    $notifier-&gt;notifyAdmins(<span class="string">'Test message'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>12-9 綁定一個Mockery實例到容器</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PeopleController</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Cache::remember(<span class="string">'people'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Person::all();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// PeopleTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_all_people_route_should_be_cached</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $person = factory(Person::class)-&gt;make();</span><br><span class="line">    Cache::shouldReceive(<span class="string">'remember'</span>)</span><br><span class="line">        -&gt;once()</span><br><span class="line">        -&gt;andReturn(collect([$person]));</span><br><span class="line">    <span class="keyword">$this</span>-&gt;visit(<span class="string">'people'</span>)-&gt;seeJson([<span class="string">'name'</span> =&gt; $person-&gt;name]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>12-10 靜態介面間諜</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_queue_job_should_be_pushed_after_regisration</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Cache::spy();</span><br><span class="line">    <span class="keyword">$this</span>-&gt;post(<span class="string">'register'</span>, [<span class="string">'email'</span> =&gt; <span class="string">'joaquin@me.com'</span>]);</span><br><span class="line">    Cache::shouldHaveReceived(<span class="string">'push'</span>)</span><br><span class="line">        -&gt;with(SendWelcomeEmail::class, [<span class="string">'email'</span> =&gt; <span class="string">'joaquin@me.com'</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        
    </section>
</article>


    <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            <a href="/2020/06/29/laravel-11/">laravel-11 容器</a>
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="http://vince115.github.io/categories/backend/index.html">
    
    <i class="icon-calendar"></i>
    
    <time datetime="2020-06-29T03:14:29.000Z" itemprop="datePublished">2020-06-29</time>
</a>

            
<div class="article-tag-list">
    <i class="icon-tag"></i>
    <a class="article-tag-link" href="/tags/backend/" rel="tag">backend</a>, <a class="article-tag-link" href="/tags/laravel/" rel="tag">laravel</a>
</div>


        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <p>###相依注入簡介<br />
11-1 基本相依注入</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserMailer</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $mailer;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(Mailer $mailer)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;mailer = $mailer;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">welcome</span><span class="params">($user)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;mailer-&gt;mail($user-&gt;email, <span class="string">'Welcome!'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>###相依關係注入與Laravel<br />
11-2 簡單的手動相依關係注入</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$mailer = <span class="keyword">new</span> MailgunMailer($mailgunKey, $mailgunSecret, $mailgunOptions);</span><br><span class="line">$userMailer = <span class="keyword">new</span> UserMailer($mailer);</span><br><span class="line">$userMailer-&gt;welcome($user);</span><br></pre></td></tr></table></figure>
<p>11-3 較複雜的手動相依關係注入</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$mailer = <span class="keyword">new</span> MailgunMailer($mailgunKey, $mailgunSecret, $mailgunOptions);</span><br><span class="line">$logger = <span class="keyword">new</span> Logger($logPath, $minimumLogLevel);</span><br><span class="line">$slack = <span class="keyword">new</span> Slack($slackKey, $slackSecret, $channelName, $channelIcon);</span><br><span class="line">$userMailer = <span class="keyword">new</span> UserMailer($mailer, $logger, $slack);</span><br><span class="line">$userMailer-&gt;welcome($user);</span><br></pre></td></tr></table></figure>
<p>###app()全域輔助函式<br />
11-4 較複雜的手動相依關係注入</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bar</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Baz</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(Bar $bar, Baz $baz)</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">$foo = app(Foo::class);</span><br></pre></td></tr></table></figure>
<p>###將類別綁定容器<br />
####綁定closure<br />
11-5 基本容器綁定</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">register</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;app-&gt;bind(Logger::class, <span class="function"><span class="keyword">function</span> <span class="params">($app)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Logger(<span class="string">'\log\path\here'</span>, <span class="string">'error'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">$this</span>-&gt;app-&gt;bind(UserMailer::class, <span class="function"><span class="keyword">function</span> <span class="params">($app)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> UserMailer(</span><br><span class="line">        $app-&gt;make(Mailer::class),</span><br><span class="line">        $app-&gt;make(Logger::class),</span><br><span class="line">        $app-&gt;make(Slack::class)</span><br><span class="line">    );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>####綁定singleton、別名與實例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">register</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;app-&gt;singleton(Logger::class, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Logger(<span class="string">'\log\path\here'</span>, <span class="string">'error'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">register</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $logger = <span class="keyword">new</span> Logger(<span class="string">'\log\path\here'</span>, <span class="string">'error'</span>);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;app-&gt;instance(Logger::class, $logger);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">$this</span>-&gt;bind(Logger::class, FirstLogger::class);</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"><span class="keyword">$this</span>-&gt;bind(<span class="string">'log'</span>, FirstLogger::class);</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"><span class="keyword">$this</span>-&gt;bind(FirstLogger::class, <span class="string">'log'</span>);</span><br></pre></td></tr></table></figure>
<p>####將具體實例綁定介面<br />
11-6 型態提示與綁定至介面</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">use</span> <span class="title">Interfaces</span>\<span class="title">Mailer</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserMailer</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $mailer;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(Mailer $mailer)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;mailer = $mailer;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// service provider</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">register</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;app-&gt;bind(\Interfaces\Mailer::class, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MailgunMailer(...);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>####環境綁定<br />
11-7 環境綁定</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// In a service provider</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">register</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;app-&gt;when(FileWrangler::class)</span><br><span class="line">        -&gt;needs(Interfaces\Logger::class)</span><br><span class="line">        -&gt;give(Loggers\Syslog::class);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;app-&gt;when(Jobs\SendWelcomeEmail::class)</span><br><span class="line">        -&gt;needs(Interfaces\Logger::class)</span><br><span class="line">        -&gt;give(Loggers\PaperTrail::class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>####建構式注入<br />
11-8 將相依關係注入控制器</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $logger;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(Logger $logger)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;logger = $logger;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// Do something</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;logger-&gt;error(<span class="string">'Something happened'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>####方法注入<br />
11-9 將相依關係注入控制器</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// Method dependencies can come after or before route parameters</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span><span class="params">(Logger $logger, $id)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// Do something</span></span><br><span class="line">        $logger-&gt;error(<span class="string">'Something happened'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>11-10 使用容器的call()方法來手動呼叫一個類別方法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">bar</span><span class="params">($parameter1)</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">$foo = <span class="keyword">new</span> Foo;</span><br><span class="line"><span class="comment">// Calls the 'bar' method on $foo with a first parameter of "value"</span></span><br><span class="line">app()-&gt;call($foo, <span class="string">'bar'</span>, [<span class="string">'parameter1'</span> =&gt; <span class="string">'value'</span>]);</span><br></pre></td></tr></table></figure>
<p>###靜態介面與容器<br />
####靜態介面如如何工作方法注入<br />
11-11 Log靜態介面類別</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Facades</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Log</span> <span class="keyword">extends</span> <span class="title">facade</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getFacadeAccessor</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'log'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>服務提供者<br />
測試<br />
11-12 在測試中覆寫綁定</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_it_does_something</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    app()-&gt;bind(Interfaces\Logger, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> DevNullLogger;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// do stuff</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>11-13 為所有測試中覆寫綁定</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestCase</span> <span class="keyword">extends</span> \<span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Testing</span>\<span class="title">TestCase</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setUp</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">parent</span>::setUp();</span><br><span class="line">        app()-&gt;bind(<span class="string">'whatever'</span>, <span class="string">'whatever else'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

        
    </section>
</article>


    <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            <a href="/2020/05/07/laravel-10/">laravel-10 請求與回應</a>
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="http://vince115.github.io/categories/backend/index.html">
    
    <i class="icon-calendar"></i>
    
    <time datetime="2020-05-07T09:07:32.000Z" itemprop="datePublished">2020-05-07</time>
</a>

            
<div class="article-tag-list">
    <i class="icon-tag"></i>
    <a class="article-tag-link" href="/tags/backend/" rel="tag">backend</a>, <a class="article-tag-link" href="/tags/laravel/" rel="tag">laravel</a>
</div>


        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <p>啟動應用程式</p>
<p>Laravel的核心</p>
<p>服務提供者</p>
<p>10-1 推遲服務提供者的註冊</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GitHubServiceProvider</span> <span class="keyword">extends</span> <span class="title">ServiceProvider</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $defer = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">provides</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">            GitHubClient::class</span><br><span class="line">        ];</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>Request 物件</p>
<p>在Laravel中取得Request物件</p>
<p>10-2 在容器解析的方法中型態提示，以接收Request物件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PeopleController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">(Request $request)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $allInput = $request -&gt; all();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>也可以使用request()全域輔助函式</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$request =request();</span><br><span class="line">$allInput = $request -&gt; all();</span><br></pre></td></tr></table></figure>
<p>也可以使用app()全域方法來取得Request的實例。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$request =app(Illuminate\Http\Request::class);</span><br><span class="line">$request =app(<span class="string">'request'</span>);</span><br></pre></td></tr></table></figure>
<p>取得Request 的基本資訊</p>
<p>基本用戶輸入</p>
<p>10-3 從request取得用戶提供的基本資訊</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 表單</span></span><br><span class="line">&lt;form method=<span class="string">"POST"</span> action=<span class="string">"/form"</span>&gt;</span><br><span class="line">&#123;&#123; csrf_field() &#125;&#125;</span><br><span class="line">&lt;input name=<span class="string">"name"</span>&gt; Name&lt;br&gt;</span><br><span class="line">&lt;input type=<span class="string">"submit"</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"><span class="comment">// 接收表單的路由</span></span><br><span class="line">Route::post(<span class="string">'form'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Request $request)</span> </span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'name is '</span> . $request-&gt;input(<span class="string">'name'</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'all input is '</span> . print_r($request-&gt;all());</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'user provided email address: '</span> . $request-&gt;has(<span class="string">'email'</span>) ? <span class="string">'true'</span> : <span class="string">'false'</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>用戶與請求的狀態</p>
<p>檔案</p>
<p>持久保存</p>
<p>Response物件</p>
<h4 id="在控制器中使用與建立response物件"><a class="markdownIt-Anchor" href="#在控制器中使用與建立response物件"></a> 在控制器中使用與建立Response物件</h4>
<p>10-4 最簡單的HTTP回應</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">'route'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> Illuminate\Http\Response(<span class="string">'Hello!'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// Same, using global function:</span></span><br><span class="line">Route::get(<span class="string">'route'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> response(<span class="string">'Hello!'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>10-5 使用自訂的狀態與標頭的HTTP回應</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">'route'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> response(<span class="string">'Error!'</span>, <span class="number">400</span>)</span><br><span class="line">        -&gt;header(<span class="string">'X-Header-Name'</span>, <span class="string">'header-value'</span>)</span><br><span class="line">        -&gt;cookie(<span class="string">'cookie-name'</span>, <span class="string">'cookie-value'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>10-6 將Cookie附加到回應</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> response($content)</span><br><span class="line">-&gt;cookie(<span class="string">'signup_dismissed'</span>, <span class="keyword">true</span>);</span><br></pre></td></tr></table></figure>
<p>設定標頭</p>
<p>添加cookie</p>
<p>特殊的回應類型</p>
<p>視圖回應</p>
<p>10-7 使用view()回應類型</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(XmlGetterService $xml)</span> </span>&#123;</span><br><span class="line">$data = $xml-&gt;get();</span><br><span class="line"><span class="keyword">return</span> response()</span><br><span class="line">-&gt;view(<span class="string">'xml-structure'</span>, $data)</span><br><span class="line">-&gt;header(<span class="string">'Content-Type'</span>, <span class="string">'text/xml'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>下載回應</p>
<p>10-8 使用download()回應類型</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">export</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> response()</span><br><span class="line">-&gt;download(<span class="string">'file.csv'</span>, <span class="string">'export.csv'</span>, [<span class="string">'header'</span> =&gt; <span class="string">'value'</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">otherExport</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> response()-&gt;download(<span class="string">'file.pdf'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>檔案回應</p>
<p>10-9 使用download()回應類型</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">invoice</span><span class="params">($id)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> response()-&gt;file(<span class="string">"./invoices/&#123;$id&#125;.pdf"</span>, [<span class="string">'header'</span> =&gt; <span class="string">'value'</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>JSON回應</p>
<p>10-10 使用json()回應類型</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">contacts</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> <span class="keyword">return</span> response()-&gt;json(Contact::all());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">nonEloquentContents</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> response()-&gt;json([<span class="string">'Tom'</span>,<span class="string">'Jerry'</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>轉址回應<br />
10-11 redirect() 全域輔助函式的使用範例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> redirect(<span class="string">'account/payment'</span>);</span><br><span class="line"><span class="keyword">return</span> redirect()-&gt;to(<span class="string">'account/payment'</span>); </span><br><span class="line"><span class="keyword">return</span> redirect()-&gt;route(<span class="string">'account.payment'</span>);</span><br><span class="line"><span class="keyword">return</span> redirect()-&gt;action(<span class="string">'AccountController@showPayment'</span>);</span><br></pre></td></tr></table></figure>
<p>10-12 連同輸入一起轉址</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">store</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> back()-&gt;withInput();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>10-13 在轉址的同時填入資料</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Route::post(<span class="string">'contacts'</span>,<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//儲存聯絡資訊</span></span><br><span class="line"><span class="keyword">return</span> redirect(<span class="string">'dashboard'</span>)-&gt;with(<span class="string">'message'</span>,<span class="string">'Contact created'</span>);</span><br><span class="line">&#125;);</span><br><span class="line">Route::get(<span class="string">'dashboard'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 從session取得被填入的資料-通常會在Blade中處理</span></span><br><span class="line"><span class="keyword">echo</span> session(<span class="string">'message'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>自訂回應巨集</p>
<p>10-14 建立自訂的回應巨集</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppServiceProvider</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    Response::macro(<span class="string">'myJson'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($content)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> response(json_encode($content))</span><br><span class="line">            -&gt;headers([<span class="string">'Content-Type'</span> =&gt; <span class="string">'application/json'</span>]);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>return response()-&gt;myJson([‘name’ =&gt; ‘Sangeetha’]);</p>
<p>Laravel與中介層</p>
<p>中介層簡介</p>
<p>建立自訂的中介層</p>
<p>10-15 預設的中介層內容</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BanDeleteMethod</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span><span class="params">($request, Closure $next)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $next($request);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>暸解中介層的handle()方法</p>
<p>10-16 解釋中介層呼叫程序的虛擬程式</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BanDeleteMethod</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span><span class="params">($request, Closure $next)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// At this point, $request is the raw request from the user.</span></span><br><span class="line"><span class="comment">// Let's do something with it, just for fun.</span></span><br><span class="line"><span class="keyword">if</span> ($request-&gt;ip() === <span class="string">'192.168.1.1'</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> response(<span class="string">'BANNED IP ADDRESS!'</span>, <span class="number">403</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Now we've decided to accept it. Let's pass it on to the next</span></span><br><span class="line"><span class="comment">// middleware in the stack. We pass it to $next(), and what is</span></span><br><span class="line"><span class="comment">// returned is the response after the $request has been passed</span></span><br><span class="line"><span class="comment">// down the stack of middleware to the application and the</span></span><br><span class="line"><span class="comment">// application's response has been passed back up the stack.</span></span><br><span class="line">$response = $next($request);</span><br><span class="line"><span class="comment">// At this point, we can once again interact with the response</span></span><br><span class="line"><span class="comment">// just before it is returned to the user</span></span><br><span class="line">$response-&gt;cookie(<span class="string">'visited-our-site'</span>, <span class="keyword">true</span>);</span><br><span class="line"><span class="comment">// Finally, we can release this response to the end user</span></span><br><span class="line"><span class="keyword">return</span> $response;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>10-17 禁用刪除方法的中介層範例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BanDeleteMethod</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span><span class="params">($request, Closure $next)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    <span class="comment">// Test for the DELETE method</span></span><br><span class="line">    <span class="keyword">if</span> ($request-&gt;method() === <span class="string">'DELETE'</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> response(</span><br><span class="line">            <span class="string">"Get out of here with that delete method"</span>,</span><br><span class="line">            <span class="number">405</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">    $response = $next($request);</span><br><span class="line">    <span class="comment">// Assign cookie</span></span><br><span class="line">    $response-&gt;cookie(<span class="string">'visited-our-site'</span>, <span class="keyword">true</span>);</span><br><span class="line">    <span class="comment">// Return response</span></span><br><span class="line">    <span class="keyword">return</span> $response;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>10-18 綁定全域中介層</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app/Http/Kernel.php</span></span><br><span class="line"><span class="keyword">protected</span> $middleware = [</span><br><span class="line">\Illuminate\Foundation\Http\Middleware\CheckForMaintenanceMode::class,</span><br><span class="line">\App\Http\Middleware\BanDeleteMethod::class,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<p>綁定中介層</p>
<p>綁定全域中介層</p>
<p>10-19 綁定路由中介層</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app/Http/Kernel.php</span></span><br><span class="line"><span class="keyword">protected</span> $routeMiddleware = [</span><br><span class="line">    <span class="string">'auth'</span> =&gt; \App\Http\Middleware\Authenticate::class,</span><br><span class="line">    ...</span><br><span class="line">    <span class="string">'nodelete'</span> =&gt; \App\Http\Middleware\BanDeleteMethod::class,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<p>10-20 在路由定義中套用路由中介層</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Doesn't make much sense for our current example...</span></span><br><span class="line">Route::get(<span class="string">'contacts'</span>, [</span><br><span class="line">    <span class="string">'middleware'</span> =&gt; <span class="string">'nodelete'</span>,</span><br><span class="line">    <span class="string">'uses'</span> =&gt; <span class="string">'ContactsController@index'</span></span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Makes more sense for our current example...</span></span><br><span class="line">Route::group([<span class="string">'prefix'</span> =&gt; <span class="string">'api'</span>, <span class="string">'middleware'</span> =&gt; <span class="string">'nodelete'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// All routes related to an API</span></span><br><span class="line">&#125;]);</span><br></pre></td></tr></table></figure>
<p>10-21 Laravel的預設路由服務提供者</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// App\Providers\RouteServiceProvider</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">map</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;mapApiRoutes();</span><br><span class="line">    <span class="keyword">$this</span>-&gt;mapWebRoutes();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">mapApiRoutes</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Route::group([</span><br><span class="line">        <span class="string">'middleware'</span> =&gt; <span class="string">'api'</span>,</span><br><span class="line">        <span class="string">'namespace'</span> =&gt; <span class="keyword">$this</span>-&gt;namespace,</span><br><span class="line">        <span class="string">'prefix'</span> =&gt; <span class="string">'api'</span>,</span><br><span class="line">    ], <span class="function"><span class="keyword">function</span> <span class="params">($router)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">require</span> base_path(<span class="string">'routes/api.php'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">mapWebRoutes</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Route::group([</span><br><span class="line">        <span class="string">'middleware'</span> =&gt; <span class="string">'web'</span>,</span><br><span class="line">        <span class="string">'namespace'</span> =&gt; <span class="keyword">$this</span>-&gt;namespace,</span><br><span class="line">    ], <span class="function"><span class="keyword">function</span> <span class="params">($router)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">require</span> base_path(<span class="string">'routes/web.php'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>傳遞參數給中介層</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">'company'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> view(<span class="string">'company.admin'</span>);</span><br><span class="line">&#125;)-&gt;middleware(<span class="string">'auth:owner'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span><span class="params">($request, $next, $role)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (auth()-&gt;check() &amp;&amp; auth()-&gt;user()-&gt;hasRole($role)) &#123;</span><br><span class="line">        <span class="keyword">return</span> $next($request);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">'login'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Route::get(<span class="string">'company'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> view(<span class="string">'company.admin'</span>);</span><br><span class="line">&#125;)-&gt;middleware(<span class="string">'auth:owner,view'</span>);</span><br></pre></td></tr></table></figure>
<p>測試</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$request = <span class="keyword">new</span> Illuminate\Http\Request(</span><br><span class="line">$query, <span class="comment">// GET array</span></span><br><span class="line">$request, <span class="comment">// POST array</span></span><br><span class="line">$attributes, <span class="comment">// "attributes" array; empty is fine</span></span><br><span class="line">$cookies, <span class="comment">// cookies array</span></span><br><span class="line">$files, <span class="comment">// files array</span></span><br><span class="line">$server, <span class="comment">// servers array</span></span><br><span class="line">$content <span class="comment">// raw body data</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$response = <span class="keyword">new</span> Illuminate\Http\Response(</span><br><span class="line">$content, <span class="comment">// response content</span></span><br><span class="line">$status, <span class="comment">// HTTP status, default 200</span></span><br><span class="line">$headers <span class="comment">// array headers array</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
        
    </section>
</article>


    <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            <a href="/2020/05/06/laravel-09/">laravel-09 用戶身分驗證與授權</a>
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="http://vince115.github.io/categories/backend/index.html">
    
    <i class="icon-calendar"></i>
    
    <time datetime="2020-05-06T03:26:16.000Z" itemprop="datePublished">2020-05-06</time>
</a>

            
<div class="article-tag-list">
    <i class="icon-tag"></i>
    <a class="article-tag-link" href="/tags/backend/" rel="tag">backend</a>, <a class="article-tag-link" href="/tags/laravel/" rel="tag">laravel</a>
</div>


        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <h3 id="用戶模型與-migration"><a class="markdownIt-Anchor" href="#用戶模型與-migration"></a> 用戶模型與 migration</h3>
<p>9-1 Laravel的預設user migration</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Schema::create(<span class="string">'users'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Blueprint $table)</span> </span>&#123;</span><br><span class="line">    $table-&gt;increments(<span class="string">'id'</span>);</span><br><span class="line">    $table-&gt;string(<span class="string">'name'</span>);</span><br><span class="line">    $table-&gt;string(<span class="string">'email'</span>)-&gt;unique();</span><br><span class="line">    $table-&gt;string(<span class="string">'password'</span>);</span><br><span class="line">    $table-&gt;rememberToken();</span><br><span class="line">    $table-&gt;timestamps();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>9-2 Laravel 的預設user模型</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// App\User</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Notifications</span>\<span class="title">Notifiable</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Auth</span>\<span class="title">User</span> <span class="title">as</span> <span class="title">Authenticatable</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Authenticatable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Notifiable</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* The attributes that are mass assignable.</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@var</span> array</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">protected</span> $fillable = [</span><br><span class="line"><span class="string">'name'</span>, <span class="string">'email'</span>, <span class="string">'password'</span>,</span><br><span class="line">];</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* The attributes excluded from the model's JSON form.</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@var</span> array</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">protected</span> $hidden = [</span><br><span class="line"><span class="string">'password'</span>, <span class="string">'remember_token'</span>,</span><br><span class="line">];</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// Illuminate\Foundation\Auth\User</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Auth</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Auth</span>\<span class="title">Authenticatable</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Auth</span>\<span class="title">Passwords</span>\<span class="title">CanResetPassword</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Auth</span>\<span class="title">Access</span>\<span class="title">Authorizable</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Contracts</span>\<span class="title">Auth</span>\<span class="title">Authenticatable</span> <span class="title">as</span> <span class="title">AuthenticatableContract</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Contracts</span>\<span class="title">Auth</span>\<span class="title">Access</span>\<span class="title">Authorizable</span> <span class="title">as</span> <span class="title">AuthorizableContract</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Contracts</span>\<span class="title">Auth</span>\<span class="title">CanResetPassword</span> <span class="title">as</span> <span class="title">CanResetPasswordContract</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span> <span class="keyword">implements</span></span></span><br><span class="line"><span class="class"><span class="title">AuthenticatableContract</span>,</span></span><br><span class="line"><span class="class"><span class="title">AuthorizableContract</span>,</span></span><br><span class="line"><span class="class"><span class="title">CanResetPasswordContract</span></span></span><br><span class="line"><span class="class"><span class="title">esetPasswordContract</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">   useAuthenticatable,Authorizable,CanResetPassword;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="使用auth-全域輔助函式與auth靜態介面"><a class="markdownIt-Anchor" href="#使用auth-全域輔助函式與auth靜態介面"></a> 使用auth() 全域輔助函式與Auth靜態介面</h3>
<p>9-3 Rgister</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="auth-控制器"><a class="markdownIt-Anchor" href="#auth-控制器"></a> Auth 控制器</h3>
<h3 id="registercontroller"><a class="markdownIt-Anchor" href="#registercontroller"></a> RegisterController</h3>
<p>9-4 Laravel 預設的 RgisterController</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RegisterController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">RegistersUsers</span>;</span><br><span class="line">    <span class="keyword">protected</span> $redirectTo = <span class="string">'/home'</span>;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">validator</span><span class="params">(array $data)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Validator::make($data, [</span><br><span class="line">            <span class="string">'name'</span> =&gt; <span class="string">'required|max:255'</span>,</span><br><span class="line">            <span class="string">'email'</span> =&gt; <span class="string">'required|email|max:255|unique:users'</span>,</span><br><span class="line">            <span class="string">'password'</span> =&gt; <span class="string">'required|min:6|confirmed'</span>,</span><br><span class="line">        ]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">create</span><span class="params">(array $data)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> User::create([</span><br><span class="line">            <span class="string">'name'</span> =&gt; $data[<span class="string">'name'</span>],</span><br><span class="line">            <span class="string">'email'</span> =&gt; $data[<span class="string">'email'</span>],</span><br><span class="line">            <span class="string">'password'</span> =&gt; bcrypt($data[<span class="string">'password'</span>]),</span><br><span class="line">        ]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="registeruser-特徵"><a class="markdownIt-Anchor" href="#registeruser-特徵"></a> RegisterUser 特徵</h5>
<h4 id="logincontroller"><a class="markdownIt-Anchor" href="#logincontroller"></a> LoginController</h4>
<h5 id="authenticatesusers-特徵"><a class="markdownIt-Anchor" href="#authenticatesusers-特徵"></a> AuthenticatesUsers 特徵</h5>
<h5 id="throttleslogins-特徵"><a class="markdownIt-Anchor" href="#throttleslogins-特徵"></a> ThrottlesLogins 特徵</h5>
<h4 id="resetpasswordcontroller"><a class="markdownIt-Anchor" href="#resetpasswordcontroller"></a> ResetPasswordController</h4>
<h3 id="authroutes-路由"><a class="markdownIt-Anchor" href="#authroutes-路由"></a> Auth::routes() 路由</h3>
<p>9-5 Auth::提供的路由</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Authentication Routes</span></span><br><span class="line"><span class="keyword">$this</span>-&gt;get(<span class="string">'login'</span>, <span class="string">'Auth\LoginController@showLoginForm'</span>);</span><br><span class="line"><span class="keyword">$this</span>-&gt;post(<span class="string">'login'</span>, <span class="string">'Auth\LoginController@login'</span>);</span><br><span class="line"><span class="keyword">$this</span>-&gt;get(<span class="string">'logout'</span>, <span class="string">'Auth\LoginController@logout'</span>);</span><br><span class="line"><span class="comment">// Registration Routes</span></span><br><span class="line"><span class="keyword">$this</span>-&gt;get(<span class="string">'register'</span>, <span class="string">'Auth\RegisterController@showRegistrationForm'</span>);</span><br><span class="line"><span class="keyword">$this</span>-&gt;post(<span class="string">'register'</span>, <span class="string">'Auth\RegisterController@register'</span>);</span><br><span class="line"><span class="comment">// Password Reset Routes</span></span><br><span class="line"><span class="keyword">$this</span>-&gt;get(<span class="string">'password/reset'</span>, <span class="string">'Auth\ForgotPasswordController@showLinkRequestForm'</span>);</span><br><span class="line"><span class="keyword">$this</span>-&gt;post(<span class="string">'password/email'</span>, <span class="string">'Auth\ForgotPasswordController@sendResetLinkEmail'</span>);</span><br><span class="line"><span class="keyword">$this</span>-&gt;get(<span class="string">'password/reset/&#123;token&#125;'</span>, <span class="string">'Auth\ResetPasswordController@showResetForm'</span>);</span><br><span class="line"><span class="keyword">$this</span>-&gt;post(<span class="string">'password/reset'</span>, <span class="string">'Auth\ResetPasswordController@reset'</span>);</span><br></pre></td></tr></table></figure>
<h3 id="auth-鷹架"><a class="markdownIt-Anchor" href="#auth-鷹架"></a> Auth 鷹架</h3>
<h3 id="記住我"><a class="markdownIt-Anchor" href="#記住我"></a> “記住我”</h3>
<p>9-6 嘗試進行用戶身分驗證</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (auth()-&gt;attempt([</span><br><span class="line">    <span class="string">'email'</span> =&gt; request()-&gt;input(<span class="string">'email'</span>),</span><br><span class="line">    <span class="string">'password'</span> =&gt; request()-&gt;input(<span class="string">'password'</span>)</span><br><span class="line">    ])) &#123;</span><br><span class="line">    <span class="comment">// Handle the successful login</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>9-7 使用&quot;記住我&quot;確認方塊來做身分確認</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (auth()-&gt;attempt([</span><br><span class="line">    <span class="string">'email'</span> =&gt; request()-&gt;input(<span class="string">'email'</span>),</span><br><span class="line">    <span class="string">'password'</span> =&gt; request()-&gt;input(<span class="string">'password'</span>)</span><br><span class="line">    ]), request()-&gt;has(<span class="string">'remember'</span>)) &#123;</span><br><span class="line">    <span class="comment">// Handle the successful login</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="手動驗證用戶"><a class="markdownIt-Anchor" href="#手動驗證用戶"></a> 手動驗證用戶</h3>
<h3 id="驗證中介層"><a class="markdownIt-Anchor" href="#驗證中介層"></a> 驗證中介層</h3>
<p>9-8 使用Blade的@cannot指令</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Route::group([<span class="string">'middleware'</span> =&gt; <span class="string">'auth'</span>], <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    Route::get(<span class="string">'account'</span>, <span class="string">'AccountController@dashboard'</span>);</span><br><span class="line">&#125;);</span><br><span class="line">Route::get(<span class="string">'login'</span>, <span class="string">'Auth\LoginController@getLogin'</span>)-&gt;middleware(<span class="string">'guest'</span>);</span><br></pre></td></tr></table></figure>
<h3 id="守衛"><a class="markdownIt-Anchor" href="#守衛"></a> 守衛</h3>
<h4 id="改變預設的守衛"><a class="markdownIt-Anchor" href="#改變預設的守衛"></a> 改變預設的守衛</h4>
<h4 id="使用其他的守衛而不改變預設值"><a class="markdownIt-Anchor" href="#使用其他的守衛而不改變預設值"></a> 使用其他的守衛而不改變預設值</h4>
<h4 id="增加新守衛"><a class="markdownIt-Anchor" href="#增加新守衛"></a> 增加新守衛</h4>
<h4 id="建立自訂的用戶供應器"><a class="markdownIt-Anchor" href="#建立自訂的用戶供應器"></a> 建立自訂的用戶供應器</h4>
<h4 id="為非關聯式資料庫自訂user供應器"><a class="markdownIt-Anchor" href="#為非關聯式資料庫自訂user供應器"></a> 為非關聯式資料庫自訂user供應器</h4>
<h3 id="驗證事件"><a class="markdownIt-Anchor" href="#驗證事件"></a> 驗證事件</h3>
<p>9-9 框架生成的驗證事件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> $listen = [</span><br><span class="line">    <span class="string">'Illuminate\Auth\Events\Attempting'</span> =&gt; [],</span><br><span class="line">    <span class="string">'Illuminate\Auth\Events\Login'</span> =&gt; [],</span><br><span class="line">    <span class="string">'Illuminate\Auth\Events\Logout'</span> =&gt; [],</span><br><span class="line">    <span class="string">'Illuminate\Auth\Events\Lockout'</span> =&gt; [],</span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<h3 id="授權acl與角色"><a class="markdownIt-Anchor" href="#授權acl與角色"></a> 授權(ACL)與角色</h3>
<h4 id="定義授權規則"><a class="markdownIt-Anchor" href="#定義授權規則"></a> 定義授權規則</h4>
<p>9-10 更新聯絡資訊的能力範例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AuthServiceProvider</span> <span class="keyword">extends</span> <span class="title">ServiceProvider</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span><span class="params">(GateContract $gate)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;registerPolicies($gate);</span><br><span class="line">        $gate-&gt;define(<span class="string">'update-contact'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($user, $contact)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> $user-&gt;id === $contact-&gt;user_id;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="gate靜態介面與注入gate"><a class="markdownIt-Anchor" href="#gate靜態介面與注入gate"></a> Gate靜態介面(與注入Gate)</h4>
<p>9-11 基本的Gate靜態介面用法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (Gate::allows(<span class="string">'update-contact'</span>, $contact)) &#123;</span><br><span class="line">    <span class="comment">// Update contact</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// or...</span></span><br><span class="line"><span class="keyword">if</span> (Gate::denies(<span class="string">'update-contact'</span>, $contact)) &#123;</span><br><span class="line">    abort(<span class="number">403</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>9-12 使用多個參數的能力</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Definition</span></span><br><span class="line">$gate-&gt;define(<span class="string">'add-contact-to-group'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($user, $contact, $group)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $user-&gt;id === $contact-&gt;user_id &amp;&amp; $user-&gt;id === $group-&gt;user_id;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// Usage</span></span><br><span class="line"><span class="keyword">if</span> (Gate::denies(<span class="string">'add-contact-to-group'</span>, [$contact, $group])) &#123;</span><br><span class="line">    abort(<span class="number">403</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>9-13 指定Gate用戶</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (Gate::forUser($user)-&gt;denies(<span class="string">'create-contact'</span>)) &#123;</span><br><span class="line">    abort(<span class="number">403</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="授權中介層"><a class="markdownIt-Anchor" href="#授權中介層"></a> 授權中介層</h4>
<p>9-14 使用授權中介層</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">'people/create'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// Create person...</span></span><br><span class="line">&#125;)-&gt;middleware(<span class="string">'can:create-person'</span>);</span><br><span class="line">Route::get(<span class="string">'people/&#123;person&#125;/edit'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// Create person...</span></span><br><span class="line">&#125;)-&gt;middleware(<span class="string">'can:create,person'</span>);</span><br></pre></td></tr></table></figure>
<h4 id="控制器授權"><a class="markdownIt-Anchor" href="#控制器授權"></a> 控制器授權</h4>
<p>9-15 以authorize()簡化控制器授權</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// From this:</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span><span class="params">($contactId)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $contact = Contact::findOrFail($contactId);</span><br><span class="line">    <span class="keyword">if</span> (Gate::cannot(<span class="string">'update-contact'</span>, $contact)) &#123;</span><br><span class="line">    abort(<span class="number">403</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// To this:</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span><span class="params">($contactId)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">$contact = Contact::findOrFail($contactId);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;authorize(<span class="string">'update-contact'</span>, $contact);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="用戶實例檢查"><a class="markdownIt-Anchor" href="#用戶實例檢查"></a> 用戶實例檢查</h4>
<p>9-16 authorizeResource()從&quot;授權&quot;到&quot;方法&quot;的對應</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ContactsController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// This call does everything you see in the methods below.</span></span><br><span class="line">        <span class="comment">// If you put this here, you can remove all authorize</span></span><br><span class="line">        <span class="comment">// calls in the individual resource methods here.</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;authorizeResource(Contact::class);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;authorize(<span class="string">'view'</span>, Contact::class);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">create</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;authorize(<span class="string">'create'</span>, Contact::class);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">store</span><span class="params">(Request $request)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;authorize(<span class="string">'create'</span>, Contact::class);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span><span class="params">(Contact $contact)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;authorize(<span class="string">'view'</span>, $contact);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">edit</span><span class="params">(Contact $contact)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;authorize(<span class="string">'update'</span>, $contact);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span><span class="params">(Request $request, Contact $contact)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;authorize(<span class="string">'update'</span>, $contact);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">destroy</span><span class="params">(Contact $contact)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;authorize(<span class="string">'delete'</span>, $contact);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>9-17 對用戶實例檢查授權</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$user = User::find(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">if</span> ($user-&gt;can(<span class="string">'create-contact'</span>)) &#123;</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="blade-檢查"><a class="markdownIt-Anchor" href="#blade-檢查"></a> Blade 檢查</h4>
<p>9-18 使用Blade的@can指令</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">nav</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/"</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">@can('edit-contact', $contact)</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;&#123; route('contacts.edit', [$contact-&gt;id]) &#125;&#125;"</span>&gt;</span>Edit This Contact<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">@endcan</span><br><span class="line"><span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>9-19 使用Blade的@cannot指令</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1&gt;&#123;&#123; $contact-&gt;name &#125;&#125;&lt;/h1&gt;</span><br><span class="line">@cannot(<span class="string">'edit-contact'</span>, $contact)</span><br><span class="line">LOCKED</span><br><span class="line">@endcannot</span><br></pre></td></tr></table></figure>
<h4 id="攔截檢查"><a class="markdownIt-Anchor" href="#攔截檢查"></a> 攔截檢查</h4>
<p>9-20 使用before()來覆寫Gate檢查</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$gate-&gt;before(<span class="function"><span class="keyword">function</span> <span class="params">($user, $ability)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> ($user-&gt;isOwner()) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="政策"><a class="markdownIt-Anchor" href="#政策"></a> 政策</h4>
<h4 id="產生政策"><a class="markdownIt-Anchor" href="#產生政策"></a> 產生政策</h4>
<blockquote>
<p>php artisan make:policy CantactPolicy</p>
</blockquote>
<p>9-21 update政策方法範例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Policies</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ContactPolicy</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span><span class="params">($user, $contact)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $user-&gt;id === $contact-&gt;user_id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="檢查政策"><a class="markdownIt-Anchor" href="#檢查政策"></a> 檢查政策</h4>
<p>9-22 以政策檢查授權</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Gate</span></span><br><span class="line"><span class="keyword">if</span> (Gate::denies(<span class="string">'update'</span>, $contact)) &#123;</span><br><span class="line">abort(<span class="number">403</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Gate if you don't have an explicit instance</span></span><br><span class="line"><span class="keyword">if</span> (! Gate::check(<span class="string">'create'</span>, Contact::class)) &#123;</span><br><span class="line">abort(<span class="number">403</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// User</span></span><br><span class="line"><span class="keyword">if</span> ($user-&gt;can(<span class="string">'update'</span>, $contact)) &#123;</span><br><span class="line"><span class="comment">// Do stuff</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Blade</span></span><br><span class="line">@can(<span class="string">'update'</span>, $contact)</span><br><span class="line">&lt;!-- show stuff --&gt;</span><br><span class="line">@endcan</span><br></pre></td></tr></table></figure>
<h4 id="覆寫政策"><a class="markdownIt-Anchor" href="#覆寫政策"></a> 覆寫政策</h4>
<p>9-23 使用before方法來覆寫政策</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">before</span><span class="params">($user, $ability)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ($user-&gt;isAdmin()) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="測試"><a class="markdownIt-Anchor" href="#測試"></a> 測試</h3>
<p>9-24 在應用測試中扮演用戶來進行驗證</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_it_creates_a_new_contact</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $user = factory(User::class)-&gt;create();</span><br><span class="line">    <span class="keyword">$this</span>-&gt;be($user);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">$this</span>-&gt;post(<span class="string">'contacts'</span>, [</span><br><span class="line">        <span class="string">'email'</span> =&gt; <span class="string">'my@email.com'</span></span><br><span class="line">    ]);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;seeInDatabase(<span class="string">'contacts'</span>, [</span><br><span class="line">        <span class="string">'email'</span> =&gt; <span class="string">'my@email.com'</span>,</span><br><span class="line">        <span class="string">'user_id'</span> =&gt; $user-&gt;id,</span><br><span class="line">    ]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>9-25 測試授權規則</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_non_admins_cant_create_users</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $user = factory(User::class)-&gt;create([</span><br><span class="line">        <span class="string">'admin'</span> =&gt; <span class="keyword">false</span></span><br><span class="line">    ]);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;be($user);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;post(<span class="string">'users'</span>, [<span class="string">'email'</span> =&gt; <span class="string">'my@email.com'</span>]);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;dontSeeInDatabase(<span class="string">'users'</span>, [</span><br><span class="line">        <span class="string">'email'</span> =&gt; <span class="string">'my@email.com'</span></span><br><span class="line">    ]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>9-26 檢查狀態碼來測試授權</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_non_admins_cant_create_users</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $user = factory(User::class)-&gt;create([</span><br><span class="line">        <span class="string">'admin'</span> =&gt; <span class="keyword">false</span></span><br><span class="line">    ]);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;be($user);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;post(<span class="string">'users'</span>, [<span class="string">'email'</span> =&gt; <span class="string">'my@email.com'</span>]);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;assertResponseStatus(<span class="number">403</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>9-27 測試授權路由</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_users_can_register</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;post(<span class="string">'register'</span>, [</span><br><span class="line">    <span class="string">'name'</span> =&gt; <span class="string">'Sal Leibowitz'</span>,</span><br><span class="line">    <span class="string">'email'</span> =&gt; <span class="string">'sal@leibs.net'</span>,</span><br><span class="line">    <span class="string">'password'</span> =&gt; <span class="string">'abcdefg123'</span>,</span><br><span class="line">    <span class="string">'password_confirmation'</span> =&gt; <span class="string">'abcdefg123'</span>,</span><br><span class="line">    ]);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">$this</span>-&gt;followRedirects()-&gt;assertResponseOk();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">$this</span>-&gt;seeInDatabase(<span class="string">'users'</span>, [</span><br><span class="line">    <span class="string">'name'</span> =&gt; <span class="string">'Sal Leibowitz'</span>,</span><br><span class="line">    <span class="string">'email'</span> =&gt; <span class="string">'sal@leibs.net'</span>,</span><br><span class="line">    ]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_users_can_log_in</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $user = factory(User::class)-&gt;create([</span><br><span class="line">        <span class="string">'password'</span> =&gt; bcrypt(<span class="string">'abcdefg123'</span>)</span><br><span class="line">    ]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">$this</span>-&gt;post(<span class="string">'login'</span>, [</span><br><span class="line">    <span class="string">'email'</span> =&gt; $user-&gt;email,</span><br><span class="line">    <span class="string">'password'</span> =&gt; <span class="string">'abcdefg123'</span>,</span><br><span class="line">    ]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">$this</span>-&gt;followRedirects()-&gt;assertResponseOk();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">$this</span>-&gt;assertTrue(auth()-&gt;check());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        
    </section>
</article>


    <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            <a href="/2020/05/01/laravel-08/">laravel-08</a>
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="http://vince115.github.io/categories/backend/index.html">
    
    <i class="icon-calendar"></i>
    
    <time datetime="2020-05-01T04:42:18.000Z" itemprop="datePublished">2020-05-01</time>
</a>

            
<div class="article-tag-list">
    <i class="icon-tag"></i>
    <a class="article-tag-link" href="/tags/backend/" rel="tag">backend</a>, <a class="article-tag-link" href="/tags/laravel/" rel="tag">laravel</a>
</div>


        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <p>8-1 The default database connections list</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'connections'</span> =&gt; [</span><br><span class="line">        <span class="string">'sqlite'</span> =&gt; [</span><br><span class="line">        <span class="string">'driver'</span> =&gt; <span class="string">'sqlite'</span>,</span><br><span class="line">        <span class="string">'database'</span> =&gt; database_path(<span class="string">'database.sqlite'</span>),</span><br><span class="line">        <span class="string">'prefix'</span> =&gt; <span class="string">''</span>,</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">'mysql'</span> =&gt; [</span><br><span class="line">        <span class="string">'driver'</span> =&gt; <span class="string">'mysql'</span>,</span><br><span class="line">        <span class="string">'host'</span> =&gt; env(<span class="string">'DB_HOST'</span>, <span class="string">'localhost'</span>),</span><br><span class="line">        <span class="string">'database'</span> =&gt; env(<span class="string">'DB_DATABASE'</span>, <span class="string">'forge'</span>),</span><br><span class="line">        <span class="string">'username'</span> =&gt; env(<span class="string">'DB_USERNAME'</span>, <span class="string">'forge'</span>),</span><br><span class="line">        <span class="string">'password'</span> =&gt; env(<span class="string">'DB_PASSWORD'</span>, <span class="string">''</span>),</span><br><span class="line">        <span class="string">'charset'</span> =&gt; <span class="string">'utf8'</span>,</span><br><span class="line">        <span class="string">'collation'</span> =&gt; <span class="string">'utf8_unicode_ci'</span>,</span><br><span class="line">        <span class="string">'prefix'</span> =&gt; <span class="string">''</span>,</span><br><span class="line">        <span class="string">'strict'</span> =&gt; <span class="keyword">false</span>,</span><br><span class="line">        <span class="string">'engine'</span> =&gt; <span class="keyword">null</span>,</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">'pgsql'</span> =&gt; [</span><br><span class="line">        <span class="string">'driver'</span> =&gt; <span class="string">'pgsql'</span>,</span><br><span class="line">        <span class="string">'host'</span> =&gt; env(<span class="string">'DB_HOST'</span>, <span class="string">'localhost'</span>),</span><br><span class="line">        <span class="string">'database'</span> =&gt; env(<span class="string">'DB_DATABASE'</span>, <span class="string">'forge'</span>),</span><br><span class="line">        <span class="string">'username'</span> =&gt; env(<span class="string">'DB_USERNAME'</span>, <span class="string">'forge'</span>),</span><br><span class="line">        <span class="string">'password'</span> =&gt; env(<span class="string">'DB_PASSWORD'</span>, <span class="string">''</span>),</span><br><span class="line">        <span class="string">'charset'</span> =&gt; <span class="string">'utf8'</span>,</span><br><span class="line">        <span class="string">'prefix'</span> =&gt; <span class="string">''</span>,</span><br><span class="line">        <span class="string">'schema'</span> =&gt; <span class="string">'public'</span>,</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">'sqlsrv'</span> =&gt; [</span><br><span class="line">        <span class="string">'driver'</span> =&gt; <span class="string">'sqlsrv'</span>,</span><br><span class="line">        <span class="string">'host'</span> =&gt; env(<span class="string">'DB_HOST'</span>, <span class="string">'localhost'</span>),</span><br><span class="line">        <span class="string">'database'</span> =&gt; env(<span class="string">'DB_DATABASE'</span>, <span class="string">'forge'</span>),</span><br><span class="line">        <span class="string">'username'</span> =&gt; env(<span class="string">'DB_USERNAME'</span>, <span class="string">'forge'</span>),</span><br><span class="line">        <span class="string">'password'</span> =&gt; env(<span class="string">'DB_PASSWORD'</span>, <span class="string">''</span>),</span><br><span class="line">        <span class="string">'charset'</span> =&gt; <span class="string">'utf8'</span>,</span><br><span class="line">        <span class="string">'prefix'</span> =&gt; <span class="string">''</span>,</span><br><span class="line">    ],</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>8-2</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Schema</span>\<span class="title">Blueprint</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Migrations</span>\<span class="title">Migration</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CreateUsersTable</span> <span class="keyword">extends</span> <span class="title">Migration</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Run the migrations.</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">up</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Schema::create(<span class="string">'users'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Blueprint $table)</span> </span>&#123;</span><br><span class="line">        $table-&gt;increments(<span class="string">'id'</span>);</span><br><span class="line">        $table-&gt;string(<span class="string">'name'</span>);</span><br><span class="line">        $table-&gt;string(<span class="string">'email'</span>)-&gt;unique();</span><br><span class="line">        $table-&gt;string(<span class="string">'password'</span>, <span class="number">60</span>);</span><br><span class="line">        $table-&gt;rememberToken();</span><br><span class="line">        $table-&gt;timestamps();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Reverse the migrations.</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">down</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Schema::drop(<span class="string">'users'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8-3 Adding column indexes in migrations</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// after columns are created...</span></span><br><span class="line">$table-&gt;primary(<span class="string">'primary_id'</span>); <span class="comment">// Primary key; unnecessary if used increments()</span></span><br><span class="line">$table-&gt;primary([<span class="string">'first_name'</span>, <span class="string">'last_name'</span>]); <span class="comment">// Composite keys</span></span><br><span class="line">$table-&gt;unique(<span class="string">'email'</span>); <span class="comment">// Unique index</span></span><br><span class="line">$table-&gt;unique(<span class="string">'email'</span>, <span class="string">'optional_custom_index_name'</span>); <span class="comment">// Unique index</span></span><br><span class="line">$table-&gt;index(<span class="string">'amount'</span>); <span class="comment">// Basic index</span></span><br><span class="line">$table-&gt;index(<span class="string">'amount'</span>, <span class="string">'optional_custom_index_name'</span>); <span class="comment">// Basic index</span></span><br></pre></td></tr></table></figure>
<p>8-4</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$table-&gt;dropPrimary(<span class="string">'contacts_id_primary'</span>);</span><br><span class="line">$table-&gt;dropUnique(<span class="string">'contacts_email_unique'</span>);</span><br><span class="line">$table-&gt;dropIndex(<span class="string">'optional_custom_index_name'</span>);</span><br><span class="line"><span class="comment">// If you pass an array of column names to dropIndex, it will</span></span><br><span class="line"><span class="comment">// guess the index names for you based on the generation rules</span></span><br><span class="line">$table-&gt;dropIndex([<span class="string">'email'</span>, <span class="string">'amount'</span>]);</span><br></pre></td></tr></table></figure>
<p>8-5</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">factory(Post::class)-&gt;create([</span><br><span class="line">    <span class="string">'title'</span> =&gt; <span class="string">'My greatest post ever'</span></span><br><span class="line">]);</span><br><span class="line">factory(User::class, <span class="number">20</span>)-&gt;create()-&gt;each(<span class="function"><span class="keyword">function</span> <span class="params">($u)</span> <span class="title">use</span> <span class="params">($post)</span> </span>&#123;</span><br><span class="line">    $post-&gt;comments()-&gt;save(factory(Comment::class)-&gt;make([</span><br><span class="line">        <span class="string">'user_id'</span> =&gt; $u-&gt;id</span><br><span class="line">    ]));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>8-6</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$factory-&gt;define(Contact::class, <span class="function"><span class="keyword">function</span> <span class="params">(Faker\Generator $faker)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">        <span class="string">'name'</span> =&gt; $faker-&gt;name,</span><br><span class="line">        <span class="string">'email'</span> =&gt; $faker-&gt;email,</span><br><span class="line">    ];</span><br><span class="line">&#125;);</span><br><span class="line">$factory-&gt;defineAs(Contact::class, <span class="string">'vip'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Faker\Generator $faker)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">        <span class="string">'name'</span> =&gt; $faker-&gt;name,</span><br><span class="line">        <span class="string">'email'</span> =&gt; $faker-&gt;email,</span><br><span class="line">        <span class="string">'vip'</span> =&gt; <span class="keyword">true</span>,</span><br><span class="line">    ];</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>8-7  Extending a factory type</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$factory-&gt;define(Contact::class, <span class="function"><span class="keyword">function</span> <span class="params">(Faker\Generator $faker)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">        <span class="string">'name'</span> =&gt; $faker-&gt;name,</span><br><span class="line">        <span class="string">'email'</span> =&gt; $faker-&gt;email,</span><br><span class="line">    ];</span><br><span class="line">&#125;);</span><br><span class="line">$factory-&gt;defineAs(</span><br><span class="line">    Contact::class,</span><br><span class="line">    <span class="string">'vip'</span>,</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="params">(Faker\Generator $faker)</span> <span class="title">use</span> <span class="params">($factory)</span> </span>&#123;</span><br><span class="line">        $contact = $factory-&gt;raw(Contact::class);</span><br><span class="line">        <span class="keyword">return</span> array_merge($contact, [<span class="string">'vip'</span> =&gt; <span class="keyword">true</span>]);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<p>8-8 Sample raw SQL and query builder usage</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// basic statement</span></span><br><span class="line">DB::statement(<span class="string">'drop table users'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// raw select, and parameter binding</span></span><br><span class="line">DB::select(<span class="string">'select * from contacts where validated = ?'</span>, [<span class="keyword">true</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// select using the fluent builder</span></span><br><span class="line">$users = DB::table(<span class="string">'users'</span>)-&gt;get();</span><br><span class="line"></span><br><span class="line"><span class="comment">// joins and other complex calls</span></span><br><span class="line">DB::table(<span class="string">'users'</span>)</span><br><span class="line">    -&gt;join(<span class="string">'contacts'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($join)</span> </span>&#123;</span><br><span class="line">        $join-&gt;on(<span class="string">'users.id'</span>, <span class="string">'='</span>, <span class="string">'contacts.user_id'</span>)</span><br><span class="line">            -&gt;where(<span class="string">'contacts.type'</span>, <span class="string">'donor'</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">-&gt;get();</span><br></pre></td></tr></table></figure>
<p>8-9  A simple database transaction</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">DB::transaction(<span class="function"><span class="keyword">function</span> <span class="params">()</span> <span class="title">use</span> <span class="params">($userId, $numVotes)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// Possibly failing DB query</span></span><br><span class="line">    DB::table(<span class="string">'users'</span>)</span><br><span class="line">        -&gt;where(<span class="string">'id'</span>, $userId)</span><br><span class="line">        -&gt;update([<span class="string">'votes'</span> =&gt; $numVotes]);</span><br><span class="line">    <span class="comment">// Caching query that we don't want to run if the above query fails</span></span><br><span class="line">    DB::table(<span class="string">'votes'</span>)</span><br><span class="line">        -&gt;where(<span class="string">'user_id'</span>, $userId)</span><br><span class="line">        -&gt;delete();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>8-10</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Contact</span> <span class="keyword">extends</span> <span class="title">Model</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>8-11</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">save</span><span class="params">(Request $request)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// Create and save a new contact from user input</span></span><br><span class="line">    $contact = <span class="keyword">new</span> Contact();</span><br><span class="line">    $contact-&gt;first_name = $request-&gt;input(<span class="string">'first_name'</span>);</span><br><span class="line">    $contact-&gt;last_name = $request-&gt;input(<span class="string">'last_name'</span>);</span><br><span class="line">    $conatct-&gt;email = $request-&gt;input(<span class="string">'email'</span>);</span><br><span class="line">    $contact-&gt;save();</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">'contacts'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span><span class="params">($contactId)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// Return a JSON representation of a Contact based on a URL segment;</span></span><br><span class="line">    <span class="comment">// if the contact doesn't exist, throw an exception</span></span><br><span class="line">    <span class="keyword">return</span> Contact::findOrFail($contactId);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">vips</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// Unnecessarily complex example, but still possible with basic Eloquent</span></span><br><span class="line">    <span class="comment">// class; adds a "formalName" property to every VIP entry</span></span><br><span class="line">    <span class="keyword">return</span> Contact::where(<span class="string">'vip'</span>, <span class="keyword">true</span>)-&gt;get()-&gt;map(<span class="function"><span class="keyword">function</span> <span class="params">($contact)</span> </span>&#123;</span><br><span class="line">        $contact-&gt;formalName = <span class="string">"The exalted &#123;$contact-&gt;first_name&#125; of the</span></span><br><span class="line"><span class="string">        &#123;$contact-&gt;last_name&#125;s"</span>;</span><br><span class="line">        <span class="keyword">return</span> $contact;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8-12 Using an Eloquent OrFail() method in a controller method</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ContactController</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span><span class="params">($contactId)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> view(<span class="string">'contacts.show'</span>)</span><br><span class="line">        -&gt;with(<span class="string">'contact'</span>, Contact::findOrFail($contactId));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8-13  Chunking an Eloquent query to limit memory usage</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Contact::chunk(<span class="number">100</span>, <span class="function"><span class="keyword">function</span> <span class="params">($contacts)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">foreach</span> ($contacts <span class="keyword">as</span> $contact) &#123;</span><br><span class="line">        <span class="comment">// Do something with $contact</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>8-14 Inserting an Eloquent record by creating a new instance</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$contact = <span class="keyword">new</span> Contact;</span><br><span class="line">$contact-&gt;name = <span class="string">'Ken Hirata'</span>;</span><br><span class="line">$contact-&gt;email = <span class="string">'ken@hirata.com'</span>;</span><br><span class="line">$contact-&gt;save();</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line">$contact = <span class="keyword">new</span> Contact([</span><br><span class="line">    <span class="string">'name'</span> =&gt; <span class="string">'Ken Hirata'</span>,</span><br><span class="line">    <span class="string">'email'</span> =&gt; <span class="string">'ken@hirata.com'</span></span><br><span class="line">]);</span><br><span class="line">$contact-&gt;save();</span><br></pre></td></tr></table></figure>
<p>8-15 Inserting an Eloquent record by passing an array to create()</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$contact = Contact::create([</span><br><span class="line">    <span class="string">'name'</span> =&gt; <span class="string">'Keahi Hale'</span>,</span><br><span class="line">    <span class="string">'email'</span> =&gt; <span class="string">'halek481@yahoo.com'</span></span><br><span class="line">]);</span><br></pre></td></tr></table></figure>
<p>8-16 Updating an Eloquent record by updating an instance and saving</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$contact = Contact::find(<span class="number">1</span>);</span><br><span class="line">$contact-&gt;email = <span class="string">'natalie@parkfamily.com'</span>;</span><br><span class="line">$contact-&gt;save();</span><br></pre></td></tr></table></figure>
<p>8-17  Updating one or more Eloquent records by passing an array to the update() method</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Contact::where(<span class="string">'created_at'</span>, <span class="string">'&lt;'</span>, Carbon::now()-&gt;subYear())</span><br><span class="line">    -&gt;update([<span class="string">'longevity'</span> =&gt; <span class="string">'ancient'</span>]);</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line">$contact = Contact::find(<span class="number">1</span>);</span><br><span class="line">$contact-&gt;update([<span class="string">'longevity'</span> =&gt; <span class="string">'ancient'</span>]);</span><br></pre></td></tr></table></figure>
<p>8-18 Updating an Eloquent model using the entirety of a request’s input</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ContactController</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span><span class="params">(Contact $contact, Request $request)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $contact-&gt;update($request-&gt;all());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8-19 Using Eloquent’s fillable or guarded properties to define mass-assignable fields</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Contact</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $fillable = [<span class="string">'name'</span>, <span class="string">'email'</span>];</span><br><span class="line">    <span class="comment">// or</span></span><br><span class="line">    <span class="keyword">protected</span> $guarded = [<span class="string">'id'</span>, <span class="string">'created_ at'</span>, <span class="string">'updated_at'</span>, <span class="string">'owner_id'</span>] ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8-20</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Schema::table(<span class="string">'contacts'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Blueprint $table)</span> </span>&#123;</span><br><span class="line">    $table-&gt;softDeletes();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>8-21 An Eloquent model with soft deletes enabled</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">SoftDeletes</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Contact</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">SoftDeletes</span>; <span class="comment">// use the trait</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $dates = [<span class="string">'deleted_at'</span>]; <span class="comment">// mark this column as a date</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8-22 Adding a global scope using a closure</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Contact</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">parent</span>::boot();</span><br><span class="line">        <span class="keyword">static</span>::addGlobalScope(<span class="string">'active'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Builder $builder)</span> </span>&#123;</span><br><span class="line">            $builder-&gt;where(<span class="string">'active'</span>, <span class="keyword">true</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>8-23 Creating a global scope class</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Scopes</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Scope</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Builder</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ActiveScope</span> <span class="keyword">implements</span> <span class="title">Scope</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">apply</span><span class="params">(Builder $builder, Model $model)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $builder-&gt;where(<span class="string">'active'</span>, <span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8-24</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Scopes</span>\<span class="title">ActiveScope</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Contact</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">parent</span>::boot();</span><br><span class="line">        <span class="keyword">static</span>::addGlobalScope(newActiveScope);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8-25  Decorating a preexisting column with Eloquent accessors</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Model definition:</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Contact</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getNameAttribute</span><span class="params">($value)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $value ?: <span class="string">'(No name provided)'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8-26 Defining an attribute with no backing column using Eloquent accessors</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Model definition:</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Contact</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFullNameAttribute</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;first_name . <span class="string">' '</span> . <span class="keyword">$this</span>-&gt;last_name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Accessor usage:</span></span><br><span class="line">$fullName = $contact-&gt;full_name;</span><br></pre></td></tr></table></figure>
<p>8-27</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Defining the mutator</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Order</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setAmountAttribute</span><span class="params">($value)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;attributes[<span class="string">'amount'</span>] = $value &gt; <span class="number">0</span> ? $value : <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Using the mutator</span></span><br><span class="line">$order-&gt;amount = <span class="string">'15'</span>;</span><br></pre></td></tr></table></figure>
<p>8-28</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Order</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setWorkgroupNameAttribute</span><span class="params">($workgroupName)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;attributes[<span class="string">'email'</span>] = <span class="string">"&#123;$workgroupName&#125;@ourcompany.com"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8-29</p>
<figure class="highlight php"><figcaption><span>Using attribute casting on an Eloquent model</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Contact</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $casts = [</span><br><span class="line">        <span class="string">'vip'</span> =&gt; <span class="string">'boolean'</span>,</span><br><span class="line">        <span class="string">'children_names'</span> =&gt; <span class="string">'array'</span>,</span><br><span class="line">        <span class="string">'birthday'</span> =&gt; <span class="string">'date'</span>,</span><br><span class="line">    ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8-30</p>
<figure class="highlight php"><figcaption><span>Defining columns to be mutated as timestamps</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Contact</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $dates = [</span><br><span class="line">    <span class="string">'met_at'</span></span><br><span class="line">    ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8-31</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OrderCollection</span> <span class="keyword">extends</span> <span class="title">Collection</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sumBillableAmount</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;reduce(<span class="function"><span class="keyword">function</span> <span class="params">($carry, $order)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $carry + ($order-&gt;billable ? $order-&gt;amount : <span class="number">0</span>);</span><br><span class="line">        &#125;, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Order</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">newCollection</span><span class="params">(array $models = [])</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> OrderCollection($models);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>8-32 Returning JSON from routes directly</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// routes/web.php</span></span><br><span class="line">Route::get(<span class="string">'api/contacts'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Contact::all();</span><br><span class="line">&#125;);</span><br><span class="line">Route::get(<span class="string">'api/contacts/&#123;id&#125;'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Contact::findOrFail($id);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>8-33</p>
<figure class="highlight php"><figcaption><span>Defining a one-to-one relationship</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Contact</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">phoneNumber</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;hasOne(PhoneNumber::class);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>8-34 Defining a one-to-one relationship’s inverse</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PhoneNumber</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">contact</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;belongsTo(Contact::class);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>8-35</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">contacts</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;hasMany(Contact::class);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>8-36</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Contact</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">user</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;belongsTo(User::class);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>$donors = $user-&gt;contacts()-&gt;where(‘status’, ‘donor’)-&gt;get()</p>
<p>$postsWithComments = Post::has(‘comments’)-&gt;get()</p>
<p>$postsWithManyComments = Post::has(‘comments’, ‘&gt;=’, 5)-&gt;get();</p>
<p>// Gets all contacts with a phone number containing the string “867-5309”<br />
<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi><mi>e</mi><mi>n</mi><mi>n</mi><mi>y</mi><mi>I</mi><mi>G</mi><mi>o</mi><mi>t</mi><mi>Y</mi><mi>o</mi><mi>u</mi><mi>r</mi><mi>N</mi><mi>u</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mo>=</mo><mi>C</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>a</mi><mi>c</mi><mi>t</mi><mo>:</mo><mo>:</mo><mi>w</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>e</mi><mi>H</mi><mi>a</mi><mi>s</mi><msup><mo stretchy="false">(</mo><mo mathvariant="normal">′</mo></msup><mi>p</mi><mi>h</mi><mi>o</mi><mi>n</mi><mi>e</mi><mi>N</mi><mi>u</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><msup><mi>s</mi><mo mathvariant="normal">′</mo></msup><mo separator="true">,</mo><mi>f</mi><mi>u</mi><mi>n</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo stretchy="false">(</mo></mrow><annotation encoding="application/x-tex">jennyIGotYourNumber = Contact::whereHas(&#x27;phoneNumbers&#x27;, function (</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mord mathdefault">e</span><span class="mord mathdefault">n</span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mord mathdefault">G</span><span class="mord mathdefault">o</span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="mord mathdefault">o</span><span class="mord mathdefault">u</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord mathdefault">u</span><span class="mord mathdefault">m</span><span class="mord mathdefault">b</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mord mathdefault">t</span><span class="mord mathdefault">a</span><span class="mord mathdefault">c</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.001892em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord mathdefault">h</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="mord mathdefault">a</span><span class="mord mathdefault">s</span><span class="mopen"><span class="mopen">(</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord mathdefault">p</span><span class="mord mathdefault">h</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord mathdefault">u</span><span class="mord mathdefault">m</span><span class="mord mathdefault">b</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault">u</span><span class="mord mathdefault">n</span><span class="mord mathdefault">c</span><span class="mord mathdefault">t</span><span class="mord mathdefault">i</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mopen">(</span></span></span></span>query) {<br />
$query-&gt;where(‘number’, ‘like’, ‘%867-5309%’);<br />
});</p>
<p>8-37</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">phoneNumbers</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;hasManyThrough(PhoneNumber::class, Contact::class);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>8-38</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">contacts</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;belongsToMany(Contact::class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8-39</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Contact</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">users</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;belongsToMany(User::class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8-40</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$user = User::first();</span><br><span class="line">$user-&gt;contacts-&gt;each(<span class="function"><span class="keyword">function</span> <span class="params">($contact)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">&#125;);</span><br><span class="line">$contact = Contact::first();</span><br><span class="line">$contact-&gt;users-&gt;each(<span class="function"><span class="keyword">function</span> <span class="params">($user)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">&#125;);</span><br><span class="line">$donors = $user-&gt;contacts()-&gt;where(<span class="string">'status'</span>, <span class="string">'donor'</span>)-&gt;get();</span><br></pre></td></tr></table></figure>
<p>8-41</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">contacts</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;belongsToMany(Contact::class)</span><br><span class="line">        -&gt;withTimestamps()</span><br><span class="line">        -&gt;withPivot(<span class="string">'status'</span>, <span class="string">'preferred_greeting'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8-42</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$user = User::first();</span><br><span class="line">$user-&gt;contacts-&gt;each(<span class="function"><span class="keyword">function</span> <span class="params">($contact)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> sprintf(</span><br><span class="line">        <span class="string">'Contact associated with this user at: %s'</span>,</span><br><span class="line">        $contact-&gt;pivot-&gt;created_at</span><br><span class="line">    );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>8-43 Creating the models for a polymorphic starring system</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Star</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">starrable</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;morphsTo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Contact</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">stars</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;morphMany(Star::class, <span class="string">'starrable'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Event</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">stars</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;morphMany(Star::class, <span class="string">'starrable'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8-44 Retrieving the instances of a polymorphic relationship</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$contact = Contact::first();</span><br><span class="line">$contact-&gt;stars-&gt;each(<span class="function"><span class="keyword">function</span> <span class="params">($star)</span> </span>&#123;</span><br><span class="line"><span class="comment">// Do stuff</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>8-45</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$stars = Star::all();</span><br><span class="line">$stars-&gt;each(<span class="function"><span class="keyword">function</span> <span class="params">($star)</span> </span>&#123;</span><br><span class="line">    var_dump($star-&gt;starrable); <span class="comment">// An instance of Contact or Event</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>8-46</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Star</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">starrable</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;morphsTo;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">user</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;belongsTo(User::class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">stars</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;hasMany(Star::class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8-47</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Contact</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">tags</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;morphToMany(Tag::class, <span class="string">'taggable'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Event</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">tags</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;morphToMany(Tag::class, <span class="string">'taggable'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tag</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">contacts</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;morphedByMany(Contact::class, <span class="string">'taggable'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">events</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;morphedByMany(Event::class, <span class="string">'taggable'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8-48</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$contact = Contact::first();</span><br><span class="line">$contact-&gt;tags-&gt;each(<span class="function"><span class="keyword">function</span> <span class="params">($tag)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Do stuff</span></span><br><span class="line">&#125;);</span><br><span class="line">$tag = Tag::first();</span><br><span class="line">$tag-&gt;contacts-&gt;each(<span class="function"><span class="keyword">function</span> <span class="params">($contact)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Do stuff</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>8-49</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PhoneNumber</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $touches = [<span class="string">'contact'</span>];</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">contact</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;belongsTo(Contact::class);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>8-50</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$contacts = Contact::all();</span><br><span class="line"><span class="keyword">foreach</span> ($contacts <span class="keyword">as</span> $contact) &#123;</span><br><span class="line">    <span class="keyword">foreach</span> ($contact-&gt;phone_numbers <span class="keyword">as</span> $phone_number) &#123;</span><br><span class="line">        <span class="keyword">echo</span> $phone_number-&gt;number;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8-51</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppServiceProvider</span> <span class="keyword">extends</span> <span class="title">ServiceProvider</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $thirdPartyService = <span class="keyword">new</span> SomeThirdPartyService;</span><br><span class="line">            Contact::creating(<span class="function"><span class="keyword">function</span> <span class="params">($contact)</span> <span class="title">use</span> <span class="params">($thirdPartyService)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    $thirdPartyService-&gt;addContact($contact);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (<span class="keyword">Exception</span> $e) &#123;</span><br><span class="line">                    Log::error(<span class="string">'Failed adding contact to ThirdPartyService; cancelled.'</span>);</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>8-52</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_active_page_shows_active_and_not_inactive_contacts</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $activeContact = factory(Contact::class, <span class="string">'active'</span>)-&gt;create();</span><br><span class="line">    $inactiveContact = factory(Contact::class, <span class="string">'inactive'</span>)-&gt;create();</span><br><span class="line">    <span class="keyword">$this</span>-&gt;visit(<span class="string">'active-contacts'</span>)</span><br><span class="line">        -&gt;see($activeContact-&gt;name)</span><br><span class="line">        -&gt;dontSee($inactiveContact-&gt;name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8-53</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_contact_creation_works</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;post(<span class="string">'contacts'</span>, [</span><br><span class="line">    <span class="string">'email'</span> =&gt; <span class="string">'jim@bo.com'</span></span><br><span class="line">    ]);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;seeInDatabase(<span class="string">'contacts'</span>, [</span><br><span class="line">    <span class="string">'email'</span> =&gt; <span class="string">'jim@bo.com'</span></span><br><span class="line">    ]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8-54 Testing accessors, mutators, and scopes</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_full_name_accessor_works</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $contact = factory(Contact::class)-&gt;make([</span><br><span class="line">    <span class="string">'first_name'</span> =&gt; <span class="string">'Alphonse'</span>,</span><br><span class="line">    <span class="string">'last_name'</span> =&gt; <span class="string">'Cumberbund'</span></span><br><span class="line">    ]);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;assertEquals(<span class="string">'Alphonse Cumberbund'</span>, $contact-&gt;fullName);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_vip_scope_filters_out_non_vips</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $vip = factory(Contact::class, <span class="string">'vip'</span>)-&gt;create();</span><br><span class="line">    $nonVip = factory(Contact::class)-&gt;create();</span><br><span class="line">    $vips = Contact::vips()-&gt;get();</span><br><span class="line">    <span class="keyword">$this</span>-&gt;assertTrue($vips-&gt;contains([<span class="string">'id'</span> =&gt; $vip-&gt;id]));</span><br><span class="line">    <span class="keyword">$this</span>-&gt;assertFalse($vips-&gt;contains([<span class="string">'id'</span> =&gt; $nonVip-&gt;id]));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

        
    </section>
</article>


    <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            <a href="/2020/04/30/laravel-07/">laravel-07 Artisan 與 Tinker</a>
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="http://vince115.github.io/categories/backend/index.html">
    
    <i class="icon-calendar"></i>
    
    <time datetime="2020-04-30T05:25:59.000Z" itemprop="datePublished">2020-04-30</time>
</a>

            
<div class="article-tag-list">
    <i class="icon-tag"></i>
    <a class="article-tag-link" href="/tags/backend/" rel="tag">backend</a>, <a class="article-tag-link" href="/tags/laravel/" rel="tag">laravel</a>
</div>


        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <h3 id="artisan-簡介"><a class="markdownIt-Anchor" href="#artisan-簡介"></a> Artisan 簡介</h3>
<p>Artisan 是 Laravel 裡的一個指令列介面的名稱。<br />
當你在開發你的應用程式時，它提供了許多有用的指令來幫助你開發。它是基於由強大的 Symfony Console 元件來的。你可以使用 list 指令來列出所有可以使用的 Artisan 指令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan make:controller PostsController</span><br></pre></td></tr></table></figure>
<h3 id="基本artisan-命令"><a class="markdownIt-Anchor" href="#基本artisan-命令"></a> 基本Artisan 命令</h3>
<ul>
<li>help</li>
<li>clear-compiled</li>
<li>down</li>
<li>env</li>
<li>migrate</li>
<li>optimize</li>
<li>serve</li>
<li>thinker</li>
</ul>
<h4 id="選項"><a class="markdownIt-Anchor" href="#選項"></a> 選項</h4>
<ul>
<li>-q</li>
<li>-v、-vv、-vvv</li>
<li>–no-interaction</li>
<li>–php_environment</li>
<li>–version</li>
</ul>
<h4 id="群組化的命令"><a class="markdownIt-Anchor" href="#群組化的命令"></a> 群組化的命令</h4>
<ul>
<li>app</li>
<li>auth</li>
<li>cache</li>
<li>config</li>
<li>db</li>
<li>event</li>
<li>key</li>
<li>make</li>
<li>migrate</li>
<li>notifications</li>
<li>queue</li>
<li>route</li>
<li>schedule</li>
<li>session</li>
<li>Storage</li>
<li>vendor</li>
<li>view</li>
</ul>
<h4 id="編寫自訂的-artisan-命令"><a class="markdownIt-Anchor" href="#編寫自訂的-artisan-命令"></a> 編寫自訂的 Artisan 命令</h4>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan make:console WelcaomeNewUsers --command=email:newusers</span><br></pre></td></tr></table></figure>
<p>7-1 Artisan 命令的預設骨架</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Console</span>\<span class="title">Commands</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Console</span>\<span class="title">Command</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WelcomeNewUsers</span> <span class="keyword">extends</span> <span class="title">Command</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * The name and signature of the console command.</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@var</span> string</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">protected</span> $signature = <span class="string">'email:newusers'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * The console command description.</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@var</span> string</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">protected</span> $description = <span class="string">'Command description'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Create a new command instance.</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">parent</span>::__construct();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Execute the console command.</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>7-2 在主控台核心註冊新命令</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Kernel</span> <span class="keyword">extends</span> <span class="title">ConsoleKernel</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * The Artisan commands provided by your application.</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@var</span> array</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">protected</span> $commands = [</span><br><span class="line">        \App\Console\Commands\WelcomeNewUsers::class,</span><br><span class="line">    ];</span><br></pre></td></tr></table></figure>
<p>7-3 Artisan命令handle()方法範例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WelcomeNewUsers</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        User::signedUpThisWeek()-&gt;each(<span class="function"><span class="keyword">function</span> <span class="params">($user)</span> </span>&#123;</span><br><span class="line">            Mail::send(</span><br><span class="line">            <span class="string">'emails.welcome'</span>,</span><br><span class="line">            [<span class="string">'name'</span> =&gt; $user-&gt;name],</span><br><span class="line">            <span class="function"><span class="keyword">function</span> <span class="params">($m)</span> <span class="title">use</span> <span class="params">($user)</span> </span>&#123;</span><br><span class="line">                $m-&gt;to($user-&gt;email)-&gt;subject(<span class="string">'Welcome!'</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            );</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>7-4 重構一個命令</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WelcomeNewUsers</span> <span class="keyword">extends</span> <span class="title">Command</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(UserMailer $userMailer)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">parent</span>::__construct();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;userMailer = $userMailer</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;userMailer-&gt;welcomeNewUsers();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="引數與選項"><a class="markdownIt-Anchor" href="#引數與選項"></a> 引數與選項</h3>
<h4 id="引數-必要-選用與或-具有預設值"><a class="markdownIt-Anchor" href="#引數-必要-選用與或-具有預設值"></a> 引數、必要、選用與(或) 具有預設值</h4>
<p>password:reset {userId}<br />
password:reset {userId?}<br />
password:reset {userId=1}</p>
<h4 id="選項-必要的值-預設值與快捷方式"><a class="markdownIt-Anchor" href="#選項-必要的值-預設值與快捷方式"></a> 選項、必要的值、預設值，與快捷方式</h4>
<p>password:reset {userId} {–sendEmail}<br />
password:reset {userId} {–password=}<br />
password:reset {userId} {–queue=default}</p>
<h4 id="陣列引數與陣列選項"><a class="markdownIt-Anchor" href="#陣列引數與陣列選項"></a> 陣列引數與陣列選項</h4>
<p>password:reset {userIds*}<br />
password:reset {–ids=*}</p>
<p>7-5 使用Artisan命令與陣列語法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Argument</span></span><br><span class="line">php artisan password:reset <span class="number">1</span> <span class="number">2</span> <span class="number">3</span></span><br><span class="line"><span class="comment">// Option</span></span><br><span class="line">php artisan password:reset --ids=<span class="number">1</span> --ids=<span class="number">2</span> --ids=<span class="number">3</span></span><br></pre></td></tr></table></figure>
<h4 id="輸入說明"><a class="markdownIt-Anchor" href="#輸入說明"></a> 輸入說明</h4>
<p>7-6 為Artisan引數與選項定義說明文字</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> $signature = <span class="string">'password:reset</span></span><br><span class="line"><span class="string">                        &#123;userId : The ID of the user&#125;</span></span><br><span class="line"><span class="string">                        &#123;--sendEmail : Whether to send user an email&#125;'</span>;</span><br></pre></td></tr></table></figure>
<h4 id="使用輸入"><a class="markdownIt-Anchor" href="#使用輸入"></a> 使用輸入</h4>
<blockquote>
<p>argument()</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// with definition "password:reset &#123;userId&#125;":</span></span><br><span class="line">php artisan password:reset <span class="number">5</span></span><br><span class="line"><span class="comment">// $this-&gt;argument() returns this array</span></span><br><span class="line">[</span><br><span class="line">    <span class="string">"command"</span>: <span class="string">"password:reset"</span>,</span><br><span class="line">    <span class="string">"userId': "</span><span class="number">5</span><span class="string">",</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string">// $this-&gt;argument('userId') returns this string</span></span><br><span class="line"><span class="string">"</span><span class="number">5</span><span class="string">"</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>option()</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// with definition "password:reset &#123;--userId=&#125;":</span></span><br><span class="line">php artisan password:reset --userId=<span class="number">5</span></span><br><span class="line"><span class="comment">// $this-&gt;option() returns this array</span></span><br><span class="line">[</span><br><span class="line">    <span class="string">"userId"</span> =&gt; <span class="string">"5"</span></span><br><span class="line">    <span class="string">"help"</span> =&gt; <span class="keyword">false</span></span><br><span class="line">    <span class="string">"quiet"</span> =&gt; <span class="keyword">false</span></span><br><span class="line">    <span class="string">"verbose"</span> =&gt; <span class="keyword">false</span></span><br><span class="line">    <span class="string">"version"</span> =&gt; <span class="keyword">false</span></span><br><span class="line">    <span class="string">"ansi"</span> =&gt; <span class="keyword">false</span></span><br><span class="line">    <span class="string">"no-ansi"</span> =&gt; <span class="keyword">false</span></span><br><span class="line">    <span class="string">"no-interaction"</span> =&gt; <span class="keyword">false</span></span><br><span class="line">    <span class="string">"env"</span> =&gt; <span class="keyword">null</span></span><br><span class="line">]</span><br><span class="line"><span class="comment">// $this-&gt;option('userId') returns this string</span></span><br><span class="line"><span class="string">"5"</span></span><br></pre></td></tr></table></figure>
<p>7-6 從Artisan命令取得輸入</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// All arguments, including the command name</span></span><br><span class="line">$arguments = <span class="keyword">$this</span>-&gt;argument();</span><br><span class="line"><span class="comment">// Just the 'userId' argument</span></span><br><span class="line">$userid = <span class="keyword">$this</span>-&gt;argument(<span class="string">'userId'</span>);</span><br><span class="line"><span class="comment">// All options, including some defaults like 'no-interaction' and 'env'</span></span><br><span class="line">$options = <span class="keyword">$this</span>-&gt;option();</span><br><span class="line"><span class="comment">// Just the 'sendEmail' option</span></span><br><span class="line">$sendEmail = <span class="keyword">$this</span>-&gt;option(<span class="string">'sendEmail'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>7-7 從 Artisan 命令取得輸入</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// All arguments, including the command name</span></span><br><span class="line">$arguments = <span class="keyword">$this</span>-&gt;argument();</span><br><span class="line"><span class="comment">// Just the 'userId' argument</span></span><br><span class="line">$userid = <span class="keyword">$this</span>-&gt;argument(<span class="string">'userId'</span>);</span><br><span class="line"><span class="comment">// All options, including some defaults like 'no-interaction' and 'env'</span></span><br><span class="line">$options = <span class="keyword">$this</span>-&gt;option();</span><br><span class="line"><span class="comment">// Just the 'sendEmail' option</span></span><br><span class="line">$sendEmail = <span class="keyword">$this</span>-&gt;option(<span class="string">'sendEmail'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>提示</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ask()</span><br><span class="line">secret()</span><br><span class="line">comfirm()</span><br><span class="line">anticipate()</span><br><span class="line">choice()</span><br></pre></td></tr></table></figure>
<p>輸出</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">$this</span>-&gt;info(<span class="string">'Your command has run successfully.'</span>);</span><br></pre></td></tr></table></figure>
<p>表格輸出<br />
7-8 使用 Artisan 命令來輸出表格</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$headers = [<span class="string">'Name'</span>, <span class="string">'Email'</span>];</span><br><span class="line">$data = [</span><br><span class="line">[<span class="string">'Dhriti'</span>, <span class="string">'dhriti@amrit.com'</span>],</span><br><span class="line">[<span class="string">'Moses'</span>, <span class="string">'moses@gutierez.com'</span>]</span><br><span class="line">];</span><br><span class="line"><span class="comment">// Or, you could get similar data from the database:</span></span><br><span class="line"><span class="comment">// 或者，你可以從資料庫取得類似的資料</span></span><br><span class="line"><span class="comment">// $data = App\User::all(['name', 'email'])-&gt;toArray();</span></span><br><span class="line"><span class="keyword">$this</span>-&gt;table($headers, $data);</span><br></pre></td></tr></table></figure>
<p>7-9 Artisan 表格輸出範例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+---------+--------------------+</span><br><span class="line">| Name | Email |</span><br><span class="line">+---------+--------------------+</span><br><span class="line">| Dhriti | dhriti@amrit.com |</span><br><span class="line">| Moses | moses@gutierez.com |</span><br><span class="line">+---------+--------------------+</span><br></pre></td></tr></table></figure>
<p>7-10 Artisan 進度列範例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$totalUnits = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">$this</span>-&gt;output-&gt;progressStart($totalUnits);</span><br><span class="line"><span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; $totalUnits; $i++) &#123;</span><br><span class="line">    sleep(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;output-&gt;progressAdvance();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">$this</span>-&gt;output-&gt;progressFinish();</span><br></pre></td></tr></table></figure>
<p>在一般模式下呼叫Artisan命令<br />
7-11 從其他程式碼呼叫Artisan命令</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">'test-artisan'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    $exitCode = Artisan::call(<span class="string">'password:reset'</span>, [</span><br><span class="line">        <span class="string">'userId'</span> =&gt; <span class="number">15</span>, <span class="string">'--sendEmail'</span> =&gt; <span class="keyword">true</span></span><br><span class="line">    ]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>7-12 從其他的Artisan命令呼叫Artisan命令</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;callSilent(<span class="string">'password:reset'</span>, [</span><br><span class="line"><span class="string">'userId'</span> =&gt; <span class="number">15</span></span><br><span class="line">]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="thinker"><a class="markdownIt-Anchor" href="#thinker"></a> Thinker</h4>
<p>7-13 使用Thinker</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">php artisan tinker</span><br><span class="line">&gt;&gt;&gt; $user = <span class="keyword">new</span> App\User;</span><br><span class="line">=&gt; App\User: &#123;&#125;</span><br><span class="line">&gt;&gt;&gt; $user-&gt;email = <span class="string">'matt@mattstauffer.co'</span>;</span><br><span class="line">=&gt; <span class="string">"matt@mattstauffer.co"</span></span><br><span class="line">&gt;&gt;&gt; $user-&gt;password = bcrypt(<span class="string">'superSecret'</span>);</span><br><span class="line">=&gt; <span class="string">"$2y$10$TWPGBC7e8d1bvJ1q5kv.VDUGfYDnE9gANl4mleuB3htIY2dxcQfQ5"</span></span><br><span class="line">&gt;&gt;&gt; $user-&gt;save();</span><br><span class="line">=&gt; <span class="keyword">true</span></span><br></pre></td></tr></table></figure>
<p><a href="https://psysh.org/" target="_blank" rel="noopener">https://psysh.org/</a></p>
<h4 id="測試"><a class="markdownIt-Anchor" href="#測試"></a> 測試</h4>
<p>7-14 在測試程式中呼叫Artisan命令</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_empty_log_command_empties_logs_table</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">DB::table(<span class="string">'logs'</span>)-&gt;insert([<span class="string">'message'</span> =&gt; <span class="string">'Did something'</span>]);</span><br><span class="line">Artisan::call(<span class="string">'logs:empty'</span>);</span><br><span class="line"><span class="keyword">$this</span>-&gt;assertCount(<span class="number">0</span>, DB::table(<span class="string">'logs'</span>)-&gt;get());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>7-15 注入kernel，而非使用Artisan靜態介面</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Contracts</span>\<span class="title">Console</span>\<span class="title">Kernel</span>;</span><br><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NightlyCleanup</span> <span class="keyword">extends</span> <span class="title">Job</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span><span class="params">(Kernel $kernel)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// ... do other stuff</span></span><br><span class="line">        $kernel-&gt;call(<span class="string">'logs:empty'</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
        
    </section>
</article>


    <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            <a href="/2020/04/29/laravel-06/">laravel-06 收集與處理用戶資料</a>
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="http://vince115.github.io/categories/backend/index.html">
    
    <i class="icon-calendar"></i>
    
    <time datetime="2020-04-29T09:32:42.000Z" itemprop="datePublished">2020-04-29</time>
</a>

            
<div class="article-tag-list">
    <i class="icon-tag"></i>
    <a class="article-tag-link" href="/tags/backend/" rel="tag">backend</a>, <a class="article-tag-link" href="/tags/laravel/" rel="tag">laravel</a>
</div>


        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <h3 id="注入request物件"><a class="markdownIt-Anchor" href="#注入request物件"></a> 注入Request物件</h3>
<p>6-1 $request-&gt;all()</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- GET route form view at /get-route --&gt;</span><br><span class="line">&lt;form method=<span class="string">"post"</span> action=<span class="string">"/post-route?utm=12345"</span>&gt;</span><br><span class="line">    &#123;&#123; csrf_field() &#125;&#125;</span><br><span class="line">    &lt;input type=<span class="string">"text"</span> name=<span class="string">"firstName"</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">"submit"</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">Route::post(<span class="string">'/post-route'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Request $request)</span> </span>&#123;</span><br><span class="line">    var_dump($request-&gt;all());</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 輸出:</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* [</span></span><br><span class="line"><span class="comment">*   '_token' =&gt; 'CSRF token here',</span></span><br><span class="line"><span class="comment">*   'firstName' =&gt; 'value',</span></span><br><span class="line"><span class="comment">*   'utm' =&gt; 12345</span></span><br><span class="line"><span class="comment">* ]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>6-2 $request-&gt;except()</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Route::post(<span class="string">'/post-route'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Request $request)</span> </span>&#123;</span><br><span class="line">var_dump($request-&gt;except(<span class="string">'_token'</span>));</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// Outputs:</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* [</span></span><br><span class="line"><span class="comment">*   'firstName' =&gt; 'value',</span></span><br><span class="line"><span class="comment">*   'utm' =&gt; 12345</span></span><br><span class="line"><span class="comment">* ]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>6-3 $request-&gt;except()</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Route::post(<span class="string">'/post-route'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Request $request)</span> </span>&#123;</span><br><span class="line">var_dump($request-&gt;only([<span class="string">'firstName'</span>, <span class="string">'utm'</span>]));</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// Outputs:</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* [</span></span><br><span class="line"><span class="comment">*   'firstName' =&gt; 'value',</span></span><br><span class="line"><span class="comment">*   'utm' =&gt; 12345</span></span><br><span class="line"><span class="comment">* ]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h4 id="request-has-與-request-exists"><a class="markdownIt-Anchor" href="#request-has-與-request-exists"></a> $request-&gt;has() 與 $request-&gt;exists()</h4>
<p>6-4 $request-&gt;has()</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// POST route 的post路由</span></span><br><span class="line"><span class="keyword">if</span> ($request-&gt;has(<span class="string">'utm'</span>)) &#123;</span><br><span class="line">    <span class="comment">// 作一些分析工作</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="request-input"><a class="markdownIt-Anchor" href="#request-input"></a> $request-&gt;input()</h4>
<p>6-5 $request-&gt;input()</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::post(<span class="string">'/post-route'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Request $request)</span> </span>&#123;</span><br><span class="line">    $userName = $request-&gt;input(<span class="string">'name'</span>, <span class="string">'(anonymous)'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="request-input-2"><a class="markdownIt-Anchor" href="#request-input-2"></a> $request-&gt;input()</h4>
<p>6-6 取得用戶的陣列值的句點標記法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- GET route form view at /get-route 路由表單視圖--&gt;</span><br><span class="line">&lt;form method=<span class="string">"post"</span> action=<span class="string">"/post-route"</span>&gt;</span><br><span class="line">    &#123;&#123; csrf_field() &#125;&#125;</span><br><span class="line">    &lt;input type=<span class="string">"text"</span> name=<span class="string">"employees[0][firstName]"</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">"text"</span> name=<span class="string">"employees[0][lastName]"</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">"text"</span> name=<span class="string">"employees[1][firstName]"</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">"text"</span> name=<span class="string">"employees[1][lastName]"</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">"submit"</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"><span class="comment">// post-route的POST路由</span></span><br><span class="line">Route::post(<span class="string">'/post-route'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Request $request)</span> </span>&#123;</span><br><span class="line">    $employeeZeroFirstName = $request-&gt;input(<span class="string">'employees.0.firstName'</span>);</span><br><span class="line">    $allLastNames = $request-&gt;input(<span class="string">'employees.*.lastName'</span>);</span><br><span class="line">    $employeeOne = $request-&gt;input(<span class="string">'employees.1'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 如果表單被填為 "Jim" "Smith" "Bob" "Jones":</span></span><br><span class="line"><span class="comment">// $employeeZeroFirstName = 'Jim';</span></span><br><span class="line"><span class="comment">// $allLastNames = ['Smith', 'Jones'];</span></span><br><span class="line"><span class="comment">// $employeeOne = ['firstName' =&gt; 'Bob', 'lastName' =&gt; 'Jones']</span></span><br></pre></td></tr></table></figure>
<h4 id="json-輸入與request-json"><a class="markdownIt-Anchor" href="#json-輸入與request-json"></a> JSON 輸入(與$request-&gt;json())</h4>
<p>6-7 使用$request-&gt;input()來從JSON取得資料</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">POST /post-route HTTP/<span class="number">1.1</span></span><br><span class="line">Content-Type: application/json</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"firstName"</span>: <span class="string">"Joe"</span>,</span><br><span class="line">    <span class="string">"lastName"</span>: <span class="string">"Schmoe"</span>,</span><br><span class="line">    <span class="string">"spouse"</span>: &#123;</span><br><span class="line">    <span class="string">"firstName"</span>: <span class="string">"Jill"</span>,</span><br><span class="line">    <span class="string">"lastName"</span>:<span class="string">"Schmoe"</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// post-路由</span></span><br><span class="line">Route::post(<span class="string">'post-route'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Request $request)</span> </span>&#123;</span><br><span class="line">    $firstName = $request-&gt;input(<span class="string">'firstName'</span>);</span><br><span class="line">    $spouseFirstname = $request-&gt;input(<span class="string">'spouse.firstName'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="路由資料"><a class="markdownIt-Anchor" href="#路由資料"></a> 路由資料</h3>
<h4 id="從request"><a class="markdownIt-Anchor" href="#從request"></a> 從Request</h4>
<h4 id="從路由參數"><a class="markdownIt-Anchor" href="#從路由參數"></a> 從路由參數</h4>
<p>6-8 從路由參數取得URL詳細資訊</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">// routes/web.php</span></span><br><span class="line">    Route::get(<span class="string">'users/&#123;id&#125;'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($id)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// If the user visits myapp.com/users/15/, $id will equal 15</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="上傳的檔案"><a class="markdownIt-Anchor" href="#上傳的檔案"></a> 上傳的檔案</h3>
<p>6-9 上傳檔案的表單</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;form method=<span class="string">"post"</span> enctype=<span class="string">"multipart/form-data"</span>&gt;</span><br><span class="line">    &#123;&#123; csrf_field() &#125;&#125;</span><br><span class="line">    &lt;input type=<span class="string">"text"</span> name=<span class="string">"name"</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">"file"</span> name=<span class="string">"profile_picture"</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">"submit"</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>
<p>6-10 提交範例6-9的表單產生的輸出</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Route::post(<span class="string">'form'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Request $request)</span> </span>&#123;</span><br><span class="line">    var_dump($request-&gt;all());</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line"><span class="comment">// [</span></span><br><span class="line"><span class="comment">// "_token" =&gt; "token here"</span></span><br><span class="line"><span class="comment">// "name" =&gt; "asdf"</span></span><br><span class="line"><span class="comment">// "profile_picture" =&gt; UploadedFile &#123;&#125;</span></span><br><span class="line"><span class="comment">// ]</span></span><br><span class="line">Route::post(<span class="string">'form'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Request $request)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ($request-&gt;hasFile(<span class="string">'profile_picture'</span>)) &#123;</span><br><span class="line">        var_dump($request-&gt;file(<span class="string">'profile_picture'</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line"><span class="comment">// UploadedFile (details)</span></span><br></pre></td></tr></table></figure>
<p>6-11 常見的檔案上傳流程</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ($request-&gt;hasFile(<span class="string">'profile_picture'</span>)) &#123;</span><br><span class="line">    $path = $request-&gt;profile_picture-&gt;store(<span class="string">'profiles'</span>, <span class="string">'s3'</span>);</span><br><span class="line">    auth()-&gt;user()-&gt;profile_picture = $path;</span><br><span class="line">    auth()-&gt;user()-&gt;save();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="驗證"><a class="markdownIt-Anchor" href="#驗證"></a> 驗證</h3>
<h4 id="在控制器內使用validatesrequests的validate"><a class="markdownIt-Anchor" href="#在控制器內使用validatesrequests的validate"></a> 在控制器內使用ValidatesRequests的validate()</h4>
<p>6-12 控制器驗證基本用法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//routes/web.php</span></span><br><span class="line">Route::get(<span class="string">'recipes/create'</span>,<span class="string">'RecipesController@create'</span>);</span><br><span class="line">Route::post(<span class="string">'recipes'</span>,<span class="string">'RecipesController@store'</span>);</span><br></pre></td></tr></table></figure>
<p>6-13 手動驗證</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">'recipes/create'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> view(<span class="string">'recipes.create'</span>);</span><br><span class="line">&#125;);</span><br><span class="line">Route::post(<span class="string">'recipes'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Illuminate\Http\Request $request)</span> </span>&#123;</span><br><span class="line">$validator = Validator::make($request-&gt;all(), [</span><br><span class="line">    <span class="string">'title'</span> =&gt; <span class="string">'required|unique:recipes|max:125'</span>,</span><br><span class="line">    <span class="string">'body'</span> =&gt; <span class="string">'required'</span></span><br><span class="line">]);</span><br><span class="line"><span class="keyword">if</span> ($validator-&gt;fails()) &#123;</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">'recipes/create'</span>)</span><br><span class="line">    -&gt;withErrors($validator)</span><br><span class="line">    -&gt;withInput();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Recipe is valid; proceed to save it</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>6-14 Echo驗證錯誤</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">if</span> ($errors-&gt;any())</span><br><span class="line">    &lt;ul id=<span class="string">"errors"</span>&gt;</span><br><span class="line">        @<span class="keyword">foreach</span> ($errors-&gt;all() <span class="keyword">as</span> $error)</span><br><span class="line">            &lt;li&gt;&#123;&#123; $error &#125;&#125;&lt;/li&gt;</span><br><span class="line">        @<span class="keyword">endforeach</span></span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">@<span class="keyword">endif</span></span><br></pre></td></tr></table></figure>
<p>6-15 表單請求範例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Requests</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">BlogPost</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Requests</span>\<span class="title">Request</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CreateCommentRequest</span> <span class="keyword">extends</span> <span class="title">Request</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">rules</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">        <span class="string">'body'</span> =&gt; <span class="string">'required|max:1000'</span></span><br><span class="line">        ];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">authorize</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $blogPostId = <span class="keyword">$this</span>-&gt;route(<span class="string">'blogPost'</span>);</span><br><span class="line">        <span class="keyword">return</span> auth()-&gt;check() &amp;&amp; BlogPost::where(<span class="string">'id'</span>, $blogPostId)</span><br><span class="line">            -&gt;where(<span class="string">'user_id'</span>, auth()-&gt;user()-&gt;id)-&gt;exists();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>6-16 使用表單請求</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::post(<span class="string">'comments'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(App\Http\Requests\CreateCommentRequest $request)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Store comment 儲存評論</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>6-17 將整個表單傳遞給Eloquent模型</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::post(<span class="string">'posts'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Request $request)</span> </span>&#123;</span><br><span class="line">$newPost = Post::create($request-&gt;all());</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>6-18 讓Eloquent模型免於遭受惡意大量賦值</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Post</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// Disable mass assignment on the author_id field</span></span><br><span class="line">    <span class="keyword">protected</span> $guarded = [<span class="string">'author_id'</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>使用$request-&gt;only()來雙重保護</p>
</blockquote>
<p>6-19 測試被注入的非法輸入</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_input_missing_a_title_is_rejected</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;post(<span class="string">'posts'</span>, [<span class="string">'body'</span> =&gt; <span class="string">'This is the body of my post'</span>]);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;assertRedirectedTo(<span class="string">'posts/create'</span>);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;assertSessionHasErrors();</span><br><span class="line">    <span class="keyword">$this</span>-&gt;assertHasOldInput();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>6-20 測試有效的輸入已被處理</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_valid_input_should_create_a_post_in_the_database</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;post(<span class="string">'posts'</span>, [<span class="string">'title'</span> =&gt; <span class="string">'Post Title'</span>, <span class="string">'body'</span> =&gt; <span class="string">'This is the body'</span>]);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;seeInDatabase([<span class="string">'title'</span> =&gt; <span class="string">'Post Title'</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        
    </section>
</article>


    <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            <a href="/2020/04/29/laravel-05/">laravel-05 前端元件</a>
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="http://vince115.github.io/categories/backend/index.html">
    
    <i class="icon-calendar"></i>
    
    <time datetime="2020-04-29T00:31:42.000Z" itemprop="datePublished">2020-04-29</time>
</a>

            
<div class="article-tag-list">
    <i class="icon-tag"></i>
    <a class="article-tag-link" href="/tags/backend/" rel="tag">backend</a>, <a class="article-tag-link" href="/tags/laravel/" rel="tag">laravel</a>
</div>


        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <h3 id="elixir"><a class="markdownIt-Anchor" href="#elixir"></a> Elixir</h3>
<p>Laravel Elixir 提供了簡潔流暢的 API，讓你能夠為你的 Laravel 應用程式定義基本的 Gulp 任務。Elixir 支援許多常見的 CSS 與 JavaScrtip 預處理器，甚至包含了測試工具。<br />
<a href="https://laravel.tw/docs/5.0/elixir" target="_blank" rel="noopener">https://laravel.tw/docs/5.0/elixir</a></p>
<p>5-1 在Gulp編輯Sass檔案</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gulp = <span class="keyword">require</span>(<span class="string">'gulp'</span>),</span><br><span class="line">sass = <span class="keyword">require</span>(<span class="string">'gulp-ruby-sass'</span>),</span><br><span class="line">autoprefixer = <span class="keyword">require</span>(<span class="string">'gulp-autoprefixer'</span>),</span><br><span class="line">rename = <span class="keyword">require</span>(<span class="string">'gulp-rename'</span>),</span><br><span class="line">notify = <span class="keyword">require</span>(<span class="string">'gulp-notify'</span>),</span><br><span class="line">livereload = <span class="keyword">require</span>(<span class="string">'gulp-livereload'</span>),</span><br><span class="line">lr = <span class="keyword">require</span>(<span class="string">'tiny-lr'</span>),</span><br><span class="line">server = lr();</span><br><span class="line">gulp.task(<span class="string">'sass'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> gulp.src(<span class="string">'resources/assets/sass/app.scss'</span>)</span><br><span class="line">.pipe(sass(&#123;</span><br><span class="line">style: <span class="string">'compressed'</span>,</span><br><span class="line">sourcemap: <span class="keyword">true</span></span><br><span class="line">&#125;))</span><br><span class="line">.pipe(autoprefixer(<span class="string">'last 2 version'</span>, <span class="string">'ie 9'</span>, <span class="string">'ios 6'</span>))</span><br><span class="line">.pipe(gulp.dest(<span class="string">'public/css'</span>))</span><br><span class="line">.pipe(rename(&#123;suffix: <span class="string">'.min'</span>&#125;))</span><br><span class="line">.pipe(livereload(server))</span><br><span class="line">.pipe(notify(&#123;</span><br><span class="line">title: <span class="string">"Karani"</span>,</span><br><span class="line">message: <span class="string">"Styles task complete."</span></span><br><span class="line">&#125;));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>5-2 用Elixir來編輯Sass檔案</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> elixir = <span class="keyword">require</span>(<span class="string">'laravel-elixir'</span>);</span><br><span class="line">elixir(<span class="function"><span class="keyword">function</span> <span class="params">(mix)</span> </span>&#123;</span><br><span class="line">mix.sass(<span class="string">'app.scss'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>ES6 IN ELIXIR 6</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> elixir = <span class="keyword">require</span>(<span class="string">'laravel-elixir'</span>);</span><br><span class="line">elixir(mix =&gt; &#123;</span><br><span class="line">mix.sass(<span class="string">'app.scss'</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="elixir-資料夾"><a class="markdownIt-Anchor" href="#elixir-資料夾"></a> Elixir 資料夾</h4>
<h4 id="elixir-資料夾結構"><a class="markdownIt-Anchor" href="#elixir-資料夾結構"></a> Elixir 資料夾結構</h4>
<h4 id="elixir-提供什麼功能"><a class="markdownIt-Anchor" href="#elixir-提供什麼功能"></a> Elixir 提供什麼功能？</h4>
<h4 id="-production-旗標"><a class="markdownIt-Anchor" href="#-production-旗標"></a> -production 旗標</h4>
<h4 id="傳遞多個檔案"><a class="markdownIt-Anchor" href="#傳遞多個檔案"></a> 傳遞多個檔案</h4>
<p>5-3 用Elixir來編譯多個檔案</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> elixir = <span class="keyword">require</span>(<span class="string">'laravel-elixir'</span>);</span><br><span class="line">elixir(mix =&gt; &#123;</span><br><span class="line">mix.sass([</span><br><span class="line"><span class="string">'app.scss'</span>,</span><br><span class="line"><span class="string">'public.scss'</span></span><br><span class="line">]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="來源對應"><a class="markdownIt-Anchor" href="#來源對應"></a> 來源對應</h4>
<p>5-4 停用Elixir的來源對應</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> elixir = <span class="keyword">require</span>(<span class="string">'laravel-elixir'</span>);</span><br><span class="line">elixir.config.sourcemaps = <span class="keyword">false</span>;</span><br><span class="line">elixir(mix =&gt; &#123;</span><br><span class="line">mix.sass(<span class="string">'app.scss'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="無前置處理的css"><a class="markdownIt-Anchor" href="#無前置處理的css"></a> 無前置處理的CSS</h4>
<p>5-5 使用Elixir來結合樣式表</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> elixir = <span class="keyword">require</span>(<span class="string">'laravel-elixir'</span>);</span><br><span class="line"></span><br><span class="line">elixir(mix =&gt; &#123;</span><br><span class="line"><span class="comment">// 結合 resources/assets/css 與子目錄的所有檔案</span></span><br><span class="line">mix.styles();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 結合 resources/assets/css 的檔案</span></span><br><span class="line">mix.styles([</span><br><span class="line"><span class="string">'normalize.css'</span>,</span><br><span class="line"><span class="string">'app.css'</span></span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 結合其他目錄的所有樣式</span></span><br><span class="line">mix.stylesIn(<span class="string">'resources/some/other/css/directory'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 結合 resources/assets/css 內指定的樣式</span></span><br><span class="line"><span class="comment">// 並輸出置一個自訂的目錄</span></span><br><span class="line">mix.styles([</span><br><span class="line"><span class="string">'normalize.css'</span>,</span><br><span class="line"><span class="string">'app.css'</span></span><br><span class="line">], <span class="string">'public/other/css/output.css'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 結合自訂目錄指定樣式</span></span><br><span class="line"><span class="comment">// 並輸出至一個自訂的目錄</span></span><br><span class="line">mix.styles([</span><br><span class="line"><span class="string">'normalize.css'</span>,</span><br><span class="line"><span class="string">'app.css'</span></span><br><span class="line">], <span class="string">'public/other/css/output.css'</span>, <span class="string">'resources/some/other/css/directory'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="串接javascript"><a class="markdownIt-Anchor" href="#串接javascript"></a> 串接JavaScript</h4>
<p>5-6 使用Elixir來結合JavaScript檔案</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> elixir = <span class="keyword">require</span>(<span class="string">'laravel-elixir'</span>);</span><br><span class="line">elixir(mix =&gt; &#123;</span><br><span class="line"><span class="comment">// 結合 resources/assets/js　的檔案</span></span><br><span class="line">mix.scripts([</span><br><span class="line"><span class="string">'jquery.js'</span>,</span><br><span class="line"><span class="string">'app.js'</span></span><br><span class="line">]);</span><br><span class="line"><span class="comment">// 結合其他目錄的所有腳本</span></span><br><span class="line">mix.scriptsIn(<span class="string">'resources/some/other/js/directory'</span>);</span><br><span class="line"><span class="comment">// 結合resources/assets/js的指定腳本</span></span><br><span class="line"><span class="comment">// 並輸出至一個自訂的目錄</span></span><br><span class="line">mix.scripts([</span><br><span class="line"><span class="string">'jquery.js'</span>,</span><br><span class="line"><span class="string">'app.js'</span></span><br><span class="line">], <span class="string">'public/other/js/output.js'</span>);</span><br><span class="line"><span class="comment">// 結合自訂目錄的指定腳本</span></span><br><span class="line"><span class="comment">// 並輸出至一個自訂的目錄</span></span><br><span class="line">mix.scripts([</span><br><span class="line"><span class="string">'jquery.js'</span>,</span><br><span class="line"><span class="string">'app.js'</span></span><br><span class="line">], <span class="string">'public/other/js/output.js'</span>, <span class="string">'resources/some/other/js/directory'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="預先處理javascript"><a class="markdownIt-Anchor" href="#預先處理javascript"></a> 預先處理JavaScript</h4>
<p>5-7 在Elixir中使用Webpack或Rollup來處理JavaScript檔案</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">elixir(<span class="function"><span class="keyword">function</span><span class="params">(mix)</span> </span>&#123;</span><br><span class="line">mix.webpack(<span class="string">'app.js'</span>);</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line">mix.rollup(<span class="string">'app.js'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="版本控制"><a class="markdownIt-Anchor" href="#版本控制"></a> 版本控制</h4>
<p>5-8 mix.version</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> elixir = <span class="keyword">require</span>(<span class="string">'laravel-elixir'</span>);</span><br><span class="line">elixir(mix =&gt; &#123;</span><br><span class="line">mix.version(<span class="string">'public/css/all.css'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>5-9 在視圖中使用elixir()輔助函式</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;link rel=<span class="string">"stylesheet"</span> href=<span class="string">"&#123;&#123; elixir("</span>css/all.css<span class="string">") &#125;&#125;"</span>&gt;</span><br><span class="line"><span class="comment">// will output something like:</span></span><br><span class="line">&lt;link rel=<span class="string">"stylesheet"</span> href=<span class="string">"/build/css/all-84fa1258.css"</span>&gt;</span><br></pre></td></tr></table></figure>
<p>####　Elixir 擴展</p>
<p>5-10 在Elixir中使用Gulp工作</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定義工作</span></span><br><span class="line">gulp.task(<span class="string">"log"</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">var</span> message = <span class="string">"Something happened"</span>;</span><br><span class="line">gulp.src(<span class="string">""</span>).pipe(shell(<span class="string">'echo "'</span> + message + <span class="string">'" &gt;&gt; file.log'</span>));</span><br><span class="line">&#125;);</span><br><span class="line">elixir(mix =&gt; &#123;</span><br><span class="line"><span class="comment">//在Elixir中使用工作</span></span><br><span class="line">mix.task(<span class="string">'log'</span>);</span><br><span class="line"><span class="comment">// 綁定工作，讓它在每次有某些檔案改變時執行</span></span><br><span class="line">mix.task(<span class="string">'log'</span>, <span class="string">'resources/somefiles/to/watch/**/*'</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>5-11 建立Elixir擴展</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在gulpfile.js內，或在外部檔案require gulpfile.js</span></span><br><span class="line"><span class="keyword">var</span> gulp = <span class="keyword">require</span>(<span class="string">"gulp"</span>),</span><br><span class="line">shell = <span class="keyword">require</span>(<span class="string">"gulp-shell"</span>),</span><br><span class="line">elixir = <span class="keyword">require</span>(<span class="string">"laravel-elixir"</span>);</span><br><span class="line">elixir.extend(<span class="string">"log"</span>, <span class="function"><span class="keyword">function</span> <span class="params">(message)</span> </span>&#123;</span><br><span class="line"><span class="keyword">new</span> Task(<span class="string">'log'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> gulp.src(<span class="string">''</span>).pipe(shell(<span class="string">'echo "'</span> + message + <span class="string">'" &gt;&gt; file.log'</span>));</span><br><span class="line">&#125;)</span><br><span class="line">.watch(<span class="string">'./resources/some/files/**/*'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>5-12 對查詢產生器的回應進行分頁</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> view(<span class="string">'posts.index'</span>, [<span class="string">'posts'</span> =&gt; DB::table(<span class="string">'posts'</span>)-&gt;paginate(<span class="number">20</span>)]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>5-13 在模板中顯示分頁連結</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;table&gt;</span><br><span class="line">@<span class="keyword">foreach</span> ($posts <span class="keyword">as</span> $post)</span><br><span class="line">&lt;tr&gt;&lt;td&gt;&#123;&#123; $post-&gt;title &#125;&#125;&lt;/td&gt;&lt;/tr&gt;</span><br><span class="line">@<span class="keyword">endforeach</span></span><br><span class="line">&lt;/table&gt;</span><br><span class="line">&#123;&#123; $posts-&gt;links() &#125;&#125;</span><br><span class="line"><span class="comment">// 在預設情況下, $posts-&gt;links() 會輸出如下:</span></span><br><span class="line">&lt;ul class="pagination"&gt;</span><br><span class="line">&lt;li class="disabled"&gt;&lt;span&gt;&amp;laquo;&lt;/span&gt;&lt;/li&gt;</span><br><span class="line">&lt;li class="active"&gt;&lt;span&gt;1&lt;/span&gt;&lt;/li&gt;</span><br><span class="line">&lt;li&gt;&lt;a href=<span class="string">"http://myapp.com/posts?page=2"</span>&gt;<span class="number">2</span>&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">&lt;li&gt;&lt;a href=<span class="string">"http://myapp.com/posts?page=3"</span>&gt;<span class="number">3</span>&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">&lt;li&gt;&lt;a href=<span class="string">"http://myapp.com/posts?page=2"</span> rel=<span class="string">"next"</span>&gt;&amp;raquo;&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure>
<p>手動建立分頁器<br />
5-14 在Laravel 5.2與5.3手動建立分頁器</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Pagination</span>\<span class="title">Paginator</span>;</span><br><span class="line">Route::get(<span class="string">'people'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Request $request)</span> </span>&#123;</span><br><span class="line">$people = [...]; <span class="comment">// huge list of people</span></span><br><span class="line">$perPage = <span class="number">15</span>;</span><br><span class="line">$offsetPages = $request-&gt;input(<span class="string">'page'</span>, <span class="number">1</span>) - <span class="number">1</span>;</span><br><span class="line"><span class="comment">// The Paginator will not slice your array for you</span></span><br><span class="line">$people = array_slice(</span><br><span class="line">$people,</span><br><span class="line">$offsetPages * $perPage,</span><br><span class="line">$perPage</span><br><span class="line">);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> Paginator(</span><br><span class="line">$people,</span><br><span class="line">$perPage</span><br><span class="line">);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>訊息袋<br />
5-15 手動建立與使用MessageBag</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$messages = [</span><br><span class="line"><span class="string">'errors'</span> =&gt; [</span><br><span class="line"><span class="string">'Something went wrong with edit 1!'</span></span><br><span class="line">],</span><br><span class="line"><span class="string">'messages'</span> =&gt; [</span><br><span class="line"><span class="string">'Edit 2 was successful.'</span></span><br><span class="line">]</span><br><span class="line">];</span><br><span class="line">$messagebag = <span class="keyword">new</span> \Illuminate\Support\MessageBag($messages);</span><br><span class="line"><span class="comment">// Check for errors; if there are any, decorate and echo</span></span><br><span class="line"><span class="keyword">if</span> ($messagebag-&gt;has(<span class="string">'errors'</span>)) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;ul id="errors"&gt;'</span>;</span><br><span class="line"><span class="keyword">foreach</span> ($messagebag-&gt;get(<span class="string">'errors'</span>, <span class="string">'&lt;li&gt;&lt;b&gt;:message&lt;/b&gt;&lt;/li&gt;'</span>) <span class="keyword">as</span> $error) &#123;</span><br><span class="line"><span class="keyword">echo</span> $error;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;/ul&gt;'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>5-16 錯誤袋程式片段</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// partials/errors.blade.php</span></span><br><span class="line">@<span class="keyword">if</span> ($errors-&gt;any())</span><br><span class="line">&lt;div class="alert alert-danger"&gt;</span><br><span class="line">&lt;ul&gt;</span><br><span class="line">@<span class="keyword">foreach</span> ($errors <span class="keyword">as</span> $error)</span><br><span class="line">&lt;li&gt;&#123;&#123; $error &#125;&#125;&lt;/li&gt;</span><br><span class="line">@<span class="keyword">endforeach</span></span><br><span class="line">&lt;/ul&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">@<span class="keyword">endif</span></span><br></pre></td></tr></table></figure>
<p>5-17 trans()基本用法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 一般的 PHP</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> trans(<span class="string">'navigation.back'</span>); <span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">// Blade</span></span><br><span class="line">&#123;&#123; trans(<span class="string">'navigation.back'</span>) &#125;&#125;</span><br><span class="line"><span class="comment">// Blade 指令</span></span><br><span class="line">@lang(<span class="string">'navigation.back'</span>)</span><br></pre></td></tr></table></figure>
<p>5-18 使用翻譯</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// resources/lang/es/navigation.php</span></span><br><span class="line"><span class="keyword">return</span> [</span><br><span class="line"><span class="string">'back'</span> =&gt; <span class="string">'Volver al panel'</span></span><br><span class="line">];</span><br><span class="line"><span class="comment">// routes/web.php</span></span><br><span class="line">Route::get(<span class="string">'/es/contacts/show/:id'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// Setting it manually, for this example, instead of in a service provider</span></span><br><span class="line">App::setLocale(<span class="string">'es'</span>);</span><br><span class="line"><span class="keyword">return</span> view(<span class="string">'contacts.show'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// resources/views/contacts/show.blade.php</span></span><br><span class="line">&lt;a href=<span class="string">"/contacts"</span>&gt;&#123;&#123; trans(<span class="string">'navigation.back'</span>) &#125;&#125;&lt;/a&gt;</span><br></pre></td></tr></table></figure>
<p>5-19 翻譯的參數</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// resources/lang/en/navigation.php</span></span><br><span class="line"><span class="keyword">return</span> [</span><br><span class="line"><span class="string">'back'</span> =&gt; <span class="string">'Back to :section dashbaord'</span></span><br><span class="line">];</span><br><span class="line"><span class="comment">// resources/views/contacts/show.blade.php</span></span><br><span class="line">&#123;&#123; trans(<span class="string">'navigation.back'</span>, [<span class="string">'section'</span> =&gt; <span class="string">'contacts'</span>]) &#125;&#125;</span><br></pre></td></tr></table></figure>
<p>5-20 使用複數化選項來定義簡單的翻譯</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// resources/lang/en/messages.php</span></span><br><span class="line"><span class="keyword">return</span> [</span><br><span class="line"><span class="string">'task-deletion'</span> =&gt; <span class="string">'You have deleted a task|You have successfully deleted tasks'</span></span><br><span class="line">];</span><br><span class="line"><span class="comment">// resources/views/dashboard.blade.php</span></span><br><span class="line">@<span class="keyword">if</span> ($numTasksDeleted &gt; <span class="number">0</span>)</span><br><span class="line">&#123;&#123; trans_choice(<span class="string">'messages.task-deletion'</span>, $numTasksDeleted) &#125;&#125;</span><br><span class="line">@<span class="keyword">endif</span></span><br></pre></td></tr></table></figure>
<p>5-21 使用Symfony的翻譯元件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// resources/lang/es/messages.php</span></span><br><span class="line"><span class="keyword">return</span> [</span><br><span class="line"><span class="string">'task-deletion'</span>=&gt;<span class="string">"&#123;0&#125;  You didn't manage to delete any tasks. |"</span> </span><br><span class="line">  <span class="string">"[1,4] You deleted a few tasks.|"</span> . </span><br><span class="line">  <span class="string">"[5,Inf] You deleted a whole ton of tasks."</span></span><br></pre></td></tr></table></figure>
<h4 id="測試訊息與錯誤袋"><a class="markdownIt-Anchor" href="#測試訊息與錯誤袋"></a> 測試訊息與錯誤袋</h4>
<p>5-22 判斷session有沒有錯誤</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_missing_email_field_errors</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;post(<span class="string">'person/create'</span>, [<span class="string">'name'</span> =&gt; <span class="string">'Japheth'</span>]);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;assertSessionHasErrors([<span class="string">'email'</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        
    </section>
</article>


    <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            <a href="/2020/04/28/laravel-04/">laravel-04 板模</a>
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="http://vince115.github.io/categories/backend/index.html">
    
    <i class="icon-calendar"></i>
    
    <time datetime="2020-04-28T03:49:25.000Z" itemprop="datePublished">2020-04-28</time>
</a>

            
<div class="article-tag-list">
    <i class="icon-tag"></i>
    <a class="article-tag-link" href="/tags/backend/" rel="tag">backend</a>, <a class="article-tag-link" href="/tags/laravel/" rel="tag">laravel</a>
</div>


        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <h3 id="blade模版"><a class="markdownIt-Anchor" href="#blade模版"></a> Blade模版</h3>
<p>4-1 Blade 範例</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123;$group-&gt;title&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">&#123;!! $group-&gt;heroImageHtml()!!&#125;</span><br><span class="line">@forelse($users as $user)</span><br><span class="line">??&#123;&#123;$user-&gt;frist_name&#125;&#125;&#123;&#123;$user-&gt;last_name&#125;&#125;<span class="tag">&lt;<span class="name">br</span>&gt;</span> </span><br><span class="line">@empty</span><br><span class="line">No users in this group.</span><br><span class="line">@endforelse</span><br></pre></td></tr></table></figure>
<h3 id="回應資料"><a class="markdownIt-Anchor" href="#回應資料"></a> 回應資料</h3>
<h3 id="控制結構"><a class="markdownIt-Anchor" href="#控制結構"></a> 控制結構</h3>
<h3 id="條件"><a class="markdownIt-Anchor" href="#條件"></a> 條件</h3>
<p>邏輯控制結構</p>
<p>@if</p>
<p>4-2 @if、@else、@elseif與@endif</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">if</span>(count($tasks)===<span class="number">1</span>)</span><br><span class="line"> There is one talk at this time period.</span><br><span class="line">@<span class="keyword">elseif</span>(count($tasks)===<span class="number">0</span>)</span><br><span class="line"> There are no talks at this time period.</span><br><span class="line">@<span class="keyword">else</span></span><br><span class="line"> There are &#123;&#123;count($tasks)&#125;&#125; talks at this time period.</span><br><span class="line">@<span class="keyword">endif</span></span><br></pre></td></tr></table></figure>
<p>@unless 與 @endunless</p>
<p>4-3 @unless 與 @endunless<br />
它是@if的相反</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@unless($user-&gt;hasPaid())</span><br><span class="line">   You can complete your payment by switching to the payment tab.</span><br><span class="line">@endunless</span><br></pre></td></tr></table></figure>
<p>4-4 @for 與 @endfor</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;$task-&gt;slotsCount();$i++)</span><br><span class="line">    The number is  &#123;&#123;$i&#125;&#125; &lt;br&gt;</span><br><span class="line">@<span class="keyword">endfor</span></span><br></pre></td></tr></table></figure>
<p>4-5 @foreach 與 @endforeach</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">for</span>($talks <span class="keyword">as</span> $talk)</span><br><span class="line">  &#123;&#123;$talk-&gt;title&#125;&#125; (&#123;&#123;$talk-&gt;length&#125;&#125; minutes) &lt;br&gt; </span><br><span class="line">@<span class="keyword">endfor</span></span><br></pre></td></tr></table></figure>
<p>4-6 @while 與 @endwhile</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">while</span>($item = array_pop($items))</span><br><span class="line">    &#123;&#123; $item -&gt; orSomething() &#125;&#125; &lt;br&gt;</span><br><span class="line">@<span class="keyword">endwhile</span></span><br></pre></td></tr></table></figure>
<p>4-7 @forelse</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@forelse($talks <span class="keyword">as</span> $talk)</span><br><span class="line">  * &#123;&#123;$talk-&gt;title&#125;&#125;(&#123;&#123;$talk-&gt;length&#125;&#125; minutes) &lt;br&gt;</span><br><span class="line">@<span class="keyword">empty</span></span><br><span class="line">  No talks this day.</span><br><span class="line">@endforelse</span><br></pre></td></tr></table></figure>
<p>index<br />
iteration<br />
remaining<br />
count<br />
first<br />
last<br />
depth<br />
parent</p>
<h3 id="模板繼承"><a class="markdownIt-Anchor" href="#模板繼承"></a> 模板繼承</h3>
<h3 id="使用sectionshow-與-yield-來定義區段"><a class="markdownIt-Anchor" href="#使用sectionshow-與-yield-來定義區段"></a> 使用@section/@show 與 @yield 來定義區段</h3>
<p>4-8 Blade 版面配置</p>
 <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- resource/views/layouts/master.blade.php --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>My Site | @yield('title','Home Page')<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">   @yield('content')</span><br><span class="line"> <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> @section('footerScripts')</span><br><span class="line">   <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"app.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> @show</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>4-9 擴展Blade配置</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- resource/views/dashboard.blade.php --&gt;</span></span><br><span class="line">@extends('layouts.master')</span><br><span class="line">@section('title','Dashboard')</span><br><span class="line">@section('content')</span><br><span class="line">  Welcome to your application dashboard!</span><br><span class="line">@endsection</span><br><span class="line">@section('footerScripts')</span><br><span class="line">  @parents</span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"dashboard.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">@endsection</span><br></pre></td></tr></table></figure>
<p>@extends</p>
<p>@section 與 @endsection</p>
<p>@parent</p>
<p>@include<br />
4-10 使用@include來納入部分的視圖</p>
 <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- resource/views/home.blade.php --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"content"</span> <span class="attr">data-page-name</span>=<span class="string">"&#123;&#123;$pageName&#125;&#125;"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span> Here's why you should sign up for our app:<span class="tag">&lt;<span class="name">strong</span>&gt;</span>It's Great.<span class="tag">&lt;/<span class="name">strong</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">@include('sign-up-button',['text' =&gt; 'See just how great it is'])</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>@each<br />
4-11 以@each 來使用迴圈中的部分視圖</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- resource/views/sidebar.blade.php --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sidebar"</span>&gt;</span></span><br><span class="line">@each('partials.module',$modules,'module','partials.empty-module')</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--resource/views/partials/module.blade.php--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sidebar-module"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123;$module-&gt;title&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--resource/views/partials/empty-module.blade.php--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sidebar-module"</span>&gt;</span></span><br><span class="line">  No modules :(</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="視圖組件與服務注入"><a class="markdownIt-Anchor" href="#視圖組件與服務注入"></a> 視圖組件與服務注入</h3>
<p>4-12 複習將資料傳給視圖</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">'passing-data-to-views'</span>,<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> view(<span class="string">'dashboard'</span>)</span><br><span class="line">    -&gt;with(<span class="string">'key'</span>,<span class="string">'value'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="使用視圖組件來將資料綁定視圖"><a class="markdownIt-Anchor" href="#使用視圖組件來將資料綁定視圖"></a> 使用視圖組件來將資料綁定視圖</h3>
<p>4-13 從每一個路由傳入資訊看板資料</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">'home'</span>,<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> view(<span class="string">'home'</span>)</span><br><span class="line">      -&gt;with(<span class="string">'posts'</span>,Post::recent());</span><br><span class="line">&#125;)</span><br><span class="line">Route::get(<span class="string">'about'</span>,<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> view(<span class="string">'about'</span>)</span><br><span class="line">      -&gt;with(<span class="string">'posts'</span>, Post::recent());</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="全域共用變數"><a class="markdownIt-Anchor" href="#全域共用變數"></a> 全域共用變數</h3>
<p>4-14 全域共用變數</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//某個服務提供者</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span><span class="params">()</span></span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  view()-&gt;share(<span class="string">'posts'</span>, Post::recent());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="採用closure的view-composer"><a class="markdownIt-Anchor" href="#採用closure的view-composer"></a> 採用Closure的view composer</h3>
<p>4-15 建立使用closure的view composer</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">view()-&gt;composer(<span class="string">'partials.sidebar'</span>, <span class="function"><span class="keyword">function</span><span class="params">($view)</span></span>&#123;</span><br><span class="line">  $view-&gt;with(<span class="string">'posts'</span>, Post::recent());</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>與多個視圖共用的view composer</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">view()-&gt;composer(</span><br><span class="line">  [<span class="string">'partials.header'</span>,<span class="string">'partials.footer'</span>]</span><br><span class="line">  <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">    $view-&gt;with(<span class="string">'posts'</span>, Post::recent());</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  view()-&gt;composer(<span class="string">'partials,*'</span>,<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">    $view-&gt;with(<span class="string">'posts'</span>, Post::recent());</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<h4 id="使用類別的view-composer"><a class="markdownIt-Anchor" href="#使用類別的view-composer"></a> 使用類別的view composer</h4>
<p>4-16 view composer</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">ViewComposers</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Post</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Contracts</span>\<span class="title">View</span>\<span class="title">View</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RecentPostsComposer</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">  <span class="keyword">private</span> $posts;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">_construct</span><span class="params">(Post $posts)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;posts = $posts;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">compose</span><span class="params">(View $view)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    $view-&gt;with(<span class="string">'posts'</span>, <span class="keyword">$this</span>-&gt;posts-&gt;recent());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>4-17 在AppServiceProvider內註冊一個view composer</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AppServiceProvider</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  view()-&gt;composer(</span><br><span class="line">    <span class="string">'partials.sidebar'</span>, </span><br><span class="line">    \App\Http\ViewComposers\RecentPostsComposer::class</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="blade服務注入"><a class="markdownIt-Anchor" href="#blade服務注入"></a> Blade服務注入</h4>
<p>4-18 透過路由定義建構式來將服務注入視圖</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">'backend/sales'</span>,<span class="function"><span class="keyword">function</span><span class="params">(AnalyticsService $analytics)</span></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> view(<span class="string">'backend.sales-graphs'</span>)</span><br><span class="line">  -&gt;with(<span class="string">'analytics'</span>,analytics);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>4-19 在視圖中使用注入的導航服務</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"finances-display"</span>&gt;</span></span><br><span class="line">&#123;&#123; $analytics-&gt;getBalance() &#125;&#125; / &#123;&#123; $analytics-&gt;getBudget() &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>4-20 將服務直接注入視圖</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@inject('analytics', 'App\Services\Analytics')</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"finances-display"</span>&gt;</span></span><br><span class="line">&#123;&#123; $analytics-&gt;getBalance() &#125;&#125; / &#123;&#123; $analytics-&gt;getBudget() &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="自訂blade指令"><a class="markdownIt-Anchor" href="#自訂blade指令"></a> 自訂Blade指令</h4>
<p>4-21 綁定自訂的Blade指令</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// AppServiceProvider</span><br><span class="line">public function boot() </span><br><span class="line">&#123;</span><br><span class="line">  Blade::directive('ifGuest',function()&#123;</span><br><span class="line">    return "<span class="php"><span class="meta">&lt;?php</span> <span class="keyword">if</span>(auth()-&gt;guest()): <span class="meta">?&gt;</span></span>";</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4-22 建立有參數的Blade指令</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 綁定</span><br><span class="line">Blade::directive('newlinesToBr',function($expression)&#123;</span><br><span class="line">  return "<span class="php"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> nl2br(&#123;$expression&#125;)<span class="meta">?&gt;</span></span>"</span><br><span class="line">&#125;)</span><br><span class="line">// 使用</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>@newlinesToBr($message-&gt;body)<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>4-23 不使用自訂Blade指令的背景條件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">if</span> (app(<span class="string">'context'</span>)-&gt;isPublic())</span><br><span class="line">  &amp;copy; Copyright MyApp LLC</span><br><span class="line">@<span class="keyword">else</span></span><br><span class="line">  &amp;copy; Copyright&#123;&#123; app(<span class="string">'context'</span>)-&gt;client-&gt;name &#125;&#125;</span><br><span class="line">@<span class="keyword">endif</span></span><br></pre></td></tr></table></figure>
<p>4-24 使用自訂Blade指令的環境條件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//綁定</span></span><br><span class="line">Blade::directive(<span class="string">'ifPublic'</span>,<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">"&lt;?php if(app('context')-&gt;isPublic()): ?&gt;"</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//使用</span></span><br><span class="line">@ifPublic</span><br><span class="line">  &amp;copy; Copyright MyApp LLC</span><br><span class="line">@<span class="keyword">else</span></span><br><span class="line">  &amp;copy; Copyright &#123;&#123;app(<span class="string">'context'</span>)-&gt;client-&gt;name&#125;&#125;</span><br><span class="line">@<span class="keyword">elseif</span></span><br></pre></td></tr></table></figure>
<p>4-25 測試視圖可顯示某些內容</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//EventsTest.php</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_list_page_shows_all_events</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  $event1 = factory (Event::class)-&gt;create();</span><br><span class="line">  $event2 = factory (Event::class)-&gt;create();</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">$this</span>-&gt;visit(<span class="string">'events'</span>) </span><br><span class="line">    -&gt;see($event1-&gt;title)</span><br><span class="line">    -&gt;see($event2-&gt;title);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4-26 測試視圖已被傳入某些內容</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//EventsTest.php</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_list_page_shows_all_events</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  $event1 = factory (Event::class)-&gt;create();</span><br><span class="line">  $event2 = factory (Event::class)-&gt;create();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">$this</span>-&gt;vist(<span class="string">'events'</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">$this</span>-&gt;assertViewHas(<span class="string">'events'</span>,Event::all());</span><br><span class="line">  <span class="keyword">$this</span>-&gt;assertViewHasAll([</span><br><span class="line">    <span class="string">'events'</span> =&gt; Event::all(),</span><br><span class="line">    <span class="string">'title'</span> =&gt; <span class="string">'Events Page'</span></span><br><span class="line">  ]);</span><br><span class="line">  <span class="keyword">$this</span>-&gt;assertViewMissing(<span class="string">'dogs'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4-27 將closure 傳入assertViewHas()</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//EventsTest.php</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_list_page_shows_all_events</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  $event1 = factory(Event::class)-&gt;create();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">$this</span>-&gt;visit(<span class="string">'events/'</span>. $event1 -&gt; id);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">$this</span>-&gt;assertViewHas(<span class="string">'event'</span>,<span class="function"><span class="keyword">function</span><span class="params">($event)</span> <span class="title">use</span><span class="params">($event1)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $event-&gt;id === $event1-&gt;id;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        
    </section>
</article>




<nav class="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/categories/backend/page/2/">2</a><a class="extend next" rel="next" href="/categories/backend/page/2/">Next »</a>
</nav>



            </div>
        </div>
        <footer class="footer">
    Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, Theme by <a href="https://github.com/sanonz/hexo-theme-concise" target="_blank">Concise</a>

    
</footer>

    </main>

    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/1.9.0/jquery.min.js"></script>
    <script type="text/javascript">
    $(function() {
        var nodes = {
            nav: $('#nav'),
            aside: $('#aside'),
            asideInner: $('#aside-inner'),
            navInner: $('#nav-inner')
        };

        var doing = false;
        nodes.asideInner.on('webkitAnimationEnd mozAnimationEnd oAnimationEnd oanimationend animationend', function() {
            if (nodes.aside.hasClass('mobile-open')) {
                nodes.aside.removeClass('mobile-open');
            } else {
                nodes.aside.removeClass('mobile-close panel-show');
            }
            doing = false;
        });
        $('#open-panel, #aside-mask').on('click', function() {
            if (doing) {
                return;
            }

            if (nodes.aside.hasClass('panel-show')) {
                nodes.aside.addClass('mobile-close');
            } else {
                nodes.aside.addClass('mobile-open panel-show');
            }
        });
        $('#open-menus').on('click', function() {
            nodes.navInner.slideToggle();
        });

        if (window.innerWidth <= 960) {
            setTimeout(function() {
                nodes.navInner.slideUp();
            }, 3000);
        }
    });
    </script>
    

</body>
</html>
