<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />

    

    

    <title>Vince的學習筆記</title>
    <meta name="author" content="Vince Lo" />
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />

    
    <link rel="alternate" href="/atom.xml" title="Vince的學習筆記" type="application/atom+xml">
    
    
    <link rel="icon" href="/images/favicon.ico">
    

    <style type="text/css">
    @font-face {
        font-family: 'icomoon';
        src: url("/fonts/icomoon.eot?q628ml");
        src: url("/fonts/icomoon.eot?q628ml#iefix") format('embedded-opentype'),
             url("/fonts/icomoon.ttf?q628ml") format('truetype'),
             url("/fonts/icomoon.woff?q628ml") format('woff'),
             url("/fonts/icomoon.svg?q628ml#icomoon") format('svg');
        font-weight: normal;
        font-style: normal;
    }
    </style>
    
<link rel="stylesheet" href="/css/style.css">


    <!--[if lt IE 9]>
    <style type="text/css">
    .nav-inner {top:0;}
    .author-meta {position:static;top:0;}
    .search-form {height:36px;}
    </style>
    <script type="text/javascript" src="https://unpkg.com/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
    <![endif]-->
<meta name="generator" content="Hexo 4.2.0"></head>
<body>

    <main class="app">
        <header id="header" class="header clearfix">
    <div id="nav" class="nav">
    <div class="nav-mobile">
        <button id="open-panel" class="open-panel nav-mobile-item"><i class="icon-documents"></i></button>
        <h1 class="nav-mobile-title nav-mobile-item">Vince的學習筆記</h1>
        <button id="open-menus" class="open-panel nav-mobile-item"><i class="icon-library"></i></button>
    </div>

    <nav id="nav-inner" class="nav-inner">
        
            <a class="nav-item active" href="/">
                <span class="nav-text">首頁</span>
            </a>
        
            <a class="nav-item" href="/categories/design">
                <span class="nav-text">設計</span>
            </a>
        
            <a class="nav-item" href="/categories/frontend">
                <span class="nav-text">前端</span>
            </a>
        
            <a class="nav-item" href="/categories/backend">
                <span class="nav-text">後端</span>
            </a>
        
            <a class="nav-item" href="/tags">
                <span class="nav-text">標籤</span>
            </a>
        
            <a class="nav-item" href="/archives">
                <span class="nav-text">歸檔</span>
            </a>
        
            <a class="nav-item" href="/about">
                <span class="nav-text">關於</span>
            </a>
        
    </nav>
</div>

    <aside id="aside" class="aside">
    <div id="aside-mask" class="aside-mask"></div>
    <div id="aside-inner" class="aside-inner">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"><i class="icon-search-stroke"></i></button><input type="hidden" name="sitesearch" value="http://vince115.github.io"></form>

        
        

        
        <div class="author-meta">
            
            <div class="author-avatar">
                <a href="/">
                    <img src="/images/avatar.png" title="Vince Lo">
                </a>
            </div>
            
            <div class="author-name">Vince Lo</div>
            <div class="author-work">Designer &amp; Developer</div>
            <div class="author-location">
                <i class="icon-location vm"></i>
                <span class="vm">Taipei, Taiwan</span>
            </div>
            
            <div class="author-thread-wrap">
                <div class="author-threads clearfix">
                    
                        <a class="thread-item" href="https://github.com/vince115" target="_blank" rel="noopener">
                            <?xml version="1.0" encoding="iso-8859-1"?>
<!-- Generator: Adobe Illustrator 16.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="438.549px" height="438.549px" viewBox="0 0 438.549 438.549" style="enable-background:new 0 0 438.549 438.549;"
	 xml:space="preserve">
<g>
	<path d="M409.132,114.573c-19.608-33.596-46.205-60.194-79.798-79.8C295.736,15.166,259.057,5.365,219.271,5.365
		c-39.781,0-76.472,9.804-110.063,29.408c-33.596,19.605-60.192,46.204-79.8,79.8C9.803,148.168,0,184.854,0,224.63
		c0,47.78,13.94,90.745,41.827,128.906c27.884,38.164,63.906,64.572,108.063,79.227c5.14,0.954,8.945,0.283,11.419-1.996
		c2.475-2.282,3.711-5.14,3.711-8.562c0-0.571-0.049-5.708-0.144-15.417c-0.098-9.709-0.144-18.179-0.144-25.406l-6.567,1.136
		c-4.187,0.767-9.469,1.092-15.846,1c-6.374-0.089-12.991-0.757-19.842-1.999c-6.854-1.231-13.229-4.086-19.13-8.559
		c-5.898-4.473-10.085-10.328-12.56-17.556l-2.855-6.57c-1.903-4.374-4.899-9.233-8.992-14.559
		c-4.093-5.331-8.232-8.945-12.419-10.848l-1.999-1.431c-1.332-0.951-2.568-2.098-3.711-3.429c-1.142-1.331-1.997-2.663-2.568-3.997
		c-0.572-1.335-0.098-2.43,1.427-3.289c1.525-0.859,4.281-1.276,8.28-1.276l5.708,0.853c3.807,0.763,8.516,3.042,14.133,6.851
		c5.614,3.806,10.229,8.754,13.846,14.842c4.38,7.806,9.657,13.754,15.846,17.847c6.184,4.093,12.419,6.136,18.699,6.136
		c6.28,0,11.704-0.476,16.274-1.423c4.565-0.952,8.848-2.383,12.847-4.285c1.713-12.758,6.377-22.559,13.988-29.41
		c-10.848-1.14-20.601-2.857-29.264-5.14c-8.658-2.286-17.605-5.996-26.835-11.14c-9.235-5.137-16.896-11.516-22.985-19.126
		c-6.09-7.614-11.088-17.61-14.987-29.979c-3.901-12.374-5.852-26.648-5.852-42.826c0-23.035,7.52-42.637,22.557-58.817
		c-7.044-17.318-6.379-36.732,1.997-58.24c5.52-1.715,13.706-0.428,24.554,3.853c10.85,4.283,18.794,7.952,23.84,10.994
		c5.046,3.041,9.089,5.618,12.135,7.708c17.705-4.947,35.976-7.421,54.818-7.421s37.117,2.474,54.823,7.421l10.849-6.849
		c7.419-4.57,16.18-8.758,26.262-12.565c10.088-3.805,17.802-4.853,23.134-3.138c8.562,21.509,9.325,40.922,2.279,58.24
		c15.036,16.18,22.559,35.787,22.559,58.817c0,16.178-1.958,30.497-5.853,42.966c-3.9,12.471-8.941,22.457-15.125,29.979
		c-6.191,7.521-13.901,13.85-23.131,18.986c-9.232,5.14-18.182,8.85-26.84,11.136c-8.662,2.286-18.415,4.004-29.263,5.146
		c9.894,8.562,14.842,22.077,14.842,40.539v60.237c0,3.422,1.19,6.279,3.572,8.562c2.379,2.279,6.136,2.95,11.276,1.995
		c44.163-14.653,80.185-41.062,108.068-79.226c27.88-38.161,41.825-81.126,41.825-128.906
		C438.536,184.851,428.728,148.168,409.132,114.573z"/>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
</svg>

                        </a>
                    
                        <a class="thread-item" href="https://www.pinterest.com/vince115/" target="_blank" rel="noopener">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 0c-6.627 0-12 5.372-12 12 0 5.084 3.163 9.426 7.627 11.174-.105-.949-.2-2.405.042-3.441.218-.937 1.407-5.965 1.407-5.965s-.359-.719-.359-1.782c0-1.668.967-2.914 2.171-2.914 1.023 0 1.518.769 1.518 1.69 0 1.029-.655 2.568-.994 3.995-.283 1.194.599 2.169 1.777 2.169 2.133 0 3.772-2.249 3.772-5.495 0-2.873-2.064-4.882-5.012-4.882-3.414 0-5.418 2.561-5.418 5.207 0 1.031.397 2.138.893 2.738.098.119.112.224.083.345l-.333 1.36c-.053.22-.174.267-.402.161-1.499-.698-2.436-2.889-2.436-4.649 0-3.785 2.75-7.262 7.929-7.262 4.163 0 7.398 2.967 7.398 6.931 0 4.136-2.607 7.464-6.227 7.464-1.216 0-2.359-.631-2.75-1.378l-.748 2.853c-.271 1.043-1.002 2.35-1.492 3.146 1.124.347 2.317.535 3.554.535 6.627 0 12-5.373 12-12 0-6.628-5.373-12-12-12z" fill-rule="evenodd" clip-rule="evenodd"/></svg>
                        </a>
                    
                        <a class="thread-item" href="https://www.twitter.com/vince115tw/" target="_blank" rel="noopener">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.066 9.645c.183 4.04-2.83 8.544-8.164 8.544-1.622 0-3.131-.476-4.402-1.291 1.524.18 3.045-.244 4.252-1.189-1.256-.023-2.317-.854-2.684-1.995.451.086.895.061 1.298-.049-1.381-.278-2.335-1.522-2.304-2.853.388.215.83.344 1.301.359-1.279-.855-1.641-2.544-.889-3.835 1.416 1.738 3.533 2.881 5.92 3.001-.419-1.796.944-3.527 2.799-3.527.825 0 1.572.349 2.096.907.654-.128 1.27-.368 1.824-.697-.215.671-.67 1.233-1.263 1.589.581-.07 1.135-.224 1.649-.453-.384.578-.87 1.084-1.433 1.489z"/></svg>
                        </a>
                    
                        <a class="thread-item" href="https://www.facebook.com/vince115" target="_blank" rel="noopener">
                            <svg height="512pt" viewBox="0 0 512 512" width="512pt" xmlns="http://www.w3.org/2000/svg"><path d="m297.277344 508.667969c-2.132813.347656-4.273438.667969-6.421875.960937 2.148437-.292968 4.289062-.613281 6.421875-.960937zm0 0"/><path d="m302.398438 507.792969c-1.019532.1875-2.039063.359375-3.058594.535156 1.019531-.175781 2.039062-.347656 3.058594-.535156zm0 0"/><path d="m285.136719 510.339844c-2.496094.28125-5.007813.53125-7.527344.742187 2.519531-.210937 5.03125-.460937 7.527344-.742187zm0 0"/><path d="m290.054688 509.738281c-1.199219.160157-2.40625.308594-3.609376.449219 1.203126-.140625 2.410157-.289062 3.609376-.449219zm0 0"/><path d="m309.367188 506.410156c-.898438.191406-1.800782.382813-2.703126.566406.902344-.183593 1.804688-.375 2.703126-.566406zm0 0"/><path d="m326.664062 502.113281c-.726562.207031-1.453124.402344-2.179687.605469.726563-.203125 1.453125-.398438 2.179687-.605469zm0 0"/><path d="m321.433594 503.542969c-.789063.207031-1.582032.417969-2.375.617187.792968-.199218 1.585937-.40625 2.375-.617187zm0 0"/><path d="m314.589844 505.253906c-.835938.195313-1.679688.378906-2.523438.566406.84375-.1875 1.6875-.371093 2.523438-.566406zm0 0"/><path d="m277.527344 511.089844c-1.347656.113281-2.695313.214844-4.046875.304687 1.351562-.089843 2.699219-.191406 4.046875-.304687zm0 0"/><path d="m512 256c0-141.363281-114.636719-256-256-256s-256 114.636719-256 256 114.636719 256 256 256c1.503906 0 3-.03125 4.5-.058594v-199.285156h-55v-64.097656h55v-47.167969c0-54.703125 33.394531-84.476563 82.191406-84.476563 23.367188 0 43.453125 1.742188 49.308594 2.519532v57.171875h-33.648438c-26.546874 0-31.6875 12.617187-31.6875 31.128906v40.824219h63.476563l-8.273437 64.097656h-55.203126v189.453125c107.003907-30.675781 185.335938-129.257813 185.335938-246.109375zm0 0"/><path d="m272.914062 511.429688c-2.664062.171874-5.339843.308593-8.023437.398437 2.683594-.089844 5.359375-.226563 8.023437-.398437zm0 0"/><path d="m264.753906 511.835938c-1.414062.046874-2.832031.082031-4.25.105468 1.417969-.023437 2.835938-.058594 4.25-.105468zm0 0"/></svg>
                        </a>
                    
                        <a class="thread-item" href="https://www.linkedin.com/in/vince-lo-06a9928b/" target="_blank" rel="noopener">
                            <svg height="512pt" viewBox="0 0 512 512" width="512pt" xmlns="http://www.w3.org/2000/svg"><path d="m256 0c-141.363281 0-256 114.636719-256 256s114.636719 256 256 256 256-114.636719 256-256-114.636719-256-256-256zm-74.390625 387h-62.347656v-187.574219h62.347656zm-31.171875-213.1875h-.40625c-20.921875 0-34.453125-14.402344-34.453125-32.402344 0-18.40625 13.945313-32.410156 35.273437-32.410156 21.328126 0 34.453126 14.003906 34.859376 32.410156 0 18-13.53125 32.402344-35.273438 32.402344zm255.984375 213.1875h-62.339844v-100.347656c0-25.21875-9.027343-42.417969-31.585937-42.417969-17.222656 0-27.480469 11.601563-31.988282 22.800781-1.648437 4.007813-2.050781 9.609375-2.050781 15.214844v104.75h-62.34375s.816407-169.976562 0-187.574219h62.34375v26.558594c8.285157-12.78125 23.109375-30.960937 56.1875-30.960937 41.019531 0 71.777344 26.808593 71.777344 84.421874zm0 0"/></svg>
                        </a>
                    
                        <a class="thread-item" href="https://line.me/ti/p/n5ZevZknIM" target="_blank" rel="noopener">
                            <svg id="Bold" enable-background="new 0 0 24 24" height="512" viewBox="0 0 24 24" width="512" xmlns="http://www.w3.org/2000/svg"><path d="m12 .5c-6.615 0-12 4.398-12 9.803 0 4.841 4.27 8.897 10.035 9.668.391.083.923.26 1.058.594.12.303.079.771.038 1.087l-.164 1.026c-.045.303-.24 1.193 1.049.649 1.291-.542 6.916-4.104 9.436-7.019 1.724-1.9 2.548-3.847 2.548-6.005 0-5.405-5.385-9.803-12-9.803zm-4.697 13.017h-2.386c-.345 0-.63-.287-.63-.633v-4.801c0-.347.285-.634.63-.634.348 0 .63.287.63.634v4.167h1.756c.348 0 .629.285.629.634 0 .346-.282.633-.629.633zm2.466-.633c0 .346-.282.633-.631.633-.345 0-.627-.287-.627-.633v-4.801c0-.347.282-.634.63-.634.346 0 .628.287.628.634zm5.741 0c0 .272-.174.513-.432.6-.064.021-.133.031-.199.031-.211 0-.391-.091-.51-.252l-2.443-3.338v2.958c0 .346-.279.633-.631.633-.346 0-.626-.287-.626-.633v-4.8c0-.272.173-.513.43-.599.06-.023.136-.033.194-.033.195 0 .375.105.495.256l2.462 3.351v-2.975c0-.347.282-.634.63-.634.345 0 .63.287.63.634zm3.855-3.035c.349 0 .63.287.63.635 0 .347-.281.634-.63.634h-1.755v1.132h1.755c.349 0 .63.285.63.634 0 .346-.281.633-.63.633h-2.386c-.345 0-.627-.287-.627-.633v-4.801c0-.347.282-.634.63-.634h2.386c.346 0 .627.287.627.634 0 .351-.281.634-.63.634h-1.755v1.132z"/></svg>
                        </a>
                    
                </div>
            </div>
            
        </div>
        
    </div>
</aside>

</header>

        <div id="content" class="content">
            <div id="wrapper" class="wrapper" style="max-width: 800px">
                
    <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            <a href="/2020/05/07/laravel-10/">laravel-10 請求與回應</a>
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="http://vince115.github.io/index.html">
    
    <i class="icon-calendar"></i>
    
    <time datetime="2020-05-07T09:07:32.000Z" itemprop="datePublished">2020-05-07</time>
</a>

            
<div class="article-tag-list">
    <i class="icon-tag"></i>
    <a class="article-tag-link" href="/tags/backend/" rel="tag">backend</a>, <a class="article-tag-link" href="/tags/laravel/" rel="tag">laravel</a>
</div>


        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <p>啟動應用程式</p>
<p>Laravel的核心</p>
<p>服務提供者</p>
<p>10-1 推遲服務提供者的註冊</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Request 物件</p>
<p>在Laravel中取得Request物件</p>
<p>10-2 在容器解析的方法中型態提示，已接收Request物件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>取得Request 的基本資訊</p>
<p>基本用戶輸入</p>
<p>10-3 從request取得用戶提供的基本資訊</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>用戶與請求的狀態</p>
<p>檔案</p>
<p>持久保存</p>
<p>Response物件</p>
<h4 id="在控制器中使用與建立response物件"><a class="markdownIt-Anchor" href="#在控制器中使用與建立response物件"></a> 在控制器中使用與建立Response物件</h4>
<p>10-4 最簡單的HTTP回應</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>10-5 使用自訂的狀態與標頭的HTTP回應</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>10-6 將Cookie附加到回應</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>設定標頭</p>
<p>添加cookie</p>
<p>特殊的回應類型</p>
<p>視圖回應</p>
<p>10-7 使用view()回應類型</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>下載回應</p>
<p>10-8 使用download()回應類型</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>檔案回應</p>
<p>10-8 使用download()回應類型</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>JSON回應</p>
<p>轉址回應</p>
<p>10-13 在轉址的同時填入資料</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>自訂回應巨集</p>
<p>10-14</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Laravel與中介層</p>
<p>中介層簡介</p>
<p>建立自訂的中介層</p>
<p>10-15 預設的中介層內容</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>暸解中介層的handle()方法</p>
<p>10-16 解釋中介層呼叫程序的虛擬程式</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>10-17 禁用刪除方法的中介層範例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>10-18 綁定全域中介層</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>綁定中介層</p>
<p>綁定全域中介層</p>
<p>10-19 綁定路由中介層</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>10-20 在路由定義中套用路由中介層</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>10-21 Laravel的預設路由服務提供者</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>傳遞參數給中介層</p>
<p>測試</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
        
    </section>
</article>


    <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            <a href="/2020/05/06/laravel-09/">laravel-09 用戶身分驗證與授權</a>
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="http://vince115.github.io/index.html">
    
    <i class="icon-calendar"></i>
    
    <time datetime="2020-05-06T03:26:16.000Z" itemprop="datePublished">2020-05-06</time>
</a>

            
<div class="article-tag-list">
    <i class="icon-tag"></i>
    <a class="article-tag-link" href="/tags/backend/" rel="tag">backend</a>, <a class="article-tag-link" href="/tags/laravel/" rel="tag">laravel</a>
</div>


        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <h3 id="用戶模型與-migration"><a class="markdownIt-Anchor" href="#用戶模型與-migration"></a> 用戶模型與 migration</h3>
<p>9-1 Laravel的預設user migration</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Schema::create(<span class="string">'users'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Blueprint $table)</span> </span>&#123;</span><br><span class="line">    $table-&gt;increments(<span class="string">'id'</span>);</span><br><span class="line">    $table-&gt;string(<span class="string">'name'</span>);</span><br><span class="line">    $table-&gt;string(<span class="string">'email'</span>)-&gt;unique();</span><br><span class="line">    $table-&gt;string(<span class="string">'password'</span>);</span><br><span class="line">    $table-&gt;rememberToken();</span><br><span class="line">    $table-&gt;timestamps();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>9-2 Laravel 的預設user模型</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// App\User</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Notifications</span>\<span class="title">Notifiable</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Auth</span>\<span class="title">User</span> <span class="title">as</span> <span class="title">Authenticatable</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Authenticatable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Notifiable</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* The attributes that are mass assignable.</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@var</span> array</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">protected</span> $fillable = [</span><br><span class="line"><span class="string">'name'</span>, <span class="string">'email'</span>, <span class="string">'password'</span>,</span><br><span class="line">];</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* The attributes excluded from the model's JSON form.</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@var</span> array</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">protected</span> $hidden = [</span><br><span class="line"><span class="string">'password'</span>, <span class="string">'remember_token'</span>,</span><br><span class="line">];</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// Illuminate\Foundation\Auth\User</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Auth</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Auth</span>\<span class="title">Authenticatable</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Auth</span>\<span class="title">Passwords</span>\<span class="title">CanResetPassword</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Auth</span>\<span class="title">Access</span>\<span class="title">Authorizable</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Contracts</span>\<span class="title">Auth</span>\<span class="title">Authenticatable</span> <span class="title">as</span> <span class="title">AuthenticatableContract</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Contracts</span>\<span class="title">Auth</span>\<span class="title">Access</span>\<span class="title">Authorizable</span> <span class="title">as</span> <span class="title">AuthorizableContract</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Contracts</span>\<span class="title">Auth</span>\<span class="title">CanResetPassword</span> <span class="title">as</span> <span class="title">CanResetPasswordContract</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span> <span class="keyword">implements</span></span></span><br><span class="line"><span class="class"><span class="title">AuthenticatableContract</span>,</span></span><br><span class="line"><span class="class"><span class="title">AuthorizableContract</span>,</span></span><br><span class="line"><span class="class"><span class="title">CanResetPasswordContract</span></span></span><br><span class="line"><span class="class"><span class="title">esetPasswordContract</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">   useAuthenticatable,Authorizable,CanResetPassword;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="使用auth-全域輔助函式與auth靜態介面"><a class="markdownIt-Anchor" href="#使用auth-全域輔助函式與auth靜態介面"></a> 使用auth() 全域輔助函式與Auth靜態介面</h3>
<p>9-3 Rgister</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="auth-控制器"><a class="markdownIt-Anchor" href="#auth-控制器"></a> Auth 控制器</h3>
<h3 id="registercontroller"><a class="markdownIt-Anchor" href="#registercontroller"></a> RegisterController</h3>
<p>9-4 Laravel 預設的 RgisterController</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RegisterController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">RegistersUsers</span>;</span><br><span class="line">    <span class="keyword">protected</span> $redirectTo = <span class="string">'/home'</span>;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">validator</span><span class="params">(array $data)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Validator::make($data, [</span><br><span class="line">            <span class="string">'name'</span> =&gt; <span class="string">'required|max:255'</span>,</span><br><span class="line">            <span class="string">'email'</span> =&gt; <span class="string">'required|email|max:255|unique:users'</span>,</span><br><span class="line">            <span class="string">'password'</span> =&gt; <span class="string">'required|min:6|confirmed'</span>,</span><br><span class="line">        ]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">create</span><span class="params">(array $data)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> User::create([</span><br><span class="line">            <span class="string">'name'</span> =&gt; $data[<span class="string">'name'</span>],</span><br><span class="line">            <span class="string">'email'</span> =&gt; $data[<span class="string">'email'</span>],</span><br><span class="line">            <span class="string">'password'</span> =&gt; bcrypt($data[<span class="string">'password'</span>]),</span><br><span class="line">        ]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="registeruser-特徵"><a class="markdownIt-Anchor" href="#registeruser-特徵"></a> RegisterUser 特徵</h5>
<h4 id="logincontroller"><a class="markdownIt-Anchor" href="#logincontroller"></a> LoginController</h4>
<h5 id="authenticatesusers-特徵"><a class="markdownIt-Anchor" href="#authenticatesusers-特徵"></a> AuthenticatesUsers 特徵</h5>
<h5 id="throttleslogins-特徵"><a class="markdownIt-Anchor" href="#throttleslogins-特徵"></a> ThrottlesLogins 特徵</h5>
<h4 id="resetpasswordcontroller"><a class="markdownIt-Anchor" href="#resetpasswordcontroller"></a> ResetPasswordController</h4>
<h3 id="authroutes-路由"><a class="markdownIt-Anchor" href="#authroutes-路由"></a> Auth::routes() 路由</h3>
<p>9-5 Auth::提供的路由</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Authentication Routes</span></span><br><span class="line"><span class="keyword">$this</span>-&gt;get(<span class="string">'login'</span>, <span class="string">'Auth\LoginController@showLoginForm'</span>);</span><br><span class="line"><span class="keyword">$this</span>-&gt;post(<span class="string">'login'</span>, <span class="string">'Auth\LoginController@login'</span>);</span><br><span class="line"><span class="keyword">$this</span>-&gt;get(<span class="string">'logout'</span>, <span class="string">'Auth\LoginController@logout'</span>);</span><br><span class="line"><span class="comment">// Registration Routes</span></span><br><span class="line"><span class="keyword">$this</span>-&gt;get(<span class="string">'register'</span>, <span class="string">'Auth\RegisterController@showRegistrationForm'</span>);</span><br><span class="line"><span class="keyword">$this</span>-&gt;post(<span class="string">'register'</span>, <span class="string">'Auth\RegisterController@register'</span>);</span><br><span class="line"><span class="comment">// Password Reset Routes</span></span><br><span class="line"><span class="keyword">$this</span>-&gt;get(<span class="string">'password/reset'</span>, <span class="string">'Auth\ForgotPasswordController@showLinkRequestForm'</span>);</span><br><span class="line"><span class="keyword">$this</span>-&gt;post(<span class="string">'password/email'</span>, <span class="string">'Auth\ForgotPasswordController@sendResetLinkEmail'</span>);</span><br><span class="line"><span class="keyword">$this</span>-&gt;get(<span class="string">'password/reset/&#123;token&#125;'</span>, <span class="string">'Auth\ResetPasswordController@showResetForm'</span>);</span><br><span class="line"><span class="keyword">$this</span>-&gt;post(<span class="string">'password/reset'</span>, <span class="string">'Auth\ResetPasswordController@reset'</span>);</span><br></pre></td></tr></table></figure>
<h3 id="auth-鷹架"><a class="markdownIt-Anchor" href="#auth-鷹架"></a> Auth 鷹架</h3>
<h3 id="記住我"><a class="markdownIt-Anchor" href="#記住我"></a> “記住我”</h3>
<p>9-6 嘗試進行用戶身分驗證</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (auth()-&gt;attempt([</span><br><span class="line">    <span class="string">'email'</span> =&gt; request()-&gt;input(<span class="string">'email'</span>),</span><br><span class="line">    <span class="string">'password'</span> =&gt; request()-&gt;input(<span class="string">'password'</span>)</span><br><span class="line">    ])) &#123;</span><br><span class="line">    <span class="comment">// Handle the successful login</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>9-7 使用&quot;記住我&quot;確認方塊來做身分確認</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (auth()-&gt;attempt([</span><br><span class="line">    <span class="string">'email'</span> =&gt; request()-&gt;input(<span class="string">'email'</span>),</span><br><span class="line">    <span class="string">'password'</span> =&gt; request()-&gt;input(<span class="string">'password'</span>)</span><br><span class="line">    ]), request()-&gt;has(<span class="string">'remember'</span>)) &#123;</span><br><span class="line">    <span class="comment">// Handle the successful login</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="手動驗證用戶"><a class="markdownIt-Anchor" href="#手動驗證用戶"></a> 手動驗證用戶</h3>
<h3 id="驗證中介層"><a class="markdownIt-Anchor" href="#驗證中介層"></a> 驗證中介層</h3>
<p>9-8 使用Blade的@cannot指令</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Route::group([<span class="string">'middleware'</span> =&gt; <span class="string">'auth'</span>], <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    Route::get(<span class="string">'account'</span>, <span class="string">'AccountController@dashboard'</span>);</span><br><span class="line">&#125;);</span><br><span class="line">Route::get(<span class="string">'login'</span>, <span class="string">'Auth\LoginController@getLogin'</span>)-&gt;middleware(<span class="string">'guest'</span>);</span><br></pre></td></tr></table></figure>
<h3 id="守衛"><a class="markdownIt-Anchor" href="#守衛"></a> 守衛</h3>
<h4 id="改變預設的守衛"><a class="markdownIt-Anchor" href="#改變預設的守衛"></a> 改變預設的守衛</h4>
<h4 id="使用其他的守衛而不改變預設值"><a class="markdownIt-Anchor" href="#使用其他的守衛而不改變預設值"></a> 使用其他的守衛而不改變預設值</h4>
<h4 id="增加新守衛"><a class="markdownIt-Anchor" href="#增加新守衛"></a> 增加新守衛</h4>
<h4 id="建立自訂的用戶供應器"><a class="markdownIt-Anchor" href="#建立自訂的用戶供應器"></a> 建立自訂的用戶供應器</h4>
<h4 id="為非關聯式資料庫自訂user供應器"><a class="markdownIt-Anchor" href="#為非關聯式資料庫自訂user供應器"></a> 為非關聯式資料庫自訂user供應器</h4>
<h3 id="驗證事件"><a class="markdownIt-Anchor" href="#驗證事件"></a> 驗證事件</h3>
<p>9-9 框架生成的驗證事件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> $listen = [</span><br><span class="line">    <span class="string">'Illuminate\Auth\Events\Attempting'</span> =&gt; [],</span><br><span class="line">    <span class="string">'Illuminate\Auth\Events\Login'</span> =&gt; [],</span><br><span class="line">    <span class="string">'Illuminate\Auth\Events\Logout'</span> =&gt; [],</span><br><span class="line">    <span class="string">'Illuminate\Auth\Events\Lockout'</span> =&gt; [],</span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<h3 id="授權acl與角色"><a class="markdownIt-Anchor" href="#授權acl與角色"></a> 授權(ACL)與角色</h3>
<h4 id="定義授權規則"><a class="markdownIt-Anchor" href="#定義授權規則"></a> 定義授權規則</h4>
<p>9-10 更新聯絡資訊的能力範例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AuthServiceProvider</span> <span class="keyword">extends</span> <span class="title">ServiceProvider</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span><span class="params">(GateContract $gate)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;registerPolicies($gate);</span><br><span class="line">        $gate-&gt;define(<span class="string">'update-contact'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($user, $contact)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> $user-&gt;id === $contact-&gt;user_id;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="gate靜態介面與注入gate"><a class="markdownIt-Anchor" href="#gate靜態介面與注入gate"></a> Gate靜態介面(與注入Gate)</h4>
<p>9-11 基本的Gate靜態介面用法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (Gate::allows(<span class="string">'update-contact'</span>, $contact)) &#123;</span><br><span class="line">    <span class="comment">// Update contact</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// or...</span></span><br><span class="line"><span class="keyword">if</span> (Gate::denies(<span class="string">'update-contact'</span>, $contact)) &#123;</span><br><span class="line">    abort(<span class="number">403</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>9-12 使用多個參數的能力</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Definition</span></span><br><span class="line">$gate-&gt;define(<span class="string">'add-contact-to-group'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($user, $contact, $group)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $user-&gt;id === $contact-&gt;user_id &amp;&amp; $user-&gt;id === $group-&gt;user_id;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// Usage</span></span><br><span class="line"><span class="keyword">if</span> (Gate::denies(<span class="string">'add-contact-to-group'</span>, [$contact, $group])) &#123;</span><br><span class="line">    abort(<span class="number">403</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>9-13 指定Gate用戶</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (Gate::forUser($user)-&gt;denies(<span class="string">'create-contact'</span>)) &#123;</span><br><span class="line">    abort(<span class="number">403</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="授權中介層"><a class="markdownIt-Anchor" href="#授權中介層"></a> 授權中介層</h4>
<p>9-14 使用授權中介層</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">'people/create'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// Create person...</span></span><br><span class="line">&#125;)-&gt;middleware(<span class="string">'can:create-person'</span>);</span><br><span class="line">Route::get(<span class="string">'people/&#123;person&#125;/edit'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// Create person...</span></span><br><span class="line">&#125;)-&gt;middleware(<span class="string">'can:create,person'</span>);</span><br></pre></td></tr></table></figure>
<h4 id="控制器授權"><a class="markdownIt-Anchor" href="#控制器授權"></a> 控制器授權</h4>
<p>9-15 以authorize()簡化控制器授權</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// From this:</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span><span class="params">($contactId)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $contact = Contact::findOrFail($contactId);</span><br><span class="line">    <span class="keyword">if</span> (Gate::cannot(<span class="string">'update-contact'</span>, $contact)) &#123;</span><br><span class="line">    abort(<span class="number">403</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// To this:</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span><span class="params">($contactId)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">$contact = Contact::findOrFail($contactId);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;authorize(<span class="string">'update-contact'</span>, $contact);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="用戶實例檢查"><a class="markdownIt-Anchor" href="#用戶實例檢查"></a> 用戶實例檢查</h4>
<p>9-16 authorizeResource()從&quot;授權&quot;到&quot;方法&quot;的對應</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ContactsController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// This call does everything you see in the methods below.</span></span><br><span class="line">        <span class="comment">// If you put this here, you can remove all authorize</span></span><br><span class="line">        <span class="comment">// calls in the individual resource methods here.</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;authorizeResource(Contact::class);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;authorize(<span class="string">'view'</span>, Contact::class);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">create</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;authorize(<span class="string">'create'</span>, Contact::class);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">store</span><span class="params">(Request $request)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;authorize(<span class="string">'create'</span>, Contact::class);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span><span class="params">(Contact $contact)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;authorize(<span class="string">'view'</span>, $contact);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">edit</span><span class="params">(Contact $contact)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;authorize(<span class="string">'update'</span>, $contact);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span><span class="params">(Request $request, Contact $contact)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;authorize(<span class="string">'update'</span>, $contact);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">destroy</span><span class="params">(Contact $contact)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;authorize(<span class="string">'delete'</span>, $contact);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>9-17 對用戶實例檢查授權</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$user = User::find(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">if</span> ($user-&gt;can(<span class="string">'create-contact'</span>)) &#123;</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="blade-檢查"><a class="markdownIt-Anchor" href="#blade-檢查"></a> Blade 檢查</h4>
<p>9-18 使用Blade的@can指令</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">nav</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/"</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">@can('edit-contact', $contact)</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;&#123; route('contacts.edit', [$contact-&gt;id]) &#125;&#125;"</span>&gt;</span>Edit This Contact<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">@endcan</span><br><span class="line"><span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>9-19 使用Blade的@cannot指令</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1&gt;&#123;&#123; $contact-&gt;name &#125;&#125;&lt;/h1&gt;</span><br><span class="line">@cannot(<span class="string">'edit-contact'</span>, $contact)</span><br><span class="line">LOCKED</span><br><span class="line">@endcannot</span><br></pre></td></tr></table></figure>
<h4 id="攔截檢查"><a class="markdownIt-Anchor" href="#攔截檢查"></a> 攔截檢查</h4>
<p>9-20 使用before()來覆寫Gate檢查</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$gate-&gt;before(<span class="function"><span class="keyword">function</span> <span class="params">($user, $ability)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> ($user-&gt;isOwner()) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="政策"><a class="markdownIt-Anchor" href="#政策"></a> 政策</h4>
<h4 id="產生政策"><a class="markdownIt-Anchor" href="#產生政策"></a> 產生政策</h4>
<blockquote>
<p>php artisan make:policy CantactPolicy</p>
</blockquote>
<p>9-21 update政策方法範例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Policies</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ContactPolicy</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span><span class="params">($user, $contact)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $user-&gt;id === $contact-&gt;user_id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="檢查政策"><a class="markdownIt-Anchor" href="#檢查政策"></a> 檢查政策</h4>
<p>9-22 以政策檢查授權</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Gate</span></span><br><span class="line"><span class="keyword">if</span> (Gate::denies(<span class="string">'update'</span>, $contact)) &#123;</span><br><span class="line">abort(<span class="number">403</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Gate if you don't have an explicit instance</span></span><br><span class="line"><span class="keyword">if</span> (! Gate::check(<span class="string">'create'</span>, Contact::class)) &#123;</span><br><span class="line">abort(<span class="number">403</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// User</span></span><br><span class="line"><span class="keyword">if</span> ($user-&gt;can(<span class="string">'update'</span>, $contact)) &#123;</span><br><span class="line"><span class="comment">// Do stuff</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Blade</span></span><br><span class="line">@can(<span class="string">'update'</span>, $contact)</span><br><span class="line">&lt;!-- show stuff --&gt;</span><br><span class="line">@endcan</span><br></pre></td></tr></table></figure>
<h4 id="覆寫政策"><a class="markdownIt-Anchor" href="#覆寫政策"></a> 覆寫政策</h4>
<p>9-23 使用before方法來覆寫政策</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">before</span><span class="params">($user, $ability)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ($user-&gt;isAdmin()) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="測試"><a class="markdownIt-Anchor" href="#測試"></a> 測試</h3>
<p>9-24 在應用測試中扮演用戶來進行驗證</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_it_creates_a_new_contact</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $user = factory(User::class)-&gt;create();</span><br><span class="line">    <span class="keyword">$this</span>-&gt;be($user);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">$this</span>-&gt;post(<span class="string">'contacts'</span>, [</span><br><span class="line">        <span class="string">'email'</span> =&gt; <span class="string">'my@email.com'</span></span><br><span class="line">    ]);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;seeInDatabase(<span class="string">'contacts'</span>, [</span><br><span class="line">        <span class="string">'email'</span> =&gt; <span class="string">'my@email.com'</span>,</span><br><span class="line">        <span class="string">'user_id'</span> =&gt; $user-&gt;id,</span><br><span class="line">    ]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>9-25 測試授權規則</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_non_admins_cant_create_users</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $user = factory(User::class)-&gt;create([</span><br><span class="line">        <span class="string">'admin'</span> =&gt; <span class="keyword">false</span></span><br><span class="line">    ]);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;be($user);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;post(<span class="string">'users'</span>, [<span class="string">'email'</span> =&gt; <span class="string">'my@email.com'</span>]);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;dontSeeInDatabase(<span class="string">'users'</span>, [</span><br><span class="line">        <span class="string">'email'</span> =&gt; <span class="string">'my@email.com'</span></span><br><span class="line">    ]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>9-26 檢查狀態碼來測試授權</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_non_admins_cant_create_users</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $user = factory(User::class)-&gt;create([</span><br><span class="line">        <span class="string">'admin'</span> =&gt; <span class="keyword">false</span></span><br><span class="line">    ]);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;be($user);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;post(<span class="string">'users'</span>, [<span class="string">'email'</span> =&gt; <span class="string">'my@email.com'</span>]);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;assertResponseStatus(<span class="number">403</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>9-27 測試授權路由</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_users_can_register</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;post(<span class="string">'register'</span>, [</span><br><span class="line">    <span class="string">'name'</span> =&gt; <span class="string">'Sal Leibowitz'</span>,</span><br><span class="line">    <span class="string">'email'</span> =&gt; <span class="string">'sal@leibs.net'</span>,</span><br><span class="line">    <span class="string">'password'</span> =&gt; <span class="string">'abcdefg123'</span>,</span><br><span class="line">    <span class="string">'password_confirmation'</span> =&gt; <span class="string">'abcdefg123'</span>,</span><br><span class="line">    ]);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">$this</span>-&gt;followRedirects()-&gt;assertResponseOk();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">$this</span>-&gt;seeInDatabase(<span class="string">'users'</span>, [</span><br><span class="line">    <span class="string">'name'</span> =&gt; <span class="string">'Sal Leibowitz'</span>,</span><br><span class="line">    <span class="string">'email'</span> =&gt; <span class="string">'sal@leibs.net'</span>,</span><br><span class="line">    ]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_users_can_log_in</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $user = factory(User::class)-&gt;create([</span><br><span class="line">        <span class="string">'password'</span> =&gt; bcrypt(<span class="string">'abcdefg123'</span>)</span><br><span class="line">    ]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">$this</span>-&gt;post(<span class="string">'login'</span>, [</span><br><span class="line">    <span class="string">'email'</span> =&gt; $user-&gt;email,</span><br><span class="line">    <span class="string">'password'</span> =&gt; <span class="string">'abcdefg123'</span>,</span><br><span class="line">    ]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">$this</span>-&gt;followRedirects()-&gt;assertResponseOk();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">$this</span>-&gt;assertTrue(auth()-&gt;check());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        
    </section>
</article>


    <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            <a href="/2020/05/01/laravel-08/">laravel-08</a>
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="http://vince115.github.io/index.html">
    
    <i class="icon-calendar"></i>
    
    <time datetime="2020-05-01T04:42:18.000Z" itemprop="datePublished">2020-05-01</time>
</a>

            
<div class="article-tag-list">
    <i class="icon-tag"></i>
    <a class="article-tag-link" href="/tags/backend/" rel="tag">backend</a>, <a class="article-tag-link" href="/tags/laravel/" rel="tag">laravel</a>
</div>


        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <p>8-1 The default database connections list</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'connections'</span> =&gt; [</span><br><span class="line">        <span class="string">'sqlite'</span> =&gt; [</span><br><span class="line">        <span class="string">'driver'</span> =&gt; <span class="string">'sqlite'</span>,</span><br><span class="line">        <span class="string">'database'</span> =&gt; database_path(<span class="string">'database.sqlite'</span>),</span><br><span class="line">        <span class="string">'prefix'</span> =&gt; <span class="string">''</span>,</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">'mysql'</span> =&gt; [</span><br><span class="line">        <span class="string">'driver'</span> =&gt; <span class="string">'mysql'</span>,</span><br><span class="line">        <span class="string">'host'</span> =&gt; env(<span class="string">'DB_HOST'</span>, <span class="string">'localhost'</span>),</span><br><span class="line">        <span class="string">'database'</span> =&gt; env(<span class="string">'DB_DATABASE'</span>, <span class="string">'forge'</span>),</span><br><span class="line">        <span class="string">'username'</span> =&gt; env(<span class="string">'DB_USERNAME'</span>, <span class="string">'forge'</span>),</span><br><span class="line">        <span class="string">'password'</span> =&gt; env(<span class="string">'DB_PASSWORD'</span>, <span class="string">''</span>),</span><br><span class="line">        <span class="string">'charset'</span> =&gt; <span class="string">'utf8'</span>,</span><br><span class="line">        <span class="string">'collation'</span> =&gt; <span class="string">'utf8_unicode_ci'</span>,</span><br><span class="line">        <span class="string">'prefix'</span> =&gt; <span class="string">''</span>,</span><br><span class="line">        <span class="string">'strict'</span> =&gt; <span class="keyword">false</span>,</span><br><span class="line">        <span class="string">'engine'</span> =&gt; <span class="keyword">null</span>,</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">'pgsql'</span> =&gt; [</span><br><span class="line">        <span class="string">'driver'</span> =&gt; <span class="string">'pgsql'</span>,</span><br><span class="line">        <span class="string">'host'</span> =&gt; env(<span class="string">'DB_HOST'</span>, <span class="string">'localhost'</span>),</span><br><span class="line">        <span class="string">'database'</span> =&gt; env(<span class="string">'DB_DATABASE'</span>, <span class="string">'forge'</span>),</span><br><span class="line">        <span class="string">'username'</span> =&gt; env(<span class="string">'DB_USERNAME'</span>, <span class="string">'forge'</span>),</span><br><span class="line">        <span class="string">'password'</span> =&gt; env(<span class="string">'DB_PASSWORD'</span>, <span class="string">''</span>),</span><br><span class="line">        <span class="string">'charset'</span> =&gt; <span class="string">'utf8'</span>,</span><br><span class="line">        <span class="string">'prefix'</span> =&gt; <span class="string">''</span>,</span><br><span class="line">        <span class="string">'schema'</span> =&gt; <span class="string">'public'</span>,</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">'sqlsrv'</span> =&gt; [</span><br><span class="line">        <span class="string">'driver'</span> =&gt; <span class="string">'sqlsrv'</span>,</span><br><span class="line">        <span class="string">'host'</span> =&gt; env(<span class="string">'DB_HOST'</span>, <span class="string">'localhost'</span>),</span><br><span class="line">        <span class="string">'database'</span> =&gt; env(<span class="string">'DB_DATABASE'</span>, <span class="string">'forge'</span>),</span><br><span class="line">        <span class="string">'username'</span> =&gt; env(<span class="string">'DB_USERNAME'</span>, <span class="string">'forge'</span>),</span><br><span class="line">        <span class="string">'password'</span> =&gt; env(<span class="string">'DB_PASSWORD'</span>, <span class="string">''</span>),</span><br><span class="line">        <span class="string">'charset'</span> =&gt; <span class="string">'utf8'</span>,</span><br><span class="line">        <span class="string">'prefix'</span> =&gt; <span class="string">''</span>,</span><br><span class="line">    ],</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>8-2</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Schema</span>\<span class="title">Blueprint</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Migrations</span>\<span class="title">Migration</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CreateUsersTable</span> <span class="keyword">extends</span> <span class="title">Migration</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Run the migrations.</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">up</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Schema::create(<span class="string">'users'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Blueprint $table)</span> </span>&#123;</span><br><span class="line">        $table-&gt;increments(<span class="string">'id'</span>);</span><br><span class="line">        $table-&gt;string(<span class="string">'name'</span>);</span><br><span class="line">        $table-&gt;string(<span class="string">'email'</span>)-&gt;unique();</span><br><span class="line">        $table-&gt;string(<span class="string">'password'</span>, <span class="number">60</span>);</span><br><span class="line">        $table-&gt;rememberToken();</span><br><span class="line">        $table-&gt;timestamps();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Reverse the migrations.</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">down</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Schema::drop(<span class="string">'users'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8-3 Adding column indexes in migrations</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// after columns are created...</span></span><br><span class="line">$table-&gt;primary(<span class="string">'primary_id'</span>); <span class="comment">// Primary key; unnecessary if used increments()</span></span><br><span class="line">$table-&gt;primary([<span class="string">'first_name'</span>, <span class="string">'last_name'</span>]); <span class="comment">// Composite keys</span></span><br><span class="line">$table-&gt;unique(<span class="string">'email'</span>); <span class="comment">// Unique index</span></span><br><span class="line">$table-&gt;unique(<span class="string">'email'</span>, <span class="string">'optional_custom_index_name'</span>); <span class="comment">// Unique index</span></span><br><span class="line">$table-&gt;index(<span class="string">'amount'</span>); <span class="comment">// Basic index</span></span><br><span class="line">$table-&gt;index(<span class="string">'amount'</span>, <span class="string">'optional_custom_index_name'</span>); <span class="comment">// Basic index</span></span><br></pre></td></tr></table></figure>
<p>8-4</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$table-&gt;dropPrimary(<span class="string">'contacts_id_primary'</span>);</span><br><span class="line">$table-&gt;dropUnique(<span class="string">'contacts_email_unique'</span>);</span><br><span class="line">$table-&gt;dropIndex(<span class="string">'optional_custom_index_name'</span>);</span><br><span class="line"><span class="comment">// If you pass an array of column names to dropIndex, it will</span></span><br><span class="line"><span class="comment">// guess the index names for you based on the generation rules</span></span><br><span class="line">$table-&gt;dropIndex([<span class="string">'email'</span>, <span class="string">'amount'</span>]);</span><br></pre></td></tr></table></figure>
<p>8-5</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">factory(Post::class)-&gt;create([</span><br><span class="line">    <span class="string">'title'</span> =&gt; <span class="string">'My greatest post ever'</span></span><br><span class="line">]);</span><br><span class="line">factory(User::class, <span class="number">20</span>)-&gt;create()-&gt;each(<span class="function"><span class="keyword">function</span> <span class="params">($u)</span> <span class="title">use</span> <span class="params">($post)</span> </span>&#123;</span><br><span class="line">    $post-&gt;comments()-&gt;save(factory(Comment::class)-&gt;make([</span><br><span class="line">        <span class="string">'user_id'</span> =&gt; $u-&gt;id</span><br><span class="line">    ]));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>8-6</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$factory-&gt;define(Contact::class, <span class="function"><span class="keyword">function</span> <span class="params">(Faker\Generator $faker)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">        <span class="string">'name'</span> =&gt; $faker-&gt;name,</span><br><span class="line">        <span class="string">'email'</span> =&gt; $faker-&gt;email,</span><br><span class="line">    ];</span><br><span class="line">&#125;);</span><br><span class="line">$factory-&gt;defineAs(Contact::class, <span class="string">'vip'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Faker\Generator $faker)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">        <span class="string">'name'</span> =&gt; $faker-&gt;name,</span><br><span class="line">        <span class="string">'email'</span> =&gt; $faker-&gt;email,</span><br><span class="line">        <span class="string">'vip'</span> =&gt; <span class="keyword">true</span>,</span><br><span class="line">    ];</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>8-7  Extending a factory type</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$factory-&gt;define(Contact::class, <span class="function"><span class="keyword">function</span> <span class="params">(Faker\Generator $faker)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">        <span class="string">'name'</span> =&gt; $faker-&gt;name,</span><br><span class="line">        <span class="string">'email'</span> =&gt; $faker-&gt;email,</span><br><span class="line">    ];</span><br><span class="line">&#125;);</span><br><span class="line">$factory-&gt;defineAs(</span><br><span class="line">    Contact::class,</span><br><span class="line">    <span class="string">'vip'</span>,</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="params">(Faker\Generator $faker)</span> <span class="title">use</span> <span class="params">($factory)</span> </span>&#123;</span><br><span class="line">        $contact = $factory-&gt;raw(Contact::class);</span><br><span class="line">        <span class="keyword">return</span> array_merge($contact, [<span class="string">'vip'</span> =&gt; <span class="keyword">true</span>]);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<p>8-8 Sample raw SQL and query builder usage</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// basic statement</span></span><br><span class="line">DB::statement(<span class="string">'drop table users'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// raw select, and parameter binding</span></span><br><span class="line">DB::select(<span class="string">'select * from contacts where validated = ?'</span>, [<span class="keyword">true</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// select using the fluent builder</span></span><br><span class="line">$users = DB::table(<span class="string">'users'</span>)-&gt;get();</span><br><span class="line"></span><br><span class="line"><span class="comment">// joins and other complex calls</span></span><br><span class="line">DB::table(<span class="string">'users'</span>)</span><br><span class="line">    -&gt;join(<span class="string">'contacts'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($join)</span> </span>&#123;</span><br><span class="line">        $join-&gt;on(<span class="string">'users.id'</span>, <span class="string">'='</span>, <span class="string">'contacts.user_id'</span>)</span><br><span class="line">            -&gt;where(<span class="string">'contacts.type'</span>, <span class="string">'donor'</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">-&gt;get();</span><br></pre></td></tr></table></figure>
<p>8-9  A simple database transaction</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">DB::transaction(<span class="function"><span class="keyword">function</span> <span class="params">()</span> <span class="title">use</span> <span class="params">($userId, $numVotes)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// Possibly failing DB query</span></span><br><span class="line">    DB::table(<span class="string">'users'</span>)</span><br><span class="line">        -&gt;where(<span class="string">'id'</span>, $userId)</span><br><span class="line">        -&gt;update([<span class="string">'votes'</span> =&gt; $numVotes]);</span><br><span class="line">    <span class="comment">// Caching query that we don't want to run if the above query fails</span></span><br><span class="line">    DB::table(<span class="string">'votes'</span>)</span><br><span class="line">        -&gt;where(<span class="string">'user_id'</span>, $userId)</span><br><span class="line">        -&gt;delete();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>8-10</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Contact</span> <span class="keyword">extends</span> <span class="title">Model</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>8-11</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">save</span><span class="params">(Request $request)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// Create and save a new contact from user input</span></span><br><span class="line">    $contact = <span class="keyword">new</span> Contact();</span><br><span class="line">    $contact-&gt;first_name = $request-&gt;input(<span class="string">'first_name'</span>);</span><br><span class="line">    $contact-&gt;last_name = $request-&gt;input(<span class="string">'last_name'</span>);</span><br><span class="line">    $conatct-&gt;email = $request-&gt;input(<span class="string">'email'</span>);</span><br><span class="line">    $contact-&gt;save();</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">'contacts'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span><span class="params">($contactId)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// Return a JSON representation of a Contact based on a URL segment;</span></span><br><span class="line">    <span class="comment">// if the contact doesn't exist, throw an exception</span></span><br><span class="line">    <span class="keyword">return</span> Contact::findOrFail($contactId);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">vips</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// Unnecessarily complex example, but still possible with basic Eloquent</span></span><br><span class="line">    <span class="comment">// class; adds a "formalName" property to every VIP entry</span></span><br><span class="line">    <span class="keyword">return</span> Contact::where(<span class="string">'vip'</span>, <span class="keyword">true</span>)-&gt;get()-&gt;map(<span class="function"><span class="keyword">function</span> <span class="params">($contact)</span> </span>&#123;</span><br><span class="line">        $contact-&gt;formalName = <span class="string">"The exalted &#123;$contact-&gt;first_name&#125; of the</span></span><br><span class="line"><span class="string">        &#123;$contact-&gt;last_name&#125;s"</span>;</span><br><span class="line">        <span class="keyword">return</span> $contact;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8-12 Using an Eloquent OrFail() method in a controller method</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ContactController</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span><span class="params">($contactId)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> view(<span class="string">'contacts.show'</span>)</span><br><span class="line">        -&gt;with(<span class="string">'contact'</span>, Contact::findOrFail($contactId));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8-13  Chunking an Eloquent query to limit memory usage</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Contact::chunk(<span class="number">100</span>, <span class="function"><span class="keyword">function</span> <span class="params">($contacts)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">foreach</span> ($contacts <span class="keyword">as</span> $contact) &#123;</span><br><span class="line">        <span class="comment">// Do something with $contact</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>8-14 Inserting an Eloquent record by creating a new instance</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$contact = <span class="keyword">new</span> Contact;</span><br><span class="line">$contact-&gt;name = <span class="string">'Ken Hirata'</span>;</span><br><span class="line">$contact-&gt;email = <span class="string">'ken@hirata.com'</span>;</span><br><span class="line">$contact-&gt;save();</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line">$contact = <span class="keyword">new</span> Contact([</span><br><span class="line">    <span class="string">'name'</span> =&gt; <span class="string">'Ken Hirata'</span>,</span><br><span class="line">    <span class="string">'email'</span> =&gt; <span class="string">'ken@hirata.com'</span></span><br><span class="line">]);</span><br><span class="line">$contact-&gt;save();</span><br></pre></td></tr></table></figure>
<p>8-15 Inserting an Eloquent record by passing an array to create()</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$contact = Contact::create([</span><br><span class="line">    <span class="string">'name'</span> =&gt; <span class="string">'Keahi Hale'</span>,</span><br><span class="line">    <span class="string">'email'</span> =&gt; <span class="string">'halek481@yahoo.com'</span></span><br><span class="line">]);</span><br></pre></td></tr></table></figure>
<p>8-16 Updating an Eloquent record by updating an instance and saving</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$contact = Contact::find(<span class="number">1</span>);</span><br><span class="line">$contact-&gt;email = <span class="string">'natalie@parkfamily.com'</span>;</span><br><span class="line">$contact-&gt;save();</span><br></pre></td></tr></table></figure>
<p>8-17  Updating one or more Eloquent records by passing an array to the update() method</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Contact::where(<span class="string">'created_at'</span>, <span class="string">'&lt;'</span>, Carbon::now()-&gt;subYear())</span><br><span class="line">    -&gt;update([<span class="string">'longevity'</span> =&gt; <span class="string">'ancient'</span>]);</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line">$contact = Contact::find(<span class="number">1</span>);</span><br><span class="line">$contact-&gt;update([<span class="string">'longevity'</span> =&gt; <span class="string">'ancient'</span>]);</span><br></pre></td></tr></table></figure>
<p>8-18 Updating an Eloquent model using the entirety of a request’s input</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ContactController</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span><span class="params">(Contact $contact, Request $request)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $contact-&gt;update($request-&gt;all());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8-19 Using Eloquent’s fillable or guarded properties to define mass-assignable fields</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Contact</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $fillable = [<span class="string">'name'</span>, <span class="string">'email'</span>];</span><br><span class="line">    <span class="comment">// or</span></span><br><span class="line">    <span class="keyword">protected</span> $guarded = [<span class="string">'id'</span>, <span class="string">'created_ at'</span>, <span class="string">'updated_at'</span>, <span class="string">'owner_id'</span>] ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8-20</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Schema::table(<span class="string">'contacts'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Blueprint $table)</span> </span>&#123;</span><br><span class="line">    $table-&gt;softDeletes();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>8-21 An Eloquent model with soft deletes enabled</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">SoftDeletes</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Contact</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">SoftDeletes</span>; <span class="comment">// use the trait</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $dates = [<span class="string">'deleted_at'</span>]; <span class="comment">// mark this column as a date</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8-22 Adding a global scope using a closure</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Contact</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">parent</span>::boot();</span><br><span class="line">        <span class="keyword">static</span>::addGlobalScope(<span class="string">'active'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Builder $builder)</span> </span>&#123;</span><br><span class="line">            $builder-&gt;where(<span class="string">'active'</span>, <span class="keyword">true</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>8-23 Creating a global scope class</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Scopes</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Scope</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Builder</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ActiveScope</span> <span class="keyword">implements</span> <span class="title">Scope</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">apply</span><span class="params">(Builder $builder, Model $model)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $builder-&gt;where(<span class="string">'active'</span>, <span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8-24</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Scopes</span>\<span class="title">ActiveScope</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Contact</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">parent</span>::boot();</span><br><span class="line">        <span class="keyword">static</span>::addGlobalScope(newActiveScope);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8-25  Decorating a preexisting column with Eloquent accessors</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Model definition:</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Contact</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getNameAttribute</span><span class="params">($value)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $value ?: <span class="string">'(No name provided)'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8-26 Defining an attribute with no backing column using Eloquent accessors</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Model definition:</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Contact</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFullNameAttribute</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;first_name . <span class="string">' '</span> . <span class="keyword">$this</span>-&gt;last_name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Accessor usage:</span></span><br><span class="line">$fullName = $contact-&gt;full_name;</span><br></pre></td></tr></table></figure>
<p>8-27</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Defining the mutator</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Order</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setAmountAttribute</span><span class="params">($value)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;attributes[<span class="string">'amount'</span>] = $value &gt; <span class="number">0</span> ? $value : <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Using the mutator</span></span><br><span class="line">$order-&gt;amount = <span class="string">'15'</span>;</span><br></pre></td></tr></table></figure>
<p>8-28</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Order</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setWorkgroupNameAttribute</span><span class="params">($workgroupName)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;attributes[<span class="string">'email'</span>] = <span class="string">"&#123;$workgroupName&#125;@ourcompany.com"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8-29</p>
<figure class="highlight php"><figcaption><span>Using attribute casting on an Eloquent model</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Contact</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $casts = [</span><br><span class="line">        <span class="string">'vip'</span> =&gt; <span class="string">'boolean'</span>,</span><br><span class="line">        <span class="string">'children_names'</span> =&gt; <span class="string">'array'</span>,</span><br><span class="line">        <span class="string">'birthday'</span> =&gt; <span class="string">'date'</span>,</span><br><span class="line">    ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8-30</p>
<figure class="highlight php"><figcaption><span>Defining columns to be mutated as timestamps</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Contact</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $dates = [</span><br><span class="line">    <span class="string">'met_at'</span></span><br><span class="line">    ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8-31</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OrderCollection</span> <span class="keyword">extends</span> <span class="title">Collection</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sumBillableAmount</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;reduce(<span class="function"><span class="keyword">function</span> <span class="params">($carry, $order)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $carry + ($order-&gt;billable ? $order-&gt;amount : <span class="number">0</span>);</span><br><span class="line">        &#125;, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Order</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">newCollection</span><span class="params">(array $models = [])</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> OrderCollection($models);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>8-32 Returning JSON from routes directly</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// routes/web.php</span></span><br><span class="line">Route::get(<span class="string">'api/contacts'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Contact::all();</span><br><span class="line">&#125;);</span><br><span class="line">Route::get(<span class="string">'api/contacts/&#123;id&#125;'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Contact::findOrFail($id);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>8-33</p>
<figure class="highlight php"><figcaption><span>Defining a one-to-one relationship</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Contact</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">phoneNumber</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;hasOne(PhoneNumber::class);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>8-34 Defining a one-to-one relationship’s inverse</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PhoneNumber</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">contact</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;belongsTo(Contact::class);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>8-35</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">contacts</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;hasMany(Contact::class);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>8-36</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Contact</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">user</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;belongsTo(User::class);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>$donors = $user-&gt;contacts()-&gt;where(‘status’, ‘donor’)-&gt;get()</p>
<p>$postsWithComments = Post::has(‘comments’)-&gt;get()</p>
<p>$postsWithManyComments = Post::has(‘comments’, ‘&gt;=’, 5)-&gt;get();</p>
<p>// Gets all contacts with a phone number containing the string “867-5309”<br />
<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi><mi>e</mi><mi>n</mi><mi>n</mi><mi>y</mi><mi>I</mi><mi>G</mi><mi>o</mi><mi>t</mi><mi>Y</mi><mi>o</mi><mi>u</mi><mi>r</mi><mi>N</mi><mi>u</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mo>=</mo><mi>C</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>a</mi><mi>c</mi><mi>t</mi><mo>:</mo><mo>:</mo><mi>w</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>e</mi><mi>H</mi><mi>a</mi><mi>s</mi><msup><mo stretchy="false">(</mo><mo mathvariant="normal">′</mo></msup><mi>p</mi><mi>h</mi><mi>o</mi><mi>n</mi><mi>e</mi><mi>N</mi><mi>u</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><msup><mi>s</mi><mo mathvariant="normal">′</mo></msup><mo separator="true">,</mo><mi>f</mi><mi>u</mi><mi>n</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo stretchy="false">(</mo></mrow><annotation encoding="application/x-tex">jennyIGotYourNumber = Contact::whereHas(&#x27;phoneNumbers&#x27;, function (</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mord mathdefault">e</span><span class="mord mathdefault">n</span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mord mathdefault">G</span><span class="mord mathdefault">o</span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="mord mathdefault">o</span><span class="mord mathdefault">u</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord mathdefault">u</span><span class="mord mathdefault">m</span><span class="mord mathdefault">b</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mord mathdefault">t</span><span class="mord mathdefault">a</span><span class="mord mathdefault">c</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.001892em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord mathdefault">h</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="mord mathdefault">a</span><span class="mord mathdefault">s</span><span class="mopen"><span class="mopen">(</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord mathdefault">p</span><span class="mord mathdefault">h</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord mathdefault">u</span><span class="mord mathdefault">m</span><span class="mord mathdefault">b</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault">u</span><span class="mord mathdefault">n</span><span class="mord mathdefault">c</span><span class="mord mathdefault">t</span><span class="mord mathdefault">i</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mopen">(</span></span></span></span>query) {<br />
$query-&gt;where(‘number’, ‘like’, ‘%867-5309%’);<br />
});</p>
<p>8-37</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">phoneNumbers</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;hasManyThrough(PhoneNumber::class, Contact::class);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>8-38</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">contacts</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;belongsToMany(Contact::class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8-39</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Contact</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">users</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;belongsToMany(User::class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8-40</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$user = User::first();</span><br><span class="line">$user-&gt;contacts-&gt;each(<span class="function"><span class="keyword">function</span> <span class="params">($contact)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">&#125;);</span><br><span class="line">$contact = Contact::first();</span><br><span class="line">$contact-&gt;users-&gt;each(<span class="function"><span class="keyword">function</span> <span class="params">($user)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">&#125;);</span><br><span class="line">$donors = $user-&gt;contacts()-&gt;where(<span class="string">'status'</span>, <span class="string">'donor'</span>)-&gt;get();</span><br></pre></td></tr></table></figure>
<p>8-41</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">contacts</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;belongsToMany(Contact::class)</span><br><span class="line">        -&gt;withTimestamps()</span><br><span class="line">        -&gt;withPivot(<span class="string">'status'</span>, <span class="string">'preferred_greeting'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8-42</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$user = User::first();</span><br><span class="line">$user-&gt;contacts-&gt;each(<span class="function"><span class="keyword">function</span> <span class="params">($contact)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> sprintf(</span><br><span class="line">        <span class="string">'Contact associated with this user at: %s'</span>,</span><br><span class="line">        $contact-&gt;pivot-&gt;created_at</span><br><span class="line">    );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>8-43 Creating the models for a polymorphic starring system</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Star</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">starrable</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;morphsTo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Contact</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">stars</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;morphMany(Star::class, <span class="string">'starrable'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Event</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">stars</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;morphMany(Star::class, <span class="string">'starrable'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8-44 Retrieving the instances of a polymorphic relationship</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$contact = Contact::first();</span><br><span class="line">$contact-&gt;stars-&gt;each(<span class="function"><span class="keyword">function</span> <span class="params">($star)</span> </span>&#123;</span><br><span class="line"><span class="comment">// Do stuff</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>8-45</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$stars = Star::all();</span><br><span class="line">$stars-&gt;each(<span class="function"><span class="keyword">function</span> <span class="params">($star)</span> </span>&#123;</span><br><span class="line">    var_dump($star-&gt;starrable); <span class="comment">// An instance of Contact or Event</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>8-46</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Star</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">starrable</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;morphsTo;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">user</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;belongsTo(User::class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">stars</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;hasMany(Star::class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8-47</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Contact</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">tags</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;morphToMany(Tag::class, <span class="string">'taggable'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Event</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">tags</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;morphToMany(Tag::class, <span class="string">'taggable'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tag</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">contacts</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;morphedByMany(Contact::class, <span class="string">'taggable'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">events</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;morphedByMany(Event::class, <span class="string">'taggable'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8-48</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$contact = Contact::first();</span><br><span class="line">$contact-&gt;tags-&gt;each(<span class="function"><span class="keyword">function</span> <span class="params">($tag)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Do stuff</span></span><br><span class="line">&#125;);</span><br><span class="line">$tag = Tag::first();</span><br><span class="line">$tag-&gt;contacts-&gt;each(<span class="function"><span class="keyword">function</span> <span class="params">($contact)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Do stuff</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>8-49</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PhoneNumber</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $touches = [<span class="string">'contact'</span>];</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">contact</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;belongsTo(Contact::class);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>8-50</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$contacts = Contact::all();</span><br><span class="line"><span class="keyword">foreach</span> ($contacts <span class="keyword">as</span> $contact) &#123;</span><br><span class="line">    <span class="keyword">foreach</span> ($contact-&gt;phone_numbers <span class="keyword">as</span> $phone_number) &#123;</span><br><span class="line">        <span class="keyword">echo</span> $phone_number-&gt;number;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8-51</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppServiceProvider</span> <span class="keyword">extends</span> <span class="title">ServiceProvider</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $thirdPartyService = <span class="keyword">new</span> SomeThirdPartyService;</span><br><span class="line">            Contact::creating(<span class="function"><span class="keyword">function</span> <span class="params">($contact)</span> <span class="title">use</span> <span class="params">($thirdPartyService)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    $thirdPartyService-&gt;addContact($contact);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (<span class="keyword">Exception</span> $e) &#123;</span><br><span class="line">                    Log::error(<span class="string">'Failed adding contact to ThirdPartyService; cancelled.'</span>);</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>8-52</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_active_page_shows_active_and_not_inactive_contacts</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $activeContact = factory(Contact::class, <span class="string">'active'</span>)-&gt;create();</span><br><span class="line">    $inactiveContact = factory(Contact::class, <span class="string">'inactive'</span>)-&gt;create();</span><br><span class="line">    <span class="keyword">$this</span>-&gt;visit(<span class="string">'active-contacts'</span>)</span><br><span class="line">        -&gt;see($activeContact-&gt;name)</span><br><span class="line">        -&gt;dontSee($inactiveContact-&gt;name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8-53</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_contact_creation_works</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;post(<span class="string">'contacts'</span>, [</span><br><span class="line">    <span class="string">'email'</span> =&gt; <span class="string">'jim@bo.com'</span></span><br><span class="line">    ]);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;seeInDatabase(<span class="string">'contacts'</span>, [</span><br><span class="line">    <span class="string">'email'</span> =&gt; <span class="string">'jim@bo.com'</span></span><br><span class="line">    ]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8-54 Testing accessors, mutators, and scopes</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_full_name_accessor_works</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $contact = factory(Contact::class)-&gt;make([</span><br><span class="line">    <span class="string">'first_name'</span> =&gt; <span class="string">'Alphonse'</span>,</span><br><span class="line">    <span class="string">'last_name'</span> =&gt; <span class="string">'Cumberbund'</span></span><br><span class="line">    ]);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;assertEquals(<span class="string">'Alphonse Cumberbund'</span>, $contact-&gt;fullName);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_vip_scope_filters_out_non_vips</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $vip = factory(Contact::class, <span class="string">'vip'</span>)-&gt;create();</span><br><span class="line">    $nonVip = factory(Contact::class)-&gt;create();</span><br><span class="line">    $vips = Contact::vips()-&gt;get();</span><br><span class="line">    <span class="keyword">$this</span>-&gt;assertTrue($vips-&gt;contains([<span class="string">'id'</span> =&gt; $vip-&gt;id]));</span><br><span class="line">    <span class="keyword">$this</span>-&gt;assertFalse($vips-&gt;contains([<span class="string">'id'</span> =&gt; $nonVip-&gt;id]));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

        
    </section>
</article>


    <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            <a href="/2020/04/30/laravel-07/">laravel-07 Artisan 與 Tinker</a>
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="http://vince115.github.io/index.html">
    
    <i class="icon-calendar"></i>
    
    <time datetime="2020-04-30T05:25:59.000Z" itemprop="datePublished">2020-04-30</time>
</a>

            
<div class="article-tag-list">
    <i class="icon-tag"></i>
    <a class="article-tag-link" href="/tags/backend/" rel="tag">backend</a>, <a class="article-tag-link" href="/tags/laravel/" rel="tag">laravel</a>
</div>


        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <h3 id="artisan-簡介"><a class="markdownIt-Anchor" href="#artisan-簡介"></a> Artisan 簡介</h3>
<p>Artisan 是 Laravel 裡的一個指令列介面的名稱。<br />
當你在開發你的應用程式時，它提供了許多有用的指令來幫助你開發。它是基於由強大的 Symfony Console 元件來的。你可以使用 list 指令來列出所有可以使用的 Artisan 指令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan make:controller PostsController</span><br></pre></td></tr></table></figure>
<h3 id="基本artisan-命令"><a class="markdownIt-Anchor" href="#基本artisan-命令"></a> 基本Artisan 命令</h3>
<ul>
<li>help</li>
<li>clear-compiled</li>
<li>down</li>
<li>env</li>
<li>migrate</li>
<li>optimize</li>
<li>serve</li>
<li>thinker</li>
</ul>
<h4 id="選項"><a class="markdownIt-Anchor" href="#選項"></a> 選項</h4>
<ul>
<li>-q</li>
<li>-v、-vv、-vvv</li>
<li>–no-interaction</li>
<li>–php_environment</li>
<li>–version</li>
</ul>
<h4 id="群組化的命令"><a class="markdownIt-Anchor" href="#群組化的命令"></a> 群組化的命令</h4>
<ul>
<li>app</li>
<li>auth</li>
<li>cache</li>
<li>config</li>
<li>db</li>
<li>event</li>
<li>key</li>
<li>make</li>
<li>migrate</li>
<li>notifications</li>
<li>queue</li>
<li>route</li>
<li>schedule</li>
<li>session</li>
<li>Storage</li>
<li>vendor</li>
<li>view</li>
</ul>
<h4 id="編寫自訂的-artisan-命令"><a class="markdownIt-Anchor" href="#編寫自訂的-artisan-命令"></a> 編寫自訂的 Artisan 命令</h4>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan make:console WelcaomeNewUsers --command=email:newusers</span><br></pre></td></tr></table></figure>
<p>7-1 Artisan 命令的預設骨架</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Console</span>\<span class="title">Commands</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Console</span>\<span class="title">Command</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WelcomeNewUsers</span> <span class="keyword">extends</span> <span class="title">Command</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * The name and signature of the console command.</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@var</span> string</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">protected</span> $signature = <span class="string">'email:newusers'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * The console command description.</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@var</span> string</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">protected</span> $description = <span class="string">'Command description'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Create a new command instance.</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">parent</span>::__construct();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Execute the console command.</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>7-2 在主控台核心註冊新命令</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Kernel</span> <span class="keyword">extends</span> <span class="title">ConsoleKernel</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * The Artisan commands provided by your application.</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@var</span> array</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">protected</span> $commands = [</span><br><span class="line">        \App\Console\Commands\WelcomeNewUsers::class,</span><br><span class="line">    ];</span><br></pre></td></tr></table></figure>
<p>7-3 Artisan命令handle()方法範例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WelcomeNewUsers</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        User::signedUpThisWeek()-&gt;each(<span class="function"><span class="keyword">function</span> <span class="params">($user)</span> </span>&#123;</span><br><span class="line">            Mail::send(</span><br><span class="line">            <span class="string">'emails.welcome'</span>,</span><br><span class="line">            [<span class="string">'name'</span> =&gt; $user-&gt;name],</span><br><span class="line">            <span class="function"><span class="keyword">function</span> <span class="params">($m)</span> <span class="title">use</span> <span class="params">($user)</span> </span>&#123;</span><br><span class="line">                $m-&gt;to($user-&gt;email)-&gt;subject(<span class="string">'Welcome!'</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            );</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>7-4 重構一個命令</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WelcomeNewUsers</span> <span class="keyword">extends</span> <span class="title">Command</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(UserMailer $userMailer)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">parent</span>::__construct();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;userMailer = $userMailer</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;userMailer-&gt;welcomeNewUsers();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="引數與選項"><a class="markdownIt-Anchor" href="#引數與選項"></a> 引數與選項</h3>
<h4 id="引數-必要-選用與或-具有預設值"><a class="markdownIt-Anchor" href="#引數-必要-選用與或-具有預設值"></a> 引數、必要、選用與(或) 具有預設值</h4>
<p>password:reset {userId}<br />
password:reset {userId?}<br />
password:reset {userId=1}</p>
<h4 id="選項-必要的值-預設值與快捷方式"><a class="markdownIt-Anchor" href="#選項-必要的值-預設值與快捷方式"></a> 選項、必要的值、預設值，與快捷方式</h4>
<p>password:reset {userId} {–sendEmail}<br />
password:reset {userId} {–password=}<br />
password:reset {userId} {–queue=default}</p>
<h4 id="陣列引數與陣列選項"><a class="markdownIt-Anchor" href="#陣列引數與陣列選項"></a> 陣列引數與陣列選項</h4>
<p>password:reset {userIds*}<br />
password:reset {–ids=*}</p>
<p>7-5 使用Artisan命令與陣列語法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Argument</span></span><br><span class="line">php artisan password:reset <span class="number">1</span> <span class="number">2</span> <span class="number">3</span></span><br><span class="line"><span class="comment">// Option</span></span><br><span class="line">php artisan password:reset --ids=<span class="number">1</span> --ids=<span class="number">2</span> --ids=<span class="number">3</span></span><br></pre></td></tr></table></figure>
<h4 id="輸入說明"><a class="markdownIt-Anchor" href="#輸入說明"></a> 輸入說明</h4>
<p>7-6 為Artisan引數與選項定義說明文字</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> $signature = <span class="string">'password:reset</span></span><br><span class="line"><span class="string">                        &#123;userId : The ID of the user&#125;</span></span><br><span class="line"><span class="string">                        &#123;--sendEmail : Whether to send user an email&#125;'</span>;</span><br></pre></td></tr></table></figure>
<h4 id="使用輸入"><a class="markdownIt-Anchor" href="#使用輸入"></a> 使用輸入</h4>
<blockquote>
<p>argument()</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// with definition "password:reset &#123;userId&#125;":</span></span><br><span class="line">php artisan password:reset <span class="number">5</span></span><br><span class="line"><span class="comment">// $this-&gt;argument() returns this array</span></span><br><span class="line">[</span><br><span class="line">    <span class="string">"command"</span>: <span class="string">"password:reset"</span>,</span><br><span class="line">    <span class="string">"userId': "</span><span class="number">5</span><span class="string">",</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string">// $this-&gt;argument('userId') returns this string</span></span><br><span class="line"><span class="string">"</span><span class="number">5</span><span class="string">"</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>option()</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// with definition "password:reset &#123;--userId=&#125;":</span></span><br><span class="line">php artisan password:reset --userId=<span class="number">5</span></span><br><span class="line"><span class="comment">// $this-&gt;option() returns this array</span></span><br><span class="line">[</span><br><span class="line">    <span class="string">"userId"</span> =&gt; <span class="string">"5"</span></span><br><span class="line">    <span class="string">"help"</span> =&gt; <span class="keyword">false</span></span><br><span class="line">    <span class="string">"quiet"</span> =&gt; <span class="keyword">false</span></span><br><span class="line">    <span class="string">"verbose"</span> =&gt; <span class="keyword">false</span></span><br><span class="line">    <span class="string">"version"</span> =&gt; <span class="keyword">false</span></span><br><span class="line">    <span class="string">"ansi"</span> =&gt; <span class="keyword">false</span></span><br><span class="line">    <span class="string">"no-ansi"</span> =&gt; <span class="keyword">false</span></span><br><span class="line">    <span class="string">"no-interaction"</span> =&gt; <span class="keyword">false</span></span><br><span class="line">    <span class="string">"env"</span> =&gt; <span class="keyword">null</span></span><br><span class="line">]</span><br><span class="line"><span class="comment">// $this-&gt;option('userId') returns this string</span></span><br><span class="line"><span class="string">"5"</span></span><br></pre></td></tr></table></figure>
<p>7-6 從Artisan命令取得輸入</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// All arguments, including the command name</span></span><br><span class="line">$arguments = <span class="keyword">$this</span>-&gt;argument();</span><br><span class="line"><span class="comment">// Just the 'userId' argument</span></span><br><span class="line">$userid = <span class="keyword">$this</span>-&gt;argument(<span class="string">'userId'</span>);</span><br><span class="line"><span class="comment">// All options, including some defaults like 'no-interaction' and 'env'</span></span><br><span class="line">$options = <span class="keyword">$this</span>-&gt;option();</span><br><span class="line"><span class="comment">// Just the 'sendEmail' option</span></span><br><span class="line">$sendEmail = <span class="keyword">$this</span>-&gt;option(<span class="string">'sendEmail'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>7-7 從 Artisan 命令取得輸入</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// All arguments, including the command name</span></span><br><span class="line">$arguments = <span class="keyword">$this</span>-&gt;argument();</span><br><span class="line"><span class="comment">// Just the 'userId' argument</span></span><br><span class="line">$userid = <span class="keyword">$this</span>-&gt;argument(<span class="string">'userId'</span>);</span><br><span class="line"><span class="comment">// All options, including some defaults like 'no-interaction' and 'env'</span></span><br><span class="line">$options = <span class="keyword">$this</span>-&gt;option();</span><br><span class="line"><span class="comment">// Just the 'sendEmail' option</span></span><br><span class="line">$sendEmail = <span class="keyword">$this</span>-&gt;option(<span class="string">'sendEmail'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>提示</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ask()</span><br><span class="line">secret()</span><br><span class="line">comfirm()</span><br><span class="line">anticipate()</span><br><span class="line">choice()</span><br></pre></td></tr></table></figure>
<p>輸出</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">$this</span>-&gt;info(<span class="string">'Your command has run successfully.'</span>);</span><br></pre></td></tr></table></figure>
<p>表格輸出<br />
7-8 使用 Artisan 命令來輸出表格</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$headers = [<span class="string">'Name'</span>, <span class="string">'Email'</span>];</span><br><span class="line">$data = [</span><br><span class="line">[<span class="string">'Dhriti'</span>, <span class="string">'dhriti@amrit.com'</span>],</span><br><span class="line">[<span class="string">'Moses'</span>, <span class="string">'moses@gutierez.com'</span>]</span><br><span class="line">];</span><br><span class="line"><span class="comment">// Or, you could get similar data from the database:</span></span><br><span class="line"><span class="comment">// 或者，你可以從資料庫取得類似的資料</span></span><br><span class="line"><span class="comment">// $data = App\User::all(['name', 'email'])-&gt;toArray();</span></span><br><span class="line"><span class="keyword">$this</span>-&gt;table($headers, $data);</span><br></pre></td></tr></table></figure>
<p>7-9 Artisan 表格輸出範例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+---------+--------------------+</span><br><span class="line">| Name | Email |</span><br><span class="line">+---------+--------------------+</span><br><span class="line">| Dhriti | dhriti@amrit.com |</span><br><span class="line">| Moses | moses@gutierez.com |</span><br><span class="line">+---------+--------------------+</span><br></pre></td></tr></table></figure>
<p>7-10 Artisan 進度列範例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$totalUnits = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">$this</span>-&gt;output-&gt;progressStart($totalUnits);</span><br><span class="line"><span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; $totalUnits; $i++) &#123;</span><br><span class="line">    sleep(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;output-&gt;progressAdvance();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">$this</span>-&gt;output-&gt;progressFinish();</span><br></pre></td></tr></table></figure>
<p>在一般模式下呼叫Artisan命令<br />
7-11 從其他程式碼呼叫Artisan命令</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">'test-artisan'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    $exitCode = Artisan::call(<span class="string">'password:reset'</span>, [</span><br><span class="line">        <span class="string">'userId'</span> =&gt; <span class="number">15</span>, <span class="string">'--sendEmail'</span> =&gt; <span class="keyword">true</span></span><br><span class="line">    ]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>7-12 從其他的Artisan命令呼叫Artisan命令</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;callSilent(<span class="string">'password:reset'</span>, [</span><br><span class="line"><span class="string">'userId'</span> =&gt; <span class="number">15</span></span><br><span class="line">]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="thinker"><a class="markdownIt-Anchor" href="#thinker"></a> Thinker</h4>
<p>7-13 使用Thinker</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">php artisan tinker</span><br><span class="line">&gt;&gt;&gt; $user = <span class="keyword">new</span> App\User;</span><br><span class="line">=&gt; App\User: &#123;&#125;</span><br><span class="line">&gt;&gt;&gt; $user-&gt;email = <span class="string">'matt@mattstauffer.co'</span>;</span><br><span class="line">=&gt; <span class="string">"matt@mattstauffer.co"</span></span><br><span class="line">&gt;&gt;&gt; $user-&gt;password = bcrypt(<span class="string">'superSecret'</span>);</span><br><span class="line">=&gt; <span class="string">"$2y$10$TWPGBC7e8d1bvJ1q5kv.VDUGfYDnE9gANl4mleuB3htIY2dxcQfQ5"</span></span><br><span class="line">&gt;&gt;&gt; $user-&gt;save();</span><br><span class="line">=&gt; <span class="keyword">true</span></span><br></pre></td></tr></table></figure>
<p><a href="https://psysh.org/" target="_blank" rel="noopener">https://psysh.org/</a></p>
<h4 id="測試"><a class="markdownIt-Anchor" href="#測試"></a> 測試</h4>
<p>7-14 在測試程式中呼叫Artisan命令</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_empty_log_command_empties_logs_table</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">DB::table(<span class="string">'logs'</span>)-&gt;insert([<span class="string">'message'</span> =&gt; <span class="string">'Did something'</span>]);</span><br><span class="line">Artisan::call(<span class="string">'logs:empty'</span>);</span><br><span class="line"><span class="keyword">$this</span>-&gt;assertCount(<span class="number">0</span>, DB::table(<span class="string">'logs'</span>)-&gt;get());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>7-15 注入kernel，而非使用Artisan靜態介面</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Contracts</span>\<span class="title">Console</span>\<span class="title">Kernel</span>;</span><br><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NightlyCleanup</span> <span class="keyword">extends</span> <span class="title">Job</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span><span class="params">(Kernel $kernel)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// ... do other stuff</span></span><br><span class="line">        $kernel-&gt;call(<span class="string">'logs:empty'</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
        
    </section>
</article>


    <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            <a href="/2020/04/29/laravel-06/">laravel-06 收集與處理用戶資料</a>
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="http://vince115.github.io/index.html">
    
    <i class="icon-calendar"></i>
    
    <time datetime="2020-04-29T09:32:42.000Z" itemprop="datePublished">2020-04-29</time>
</a>

            
<div class="article-tag-list">
    <i class="icon-tag"></i>
    <a class="article-tag-link" href="/tags/backend/" rel="tag">backend</a>, <a class="article-tag-link" href="/tags/laravel/" rel="tag">laravel</a>
</div>


        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <h3 id="注入request物件"><a class="markdownIt-Anchor" href="#注入request物件"></a> 注入Request物件</h3>
<p>6-1 $request-&gt;all()</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- GET route form view at /get-route --&gt;</span><br><span class="line">&lt;form method=<span class="string">"post"</span> action=<span class="string">"/post-route?utm=12345"</span>&gt;</span><br><span class="line">    &#123;&#123; csrf_field() &#125;&#125;</span><br><span class="line">    &lt;input type=<span class="string">"text"</span> name=<span class="string">"firstName"</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">"submit"</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">Route::post(<span class="string">'/post-route'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Request $request)</span> </span>&#123;</span><br><span class="line">    var_dump($request-&gt;all());</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 輸出:</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* [</span></span><br><span class="line"><span class="comment">*   '_token' =&gt; 'CSRF token here',</span></span><br><span class="line"><span class="comment">*   'firstName' =&gt; 'value',</span></span><br><span class="line"><span class="comment">*   'utm' =&gt; 12345</span></span><br><span class="line"><span class="comment">* ]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>6-2 $request-&gt;except()</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Route::post(<span class="string">'/post-route'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Request $request)</span> </span>&#123;</span><br><span class="line">var_dump($request-&gt;except(<span class="string">'_token'</span>));</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// Outputs:</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* [</span></span><br><span class="line"><span class="comment">*   'firstName' =&gt; 'value',</span></span><br><span class="line"><span class="comment">*   'utm' =&gt; 12345</span></span><br><span class="line"><span class="comment">* ]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>6-3 $request-&gt;except()</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Route::post(<span class="string">'/post-route'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Request $request)</span> </span>&#123;</span><br><span class="line">var_dump($request-&gt;only([<span class="string">'firstName'</span>, <span class="string">'utm'</span>]));</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// Outputs:</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* [</span></span><br><span class="line"><span class="comment">*   'firstName' =&gt; 'value',</span></span><br><span class="line"><span class="comment">*   'utm' =&gt; 12345</span></span><br><span class="line"><span class="comment">* ]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h4 id="request-has-與-request-exists"><a class="markdownIt-Anchor" href="#request-has-與-request-exists"></a> $request-&gt;has() 與 $request-&gt;exists()</h4>
<p>6-4 $request-&gt;has()</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// POST route 的post路由</span></span><br><span class="line"><span class="keyword">if</span> ($request-&gt;has(<span class="string">'utm'</span>)) &#123;</span><br><span class="line">    <span class="comment">// 作一些分析工作</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="request-input"><a class="markdownIt-Anchor" href="#request-input"></a> $request-&gt;input()</h4>
<p>6-5 $request-&gt;input()</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::post(<span class="string">'/post-route'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Request $request)</span> </span>&#123;</span><br><span class="line">    $userName = $request-&gt;input(<span class="string">'name'</span>, <span class="string">'(anonymous)'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="request-input-2"><a class="markdownIt-Anchor" href="#request-input-2"></a> $request-&gt;input()</h4>
<p>6-6 取得用戶的陣列值的句點標記法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- GET route form view at /get-route 路由表單視圖--&gt;</span><br><span class="line">&lt;form method=<span class="string">"post"</span> action=<span class="string">"/post-route"</span>&gt;</span><br><span class="line">    &#123;&#123; csrf_field() &#125;&#125;</span><br><span class="line">    &lt;input type=<span class="string">"text"</span> name=<span class="string">"employees[0][firstName]"</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">"text"</span> name=<span class="string">"employees[0][lastName]"</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">"text"</span> name=<span class="string">"employees[1][firstName]"</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">"text"</span> name=<span class="string">"employees[1][lastName]"</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">"submit"</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"><span class="comment">// post-route的POST路由</span></span><br><span class="line">Route::post(<span class="string">'/post-route'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Request $request)</span> </span>&#123;</span><br><span class="line">    $employeeZeroFirstName = $request-&gt;input(<span class="string">'employees.0.firstName'</span>);</span><br><span class="line">    $allLastNames = $request-&gt;input(<span class="string">'employees.*.lastName'</span>);</span><br><span class="line">    $employeeOne = $request-&gt;input(<span class="string">'employees.1'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 如果表單被填為 "Jim" "Smith" "Bob" "Jones":</span></span><br><span class="line"><span class="comment">// $employeeZeroFirstName = 'Jim';</span></span><br><span class="line"><span class="comment">// $allLastNames = ['Smith', 'Jones'];</span></span><br><span class="line"><span class="comment">// $employeeOne = ['firstName' =&gt; 'Bob', 'lastName' =&gt; 'Jones']</span></span><br></pre></td></tr></table></figure>
<h4 id="json-輸入與request-json"><a class="markdownIt-Anchor" href="#json-輸入與request-json"></a> JSON 輸入(與$request-&gt;json())</h4>
<p>6-7 使用$request-&gt;input()來從JSON取得資料</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">POST /post-route HTTP/<span class="number">1.1</span></span><br><span class="line">Content-Type: application/json</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"firstName"</span>: <span class="string">"Joe"</span>,</span><br><span class="line">    <span class="string">"lastName"</span>: <span class="string">"Schmoe"</span>,</span><br><span class="line">    <span class="string">"spouse"</span>: &#123;</span><br><span class="line">    <span class="string">"firstName"</span>: <span class="string">"Jill"</span>,</span><br><span class="line">    <span class="string">"lastName"</span>:<span class="string">"Schmoe"</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// post-路由</span></span><br><span class="line">Route::post(<span class="string">'post-route'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Request $request)</span> </span>&#123;</span><br><span class="line">    $firstName = $request-&gt;input(<span class="string">'firstName'</span>);</span><br><span class="line">    $spouseFirstname = $request-&gt;input(<span class="string">'spouse.firstName'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="路由資料"><a class="markdownIt-Anchor" href="#路由資料"></a> 路由資料</h3>
<h4 id="從request"><a class="markdownIt-Anchor" href="#從request"></a> 從Request</h4>
<h4 id="從路由參數"><a class="markdownIt-Anchor" href="#從路由參數"></a> 從路由參數</h4>
<p>6-8 從路由參數取得URL詳細資訊</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">// routes/web.php</span></span><br><span class="line">    Route::get(<span class="string">'users/&#123;id&#125;'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($id)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// If the user visits myapp.com/users/15/, $id will equal 15</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="上傳的檔案"><a class="markdownIt-Anchor" href="#上傳的檔案"></a> 上傳的檔案</h3>
<p>6-9 上傳檔案的表單</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;form method=<span class="string">"post"</span> enctype=<span class="string">"multipart/form-data"</span>&gt;</span><br><span class="line">    &#123;&#123; csrf_field() &#125;&#125;</span><br><span class="line">    &lt;input type=<span class="string">"text"</span> name=<span class="string">"name"</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">"file"</span> name=<span class="string">"profile_picture"</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">"submit"</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>
<p>6-10 提交範例6-9的表單產生的輸出</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Route::post(<span class="string">'form'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Request $request)</span> </span>&#123;</span><br><span class="line">    var_dump($request-&gt;all());</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line"><span class="comment">// [</span></span><br><span class="line"><span class="comment">// "_token" =&gt; "token here"</span></span><br><span class="line"><span class="comment">// "name" =&gt; "asdf"</span></span><br><span class="line"><span class="comment">// "profile_picture" =&gt; UploadedFile &#123;&#125;</span></span><br><span class="line"><span class="comment">// ]</span></span><br><span class="line">Route::post(<span class="string">'form'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Request $request)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ($request-&gt;hasFile(<span class="string">'profile_picture'</span>)) &#123;</span><br><span class="line">        var_dump($request-&gt;file(<span class="string">'profile_picture'</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line"><span class="comment">// UploadedFile (details)</span></span><br></pre></td></tr></table></figure>
<p>6-11 常見的檔案上傳流程</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ($request-&gt;hasFile(<span class="string">'profile_picture'</span>)) &#123;</span><br><span class="line">    $path = $request-&gt;profile_picture-&gt;store(<span class="string">'profiles'</span>, <span class="string">'s3'</span>);</span><br><span class="line">    auth()-&gt;user()-&gt;profile_picture = $path;</span><br><span class="line">    auth()-&gt;user()-&gt;save();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="驗證"><a class="markdownIt-Anchor" href="#驗證"></a> 驗證</h3>
<h4 id="在控制器內使用validatesrequests的validate"><a class="markdownIt-Anchor" href="#在控制器內使用validatesrequests的validate"></a> 在控制器內使用ValidatesRequests的validate()</h4>
<p>6-12 控制器驗證基本用法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//routes/web.php</span></span><br><span class="line">Route::get(<span class="string">'recipes/create'</span>,<span class="string">'RecipesController@create'</span>);</span><br><span class="line">Route::post(<span class="string">'recipes'</span>,<span class="string">'RecipesController@store'</span>);</span><br></pre></td></tr></table></figure>
<p>6-13 手動驗證</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">'recipes/create'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> view(<span class="string">'recipes.create'</span>);</span><br><span class="line">&#125;);</span><br><span class="line">Route::post(<span class="string">'recipes'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Illuminate\Http\Request $request)</span> </span>&#123;</span><br><span class="line">$validator = Validator::make($request-&gt;all(), [</span><br><span class="line">    <span class="string">'title'</span> =&gt; <span class="string">'required|unique:recipes|max:125'</span>,</span><br><span class="line">    <span class="string">'body'</span> =&gt; <span class="string">'required'</span></span><br><span class="line">]);</span><br><span class="line"><span class="keyword">if</span> ($validator-&gt;fails()) &#123;</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">'recipes/create'</span>)</span><br><span class="line">    -&gt;withErrors($validator)</span><br><span class="line">    -&gt;withInput();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Recipe is valid; proceed to save it</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>6-14 Echo驗證錯誤</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">if</span> ($errors-&gt;any())</span><br><span class="line">    &lt;ul id=<span class="string">"errors"</span>&gt;</span><br><span class="line">        @<span class="keyword">foreach</span> ($errors-&gt;all() <span class="keyword">as</span> $error)</span><br><span class="line">            &lt;li&gt;&#123;&#123; $error &#125;&#125;&lt;/li&gt;</span><br><span class="line">        @<span class="keyword">endforeach</span></span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">@<span class="keyword">endif</span></span><br></pre></td></tr></table></figure>
<p>6-15 表單請求範例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Requests</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">BlogPost</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Requests</span>\<span class="title">Request</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CreateCommentRequest</span> <span class="keyword">extends</span> <span class="title">Request</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">rules</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">        <span class="string">'body'</span> =&gt; <span class="string">'required|max:1000'</span></span><br><span class="line">        ];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">authorize</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $blogPostId = <span class="keyword">$this</span>-&gt;route(<span class="string">'blogPost'</span>);</span><br><span class="line">        <span class="keyword">return</span> auth()-&gt;check() &amp;&amp; BlogPost::where(<span class="string">'id'</span>, $blogPostId)</span><br><span class="line">            -&gt;where(<span class="string">'user_id'</span>, auth()-&gt;user()-&gt;id)-&gt;exists();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>6-16 使用表單請求</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::post(<span class="string">'comments'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(App\Http\Requests\CreateCommentRequest $request)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Store comment 儲存評論</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>6-17 將整個表單傳遞給Eloquent模型</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::post(<span class="string">'posts'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Request $request)</span> </span>&#123;</span><br><span class="line">$newPost = Post::create($request-&gt;all());</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>6-18 讓Eloquent模型免於遭受惡意大量賦值</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Post</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// Disable mass assignment on the author_id field</span></span><br><span class="line">    <span class="keyword">protected</span> $guarded = [<span class="string">'author_id'</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>使用$request-&gt;only()來雙重保護</p>
</blockquote>
<p>6-19 測試被注入的非法輸入</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_input_missing_a_title_is_rejected</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;post(<span class="string">'posts'</span>, [<span class="string">'body'</span> =&gt; <span class="string">'This is the body of my post'</span>]);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;assertRedirectedTo(<span class="string">'posts/create'</span>);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;assertSessionHasErrors();</span><br><span class="line">    <span class="keyword">$this</span>-&gt;assertHasOldInput();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>6-20 測試有效的輸入已被處理</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_valid_input_should_create_a_post_in_the_database</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;post(<span class="string">'posts'</span>, [<span class="string">'title'</span> =&gt; <span class="string">'Post Title'</span>, <span class="string">'body'</span> =&gt; <span class="string">'This is the body'</span>]);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;seeInDatabase([<span class="string">'title'</span> =&gt; <span class="string">'Post Title'</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        
    </section>
</article>


    <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            <a href="/2020/04/29/laravel-05/">laravel-05 前端元件</a>
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="http://vince115.github.io/index.html">
    
    <i class="icon-calendar"></i>
    
    <time datetime="2020-04-29T00:31:42.000Z" itemprop="datePublished">2020-04-29</time>
</a>

            
<div class="article-tag-list">
    <i class="icon-tag"></i>
    <a class="article-tag-link" href="/tags/backend/" rel="tag">backend</a>, <a class="article-tag-link" href="/tags/laravel/" rel="tag">laravel</a>
</div>


        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <h3 id="elixir"><a class="markdownIt-Anchor" href="#elixir"></a> Elixir</h3>
<p>Laravel Elixir 提供了簡潔流暢的 API，讓你能夠為你的 Laravel 應用程式定義基本的 Gulp 任務。Elixir 支援許多常見的 CSS 與 JavaScrtip 預處理器，甚至包含了測試工具。<br />
<a href="https://laravel.tw/docs/5.0/elixir" target="_blank" rel="noopener">https://laravel.tw/docs/5.0/elixir</a></p>
<p>5-1 在Gulp編輯Sass檔案</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gulp = <span class="keyword">require</span>(<span class="string">'gulp'</span>),</span><br><span class="line">sass = <span class="keyword">require</span>(<span class="string">'gulp-ruby-sass'</span>),</span><br><span class="line">autoprefixer = <span class="keyword">require</span>(<span class="string">'gulp-autoprefixer'</span>),</span><br><span class="line">rename = <span class="keyword">require</span>(<span class="string">'gulp-rename'</span>),</span><br><span class="line">notify = <span class="keyword">require</span>(<span class="string">'gulp-notify'</span>),</span><br><span class="line">livereload = <span class="keyword">require</span>(<span class="string">'gulp-livereload'</span>),</span><br><span class="line">lr = <span class="keyword">require</span>(<span class="string">'tiny-lr'</span>),</span><br><span class="line">server = lr();</span><br><span class="line">gulp.task(<span class="string">'sass'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> gulp.src(<span class="string">'resources/assets/sass/app.scss'</span>)</span><br><span class="line">.pipe(sass(&#123;</span><br><span class="line">style: <span class="string">'compressed'</span>,</span><br><span class="line">sourcemap: <span class="keyword">true</span></span><br><span class="line">&#125;))</span><br><span class="line">.pipe(autoprefixer(<span class="string">'last 2 version'</span>, <span class="string">'ie 9'</span>, <span class="string">'ios 6'</span>))</span><br><span class="line">.pipe(gulp.dest(<span class="string">'public/css'</span>))</span><br><span class="line">.pipe(rename(&#123;suffix: <span class="string">'.min'</span>&#125;))</span><br><span class="line">.pipe(livereload(server))</span><br><span class="line">.pipe(notify(&#123;</span><br><span class="line">title: <span class="string">"Karani"</span>,</span><br><span class="line">message: <span class="string">"Styles task complete."</span></span><br><span class="line">&#125;));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>5-2 用Elixir來編輯Sass檔案</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> elixir = <span class="keyword">require</span>(<span class="string">'laravel-elixir'</span>);</span><br><span class="line">elixir(<span class="function"><span class="keyword">function</span> <span class="params">(mix)</span> </span>&#123;</span><br><span class="line">mix.sass(<span class="string">'app.scss'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>ES6 IN ELIXIR 6</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> elixir = <span class="keyword">require</span>(<span class="string">'laravel-elixir'</span>);</span><br><span class="line">elixir(mix =&gt; &#123;</span><br><span class="line">mix.sass(<span class="string">'app.scss'</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="elixir-資料夾"><a class="markdownIt-Anchor" href="#elixir-資料夾"></a> Elixir 資料夾</h4>
<h4 id="elixir-資料夾結構"><a class="markdownIt-Anchor" href="#elixir-資料夾結構"></a> Elixir 資料夾結構</h4>
<h4 id="elixir-提供什麼功能"><a class="markdownIt-Anchor" href="#elixir-提供什麼功能"></a> Elixir 提供什麼功能？</h4>
<h4 id="-production-旗標"><a class="markdownIt-Anchor" href="#-production-旗標"></a> -production 旗標</h4>
<h4 id="傳遞多個檔案"><a class="markdownIt-Anchor" href="#傳遞多個檔案"></a> 傳遞多個檔案</h4>
<p>5-3 用Elixir來編譯多個檔案</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> elixir = <span class="keyword">require</span>(<span class="string">'laravel-elixir'</span>);</span><br><span class="line">elixir(mix =&gt; &#123;</span><br><span class="line">mix.sass([</span><br><span class="line"><span class="string">'app.scss'</span>,</span><br><span class="line"><span class="string">'public.scss'</span></span><br><span class="line">]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="來源對應"><a class="markdownIt-Anchor" href="#來源對應"></a> 來源對應</h4>
<p>5-4 停用Elixir的來源對應</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> elixir = <span class="keyword">require</span>(<span class="string">'laravel-elixir'</span>);</span><br><span class="line">elixir.config.sourcemaps = <span class="keyword">false</span>;</span><br><span class="line">elixir(mix =&gt; &#123;</span><br><span class="line">mix.sass(<span class="string">'app.scss'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="無前置處理的css"><a class="markdownIt-Anchor" href="#無前置處理的css"></a> 無前置處理的CSS</h4>
<p>5-5 使用Elixir來結合樣式表</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> elixir = <span class="keyword">require</span>(<span class="string">'laravel-elixir'</span>);</span><br><span class="line"></span><br><span class="line">elixir(mix =&gt; &#123;</span><br><span class="line"><span class="comment">// 結合 resources/assets/css 與子目錄的所有檔案</span></span><br><span class="line">mix.styles();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 結合 resources/assets/css 的檔案</span></span><br><span class="line">mix.styles([</span><br><span class="line"><span class="string">'normalize.css'</span>,</span><br><span class="line"><span class="string">'app.css'</span></span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 結合其他目錄的所有樣式</span></span><br><span class="line">mix.stylesIn(<span class="string">'resources/some/other/css/directory'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 結合 resources/assets/css 內指定的樣式</span></span><br><span class="line"><span class="comment">// 並輸出置一個自訂的目錄</span></span><br><span class="line">mix.styles([</span><br><span class="line"><span class="string">'normalize.css'</span>,</span><br><span class="line"><span class="string">'app.css'</span></span><br><span class="line">], <span class="string">'public/other/css/output.css'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 結合自訂目錄指定樣式</span></span><br><span class="line"><span class="comment">// 並輸出至一個自訂的目錄</span></span><br><span class="line">mix.styles([</span><br><span class="line"><span class="string">'normalize.css'</span>,</span><br><span class="line"><span class="string">'app.css'</span></span><br><span class="line">], <span class="string">'public/other/css/output.css'</span>, <span class="string">'resources/some/other/css/directory'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="串接javascript"><a class="markdownIt-Anchor" href="#串接javascript"></a> 串接JavaScript</h4>
<p>5-6 使用Elixir來結合JavaScript檔案</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> elixir = <span class="keyword">require</span>(<span class="string">'laravel-elixir'</span>);</span><br><span class="line">elixir(mix =&gt; &#123;</span><br><span class="line"><span class="comment">// 結合 resources/assets/js　的檔案</span></span><br><span class="line">mix.scripts([</span><br><span class="line"><span class="string">'jquery.js'</span>,</span><br><span class="line"><span class="string">'app.js'</span></span><br><span class="line">]);</span><br><span class="line"><span class="comment">// 結合其他目錄的所有腳本</span></span><br><span class="line">mix.scriptsIn(<span class="string">'resources/some/other/js/directory'</span>);</span><br><span class="line"><span class="comment">// 結合resources/assets/js的指定腳本</span></span><br><span class="line"><span class="comment">// 並輸出至一個自訂的目錄</span></span><br><span class="line">mix.scripts([</span><br><span class="line"><span class="string">'jquery.js'</span>,</span><br><span class="line"><span class="string">'app.js'</span></span><br><span class="line">], <span class="string">'public/other/js/output.js'</span>);</span><br><span class="line"><span class="comment">// 結合自訂目錄的指定腳本</span></span><br><span class="line"><span class="comment">// 並輸出至一個自訂的目錄</span></span><br><span class="line">mix.scripts([</span><br><span class="line"><span class="string">'jquery.js'</span>,</span><br><span class="line"><span class="string">'app.js'</span></span><br><span class="line">], <span class="string">'public/other/js/output.js'</span>, <span class="string">'resources/some/other/js/directory'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="預先處理javascript"><a class="markdownIt-Anchor" href="#預先處理javascript"></a> 預先處理JavaScript</h4>
<p>5-7 在Elixir中使用Webpack或Rollup來處理JavaScript檔案</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">elixir(<span class="function"><span class="keyword">function</span><span class="params">(mix)</span> </span>&#123;</span><br><span class="line">mix.webpack(<span class="string">'app.js'</span>);</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line">mix.rollup(<span class="string">'app.js'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="版本控制"><a class="markdownIt-Anchor" href="#版本控制"></a> 版本控制</h4>
<p>5-8 mix.version</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> elixir = <span class="keyword">require</span>(<span class="string">'laravel-elixir'</span>);</span><br><span class="line">elixir(mix =&gt; &#123;</span><br><span class="line">mix.version(<span class="string">'public/css/all.css'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>5-9 在視圖中使用elixir()輔助函式</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;link rel=<span class="string">"stylesheet"</span> href=<span class="string">"&#123;&#123; elixir("</span>css/all.css<span class="string">") &#125;&#125;"</span>&gt;</span><br><span class="line"><span class="comment">// will output something like:</span></span><br><span class="line">&lt;link rel=<span class="string">"stylesheet"</span> href=<span class="string">"/build/css/all-84fa1258.css"</span>&gt;</span><br></pre></td></tr></table></figure>
<p>####　Elixir 擴展</p>
<p>5-10 在Elixir中使用Gulp工作</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定義工作</span></span><br><span class="line">gulp.task(<span class="string">"log"</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">var</span> message = <span class="string">"Something happened"</span>;</span><br><span class="line">gulp.src(<span class="string">""</span>).pipe(shell(<span class="string">'echo "'</span> + message + <span class="string">'" &gt;&gt; file.log'</span>));</span><br><span class="line">&#125;);</span><br><span class="line">elixir(mix =&gt; &#123;</span><br><span class="line"><span class="comment">//在Elixir中使用工作</span></span><br><span class="line">mix.task(<span class="string">'log'</span>);</span><br><span class="line"><span class="comment">// 綁定工作，讓它在每次有某些檔案改變時執行</span></span><br><span class="line">mix.task(<span class="string">'log'</span>, <span class="string">'resources/somefiles/to/watch/**/*'</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>5-11 建立Elixir擴展</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在gulpfile.js內，或在外部檔案require gulpfile.js</span></span><br><span class="line"><span class="keyword">var</span> gulp = <span class="keyword">require</span>(<span class="string">"gulp"</span>),</span><br><span class="line">shell = <span class="keyword">require</span>(<span class="string">"gulp-shell"</span>),</span><br><span class="line">elixir = <span class="keyword">require</span>(<span class="string">"laravel-elixir"</span>);</span><br><span class="line">elixir.extend(<span class="string">"log"</span>, <span class="function"><span class="keyword">function</span> <span class="params">(message)</span> </span>&#123;</span><br><span class="line"><span class="keyword">new</span> Task(<span class="string">'log'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> gulp.src(<span class="string">''</span>).pipe(shell(<span class="string">'echo "'</span> + message + <span class="string">'" &gt;&gt; file.log'</span>));</span><br><span class="line">&#125;)</span><br><span class="line">.watch(<span class="string">'./resources/some/files/**/*'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>5-12 對查詢產生器的回應進行分頁</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> view(<span class="string">'posts.index'</span>, [<span class="string">'posts'</span> =&gt; DB::table(<span class="string">'posts'</span>)-&gt;paginate(<span class="number">20</span>)]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>5-13 在模板中顯示分頁連結</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;table&gt;</span><br><span class="line">@<span class="keyword">foreach</span> ($posts <span class="keyword">as</span> $post)</span><br><span class="line">&lt;tr&gt;&lt;td&gt;&#123;&#123; $post-&gt;title &#125;&#125;&lt;/td&gt;&lt;/tr&gt;</span><br><span class="line">@<span class="keyword">endforeach</span></span><br><span class="line">&lt;/table&gt;</span><br><span class="line">&#123;&#123; $posts-&gt;links() &#125;&#125;</span><br><span class="line"><span class="comment">// 在預設情況下, $posts-&gt;links() 會輸出如下:</span></span><br><span class="line">&lt;ul class="pagination"&gt;</span><br><span class="line">&lt;li class="disabled"&gt;&lt;span&gt;&amp;laquo;&lt;/span&gt;&lt;/li&gt;</span><br><span class="line">&lt;li class="active"&gt;&lt;span&gt;1&lt;/span&gt;&lt;/li&gt;</span><br><span class="line">&lt;li&gt;&lt;a href=<span class="string">"http://myapp.com/posts?page=2"</span>&gt;<span class="number">2</span>&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">&lt;li&gt;&lt;a href=<span class="string">"http://myapp.com/posts?page=3"</span>&gt;<span class="number">3</span>&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">&lt;li&gt;&lt;a href=<span class="string">"http://myapp.com/posts?page=2"</span> rel=<span class="string">"next"</span>&gt;&amp;raquo;&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure>
<p>手動建立分頁器<br />
5-14 在Laravel 5.2與5.3手動建立分頁器</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Pagination</span>\<span class="title">Paginator</span>;</span><br><span class="line">Route::get(<span class="string">'people'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Request $request)</span> </span>&#123;</span><br><span class="line">$people = [...]; <span class="comment">// huge list of people</span></span><br><span class="line">$perPage = <span class="number">15</span>;</span><br><span class="line">$offsetPages = $request-&gt;input(<span class="string">'page'</span>, <span class="number">1</span>) - <span class="number">1</span>;</span><br><span class="line"><span class="comment">// The Paginator will not slice your array for you</span></span><br><span class="line">$people = array_slice(</span><br><span class="line">$people,</span><br><span class="line">$offsetPages * $perPage,</span><br><span class="line">$perPage</span><br><span class="line">);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> Paginator(</span><br><span class="line">$people,</span><br><span class="line">$perPage</span><br><span class="line">);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>訊息袋<br />
5-15 手動建立與使用MessageBag</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$messages = [</span><br><span class="line"><span class="string">'errors'</span> =&gt; [</span><br><span class="line"><span class="string">'Something went wrong with edit 1!'</span></span><br><span class="line">],</span><br><span class="line"><span class="string">'messages'</span> =&gt; [</span><br><span class="line"><span class="string">'Edit 2 was successful.'</span></span><br><span class="line">]</span><br><span class="line">];</span><br><span class="line">$messagebag = <span class="keyword">new</span> \Illuminate\Support\MessageBag($messages);</span><br><span class="line"><span class="comment">// Check for errors; if there are any, decorate and echo</span></span><br><span class="line"><span class="keyword">if</span> ($messagebag-&gt;has(<span class="string">'errors'</span>)) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;ul id="errors"&gt;'</span>;</span><br><span class="line"><span class="keyword">foreach</span> ($messagebag-&gt;get(<span class="string">'errors'</span>, <span class="string">'&lt;li&gt;&lt;b&gt;:message&lt;/b&gt;&lt;/li&gt;'</span>) <span class="keyword">as</span> $error) &#123;</span><br><span class="line"><span class="keyword">echo</span> $error;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;/ul&gt;'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>5-16 錯誤袋程式片段</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// partials/errors.blade.php</span></span><br><span class="line">@<span class="keyword">if</span> ($errors-&gt;any())</span><br><span class="line">&lt;div class="alert alert-danger"&gt;</span><br><span class="line">&lt;ul&gt;</span><br><span class="line">@<span class="keyword">foreach</span> ($errors <span class="keyword">as</span> $error)</span><br><span class="line">&lt;li&gt;&#123;&#123; $error &#125;&#125;&lt;/li&gt;</span><br><span class="line">@<span class="keyword">endforeach</span></span><br><span class="line">&lt;/ul&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">@<span class="keyword">endif</span></span><br></pre></td></tr></table></figure>
<p>5-17 trans()基本用法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 一般的 PHP</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> trans(<span class="string">'navigation.back'</span>); <span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">// Blade</span></span><br><span class="line">&#123;&#123; trans(<span class="string">'navigation.back'</span>) &#125;&#125;</span><br><span class="line"><span class="comment">// Blade 指令</span></span><br><span class="line">@lang(<span class="string">'navigation.back'</span>)</span><br></pre></td></tr></table></figure>
<p>5-18 使用翻譯</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// resources/lang/es/navigation.php</span></span><br><span class="line"><span class="keyword">return</span> [</span><br><span class="line"><span class="string">'back'</span> =&gt; <span class="string">'Volver al panel'</span></span><br><span class="line">];</span><br><span class="line"><span class="comment">// routes/web.php</span></span><br><span class="line">Route::get(<span class="string">'/es/contacts/show/:id'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// Setting it manually, for this example, instead of in a service provider</span></span><br><span class="line">App::setLocale(<span class="string">'es'</span>);</span><br><span class="line"><span class="keyword">return</span> view(<span class="string">'contacts.show'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// resources/views/contacts/show.blade.php</span></span><br><span class="line">&lt;a href=<span class="string">"/contacts"</span>&gt;&#123;&#123; trans(<span class="string">'navigation.back'</span>) &#125;&#125;&lt;/a&gt;</span><br></pre></td></tr></table></figure>
<p>5-19 翻譯的參數</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// resources/lang/en/navigation.php</span></span><br><span class="line"><span class="keyword">return</span> [</span><br><span class="line"><span class="string">'back'</span> =&gt; <span class="string">'Back to :section dashbaord'</span></span><br><span class="line">];</span><br><span class="line"><span class="comment">// resources/views/contacts/show.blade.php</span></span><br><span class="line">&#123;&#123; trans(<span class="string">'navigation.back'</span>, [<span class="string">'section'</span> =&gt; <span class="string">'contacts'</span>]) &#125;&#125;</span><br></pre></td></tr></table></figure>
<p>5-20 使用複數化選項來定義簡單的翻譯</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// resources/lang/en/messages.php</span></span><br><span class="line"><span class="keyword">return</span> [</span><br><span class="line"><span class="string">'task-deletion'</span> =&gt; <span class="string">'You have deleted a task|You have successfully deleted tasks'</span></span><br><span class="line">];</span><br><span class="line"><span class="comment">// resources/views/dashboard.blade.php</span></span><br><span class="line">@<span class="keyword">if</span> ($numTasksDeleted &gt; <span class="number">0</span>)</span><br><span class="line">&#123;&#123; trans_choice(<span class="string">'messages.task-deletion'</span>, $numTasksDeleted) &#125;&#125;</span><br><span class="line">@<span class="keyword">endif</span></span><br></pre></td></tr></table></figure>
<p>5-21 使用Symfony的翻譯元件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// resources/lang/es/messages.php</span></span><br><span class="line"><span class="keyword">return</span> [</span><br><span class="line"><span class="string">'task-deletion'</span>=&gt;<span class="string">"&#123;0&#125;  You didn't manage to delete any tasks. |"</span> </span><br><span class="line">  <span class="string">"[1,4] You deleted a few tasks.|"</span> . </span><br><span class="line">  <span class="string">"[5,Inf] You deleted a whole ton of tasks."</span></span><br></pre></td></tr></table></figure>
<h4 id="測試訊息與錯誤袋"><a class="markdownIt-Anchor" href="#測試訊息與錯誤袋"></a> 測試訊息與錯誤袋</h4>
<p>5-22 判斷session有沒有錯誤</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_missing_email_field_errors</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;post(<span class="string">'person/create'</span>, [<span class="string">'name'</span> =&gt; <span class="string">'Japheth'</span>]);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;assertSessionHasErrors([<span class="string">'email'</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        
    </section>
</article>


    <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            <a href="/2020/04/28/laravel-04/">laravel-04 板模</a>
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="http://vince115.github.io/index.html">
    
    <i class="icon-calendar"></i>
    
    <time datetime="2020-04-28T03:49:25.000Z" itemprop="datePublished">2020-04-28</time>
</a>

            
<div class="article-tag-list">
    <i class="icon-tag"></i>
    <a class="article-tag-link" href="/tags/backend/" rel="tag">backend</a>, <a class="article-tag-link" href="/tags/laravel/" rel="tag">laravel</a>
</div>


        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <h3 id="blade模版"><a class="markdownIt-Anchor" href="#blade模版"></a> Blade模版</h3>
<p>4-1 Blade 範例</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123;$group-&gt;title&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">&#123;!! $group-&gt;heroImageHtml()!!&#125;</span><br><span class="line">@forelse($users as $user)</span><br><span class="line">??&#123;&#123;$user-&gt;frist_name&#125;&#125;&#123;&#123;$user-&gt;last_name&#125;&#125;<span class="tag">&lt;<span class="name">br</span>&gt;</span> </span><br><span class="line">@empty</span><br><span class="line">No users in this group.</span><br><span class="line">@endforelse</span><br></pre></td></tr></table></figure>
<h3 id="回應資料"><a class="markdownIt-Anchor" href="#回應資料"></a> 回應資料</h3>
<h3 id="控制結構"><a class="markdownIt-Anchor" href="#控制結構"></a> 控制結構</h3>
<h3 id="條件"><a class="markdownIt-Anchor" href="#條件"></a> 條件</h3>
<p>邏輯控制結構</p>
<p>@if</p>
<p>4-2 @if、@else、@elseif與@endif</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">if</span>(count($tasks)===<span class="number">1</span>)</span><br><span class="line"> There is one talk at this time period.</span><br><span class="line">@<span class="keyword">elseif</span>(count($tasks)===<span class="number">0</span>)</span><br><span class="line"> There are no talks at this time period.</span><br><span class="line">@<span class="keyword">else</span></span><br><span class="line"> There are &#123;&#123;count($tasks)&#125;&#125; talks at this time period.</span><br><span class="line">@<span class="keyword">endif</span></span><br></pre></td></tr></table></figure>
<p>@unless 與 @endunless</p>
<p>4-3 @unless 與 @endunless<br />
它是@if的相反</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@unless($user-&gt;hasPaid())</span><br><span class="line">   You can complete your payment by switching to the payment tab.</span><br><span class="line">@endunless</span><br></pre></td></tr></table></figure>
<p>4-4 @for 與 @endfor</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;$task-&gt;slotsCount();$i++)</span><br><span class="line">    The number is  &#123;&#123;$i&#125;&#125; &lt;br&gt;</span><br><span class="line">@<span class="keyword">endfor</span></span><br></pre></td></tr></table></figure>
<p>4-5 @foreach 與 @endforeach</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">for</span>($talks <span class="keyword">as</span> $talk)</span><br><span class="line">  &#123;&#123;$talk-&gt;title&#125;&#125; (&#123;&#123;$talk-&gt;length&#125;&#125; minutes) &lt;br&gt; </span><br><span class="line">@<span class="keyword">endfor</span></span><br></pre></td></tr></table></figure>
<p>4-6 @while 與 @endwhile</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">while</span>($item = array_pop($items))</span><br><span class="line">    &#123;&#123; $item -&gt; orSomething() &#125;&#125; &lt;br&gt;</span><br><span class="line">@<span class="keyword">endwhile</span></span><br></pre></td></tr></table></figure>
<p>4-7 @forelse</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@forelse($talks <span class="keyword">as</span> $talk)</span><br><span class="line">  * &#123;&#123;$talk-&gt;title&#125;&#125;(&#123;&#123;$talk-&gt;length&#125;&#125; minutes) &lt;br&gt;</span><br><span class="line">@<span class="keyword">empty</span></span><br><span class="line">  No talks this day.</span><br><span class="line">@endforelse</span><br></pre></td></tr></table></figure>
<p>index<br />
iteration<br />
remaining<br />
count<br />
first<br />
last<br />
depth<br />
parent</p>
<h3 id="模板繼承"><a class="markdownIt-Anchor" href="#模板繼承"></a> 模板繼承</h3>
<h3 id="使用sectionshow-與-yield-來定義區段"><a class="markdownIt-Anchor" href="#使用sectionshow-與-yield-來定義區段"></a> 使用@section/@show 與 @yield 來定義區段</h3>
<p>4-8 Blade 版面配置</p>
 <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- resource/views/layouts/master.blade.php --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>My Site | @yield('title','Home Page')<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">   @yield('content')</span><br><span class="line"> <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> @section('footerScripts')</span><br><span class="line">   <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"app.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> @show</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>4-9 擴展Blade配置</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- resource/views/dashboard.blade.php --&gt;</span></span><br><span class="line">@extends('layouts.master')</span><br><span class="line">@section('title','Dashboard')</span><br><span class="line">@section('content')</span><br><span class="line">  Welcome to your application dashboard!</span><br><span class="line">@endsection</span><br><span class="line">@section('footerScripts')</span><br><span class="line">  @parents</span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"dashboard.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">@endsection</span><br></pre></td></tr></table></figure>
<p>@extends</p>
<p>@section 與 @endsection</p>
<p>@parent</p>
<p>@include<br />
4-10 使用@include來納入部分的視圖</p>
 <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- resource/views/home.blade.php --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"content"</span> <span class="attr">data-page-name</span>=<span class="string">"&#123;&#123;$pageName&#125;&#125;"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span> Here's why you should sign up for our app:<span class="tag">&lt;<span class="name">strong</span>&gt;</span>It's Great.<span class="tag">&lt;/<span class="name">strong</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">@include('sign-up-button',['text' =&gt; 'See just how great it is'])</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>@each<br />
4-11 以@each 來使用迴圈中的部分視圖</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- resource/views/sidebar.blade.php --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sidebar"</span>&gt;</span></span><br><span class="line">@each('partials.module',$modules,'module','partials.empty-module')</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--resource/views/partials/module.blade.php--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sidebar-module"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123;$module-&gt;title&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--resource/views/partials/empty-module.blade.php--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sidebar-module"</span>&gt;</span></span><br><span class="line">  No modules :(</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="視圖組件與服務注入"><a class="markdownIt-Anchor" href="#視圖組件與服務注入"></a> 視圖組件與服務注入</h3>
<p>4-12 複習將資料傳給視圖</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">'passing-data-to-views'</span>,<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> view(<span class="string">'dashboard'</span>)</span><br><span class="line">    -&gt;with(<span class="string">'key'</span>,<span class="string">'value'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="使用視圖組件來將資料綁定視圖"><a class="markdownIt-Anchor" href="#使用視圖組件來將資料綁定視圖"></a> 使用視圖組件來將資料綁定視圖</h3>
<p>4-13 從每一個路由傳入資訊看板資料</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">'home'</span>,<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> view(<span class="string">'home'</span>)</span><br><span class="line">      -&gt;with(<span class="string">'posts'</span>,Post::recent());</span><br><span class="line">&#125;)</span><br><span class="line">Route::get(<span class="string">'about'</span>,<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> view(<span class="string">'about'</span>)</span><br><span class="line">      -&gt;with(<span class="string">'posts'</span>, Post::recent());</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="全域共用變數"><a class="markdownIt-Anchor" href="#全域共用變數"></a> 全域共用變數</h3>
<p>4-14 全域共用變數</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//某個服務提供者</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span><span class="params">()</span></span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  view()-&gt;share(<span class="string">'posts'</span>, Post::recent());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="採用closure的view-composer"><a class="markdownIt-Anchor" href="#採用closure的view-composer"></a> 採用Closure的view composer</h3>
<p>4-15 建立使用closure的view composer</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">view()-&gt;composer(<span class="string">'partials.sidebar'</span>, <span class="function"><span class="keyword">function</span><span class="params">($view)</span></span>&#123;</span><br><span class="line">  $view-&gt;with(<span class="string">'posts'</span>, Post::recent());</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>與多個視圖共用的view composer</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">view()-&gt;composer(</span><br><span class="line">  [<span class="string">'partials.header'</span>,<span class="string">'partials.footer'</span>]</span><br><span class="line">  <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">    $view-&gt;with(<span class="string">'posts'</span>, Post::recent());</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  view()-&gt;composer(<span class="string">'partials,*'</span>,<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">    $view-&gt;with(<span class="string">'posts'</span>, Post::recent());</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<h4 id="使用類別的view-composer"><a class="markdownIt-Anchor" href="#使用類別的view-composer"></a> 使用類別的view composer</h4>
<p>4-16 view composer</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">ViewComposers</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Post</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Contracts</span>\<span class="title">View</span>\<span class="title">View</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RecentPostsComposer</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">  <span class="keyword">private</span> $posts;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">_construct</span><span class="params">(Post $posts)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;posts = $posts;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">compose</span><span class="params">(View $view)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    $view-&gt;with(<span class="string">'posts'</span>, <span class="keyword">$this</span>-&gt;posts-&gt;recent());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>4-17 在AppServiceProvider內註冊一個view composer</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AppServiceProvider</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  view()-&gt;composer(</span><br><span class="line">    <span class="string">'partials.sidebar'</span>, </span><br><span class="line">    \App\Http\ViewComposers\RecentPostsComposer::class</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="blade服務注入"><a class="markdownIt-Anchor" href="#blade服務注入"></a> Blade服務注入</h4>
<p>4-18 透過路由定義建構式來將服務注入視圖</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">'backend/sales'</span>,<span class="function"><span class="keyword">function</span><span class="params">(AnalyticsService $analytics)</span></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> view(<span class="string">'backend.sales-graphs'</span>)</span><br><span class="line">  -&gt;with(<span class="string">'analytics'</span>,analytics);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>4-19 在視圖中使用注入的導航服務</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"finances-display"</span>&gt;</span></span><br><span class="line">&#123;&#123; $analytics-&gt;getBalance() &#125;&#125; / &#123;&#123; $analytics-&gt;getBudget() &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>4-20 將服務直接注入視圖</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@inject('analytics', 'App\Services\Analytics')</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"finances-display"</span>&gt;</span></span><br><span class="line">&#123;&#123; $analytics-&gt;getBalance() &#125;&#125; / &#123;&#123; $analytics-&gt;getBudget() &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="自訂blade指令"><a class="markdownIt-Anchor" href="#自訂blade指令"></a> 自訂Blade指令</h4>
<p>4-21 綁定自訂的Blade指令</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// AppServiceProvider</span><br><span class="line">public function boot() </span><br><span class="line">&#123;</span><br><span class="line">  Blade::directive('ifGuest',function()&#123;</span><br><span class="line">    return "<span class="php"><span class="meta">&lt;?php</span> <span class="keyword">if</span>(auth()-&gt;guest()): <span class="meta">?&gt;</span></span>";</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4-22 建立有參數的Blade指令</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 綁定</span><br><span class="line">Blade::directive('newlinesToBr',function($expression)&#123;</span><br><span class="line">  return "<span class="php"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> nl2br(&#123;$expression&#125;)<span class="meta">?&gt;</span></span>"</span><br><span class="line">&#125;)</span><br><span class="line">// 使用</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>@newlinesToBr($message-&gt;body)<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>4-23 不使用自訂Blade指令的背景條件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">if</span> (app(<span class="string">'context'</span>)-&gt;isPublic())</span><br><span class="line">  &amp;copy; Copyright MyApp LLC</span><br><span class="line">@<span class="keyword">else</span></span><br><span class="line">  &amp;copy; Copyright&#123;&#123; app(<span class="string">'context'</span>)-&gt;client-&gt;name &#125;&#125;</span><br><span class="line">@<span class="keyword">endif</span></span><br></pre></td></tr></table></figure>
<p>4-24 使用自訂Blade指令的環境條件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//綁定</span></span><br><span class="line">Blade::directive(<span class="string">'ifPublic'</span>,<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">"&lt;?php if(app('context')-&gt;isPublic()): ?&gt;"</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//使用</span></span><br><span class="line">@ifPublic</span><br><span class="line">  &amp;copy; Copyright MyApp LLC</span><br><span class="line">@<span class="keyword">else</span></span><br><span class="line">  &amp;copy; Copyright &#123;&#123;app(<span class="string">'context'</span>)-&gt;client-&gt;name&#125;&#125;</span><br><span class="line">@<span class="keyword">elseif</span></span><br></pre></td></tr></table></figure>
<p>4-25 測試視圖可顯示某些內容</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//EventsTest.php</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_list_page_shows_all_events</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  $event1 = factory (Event::class)-&gt;create();</span><br><span class="line">  $event2 = factory (Event::class)-&gt;create();</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">$this</span>-&gt;visit(<span class="string">'events'</span>) </span><br><span class="line">    -&gt;see($event1-&gt;title)</span><br><span class="line">    -&gt;see($event2-&gt;title);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4-26 測試視圖已被傳入某些內容</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//EventsTest.php</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_list_page_shows_all_events</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  $event1 = factory (Event::class)-&gt;create();</span><br><span class="line">  $event2 = factory (Event::class)-&gt;create();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">$this</span>-&gt;vist(<span class="string">'events'</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">$this</span>-&gt;assertViewHas(<span class="string">'events'</span>,Event::all());</span><br><span class="line">  <span class="keyword">$this</span>-&gt;assertViewHasAll([</span><br><span class="line">    <span class="string">'events'</span> =&gt; Event::all(),</span><br><span class="line">    <span class="string">'title'</span> =&gt; <span class="string">'Events Page'</span></span><br><span class="line">  ]);</span><br><span class="line">  <span class="keyword">$this</span>-&gt;assertViewMissing(<span class="string">'dogs'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4-27 將closure 傳入assertViewHas()</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//EventsTest.php</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_list_page_shows_all_events</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  $event1 = factory(Event::class)-&gt;create();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">$this</span>-&gt;visit(<span class="string">'events/'</span>. $event1 -&gt; id);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">$this</span>-&gt;assertViewHas(<span class="string">'event'</span>,<span class="function"><span class="keyword">function</span><span class="params">($event)</span> <span class="title">use</span><span class="params">($event1)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $event-&gt;id === $event1-&gt;id;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        
    </section>
</article>


    <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            <a href="/2020/04/27/laravel-03/">laravel_03 路由與控制器</a>
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="http://vince115.github.io/index.html">
    
    <i class="icon-calendar"></i>
    
    <time datetime="2020-04-27T07:23:21.000Z" itemprop="datePublished">2020-04-27</time>
</a>

            
<div class="article-tag-list">
    <i class="icon-tag"></i>
    <a class="article-tag-link" href="/tags/backend/" rel="tag">backend</a>, <a class="article-tag-link" href="/tags/laravel/" rel="tag">laravel</a>
</div>


        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <h3 id="路由-closure"><a class="markdownIt-Anchor" href="#路由-closure"></a> 路由 closure</h3>
<p>任何人造訪/(網域的根目錄)時，Laravel的路由器都會執行這裡定義的closure，並回傳結果。</p>
<p>3-2 網站</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">'/'</span>,<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> view (<span class="string">'welcome'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Route::get(<span class="string">'about'</span>,<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> view (<span class="string">'about'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Route::get(<span class="string">'products'</span>,<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> view (<span class="string">'products'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Route::get(<span class="string">'services'</span>,<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> view (<span class="string">'services'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>選用的路由參數</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">'/'</span>,<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> view (<span class="string">'services'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="什麼是closure"><a class="markdownIt-Anchor" href="#什麼是closure"></a> 什麼是closure?</h4>
<p>PHP版的匿名函式，可當物件四處傳遞、指派給變數、當成參數傳給其他函式與方法</p>
<h3 id="視圖"><a class="markdownIt-Anchor" href="#視圖"></a> 視圖</h3>
<p>3-18 傳遞變數給視圖</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">'tasks'</span>,<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> view(<span class="string">'tasks.index'</span>)</span><br><span class="line">        -&gt;(<span class="string">'tasks'</span>,Task::all());</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="使用視圖組件來讓所有試圖共用變數"><a class="markdownIt-Anchor" href="#使用視圖組件來讓所有試圖共用變數"></a> 使用視圖組件來讓所有試圖共用變數</h3>
<p>你可以讓每一個板模或只有一些板模共用某些變數，如下<br />
view()-&gt;share(‘variableName’,‘variableValue’);</p>
<h3 id="控制器"><a class="markdownIt-Anchor" href="#控制器"></a> 控制器</h3>
<p>C(create)、R(read)、U(update)、D(delete)</p>
<p>我們建立一個控制器，其中一種簡單的方式是使用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan make:controller TaskController</span><br></pre></td></tr></table></figure>
<p>3-19 生成的控制器的預設內容</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Requests</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TaskController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3-20 簡單的控制器範例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>\<span class="title">Controller</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TaskController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">home</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'Hello, World!'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3-21 簡單的控制器路由</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//routes/web.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> Route::get(<span class="string">'/'</span>,<span class="string">'TasksController@home'</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>3-22 常見的控制器方法案例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//TasksController.php</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> view(<span class="string">'tasks.index'</span>)</span><br><span class="line">    -&gt;with(<span class="string">'tasks'</span>,Task::all());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> Route::get(<span class="string">'tasks/create'</span>,<span class="string">'TasksController@create'</span>);</span><br><span class="line"> Route::post(<span class="string">'tasks'</span>,<span class="string">'TasksController@store'</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="取得用戶輸入"><a class="markdownIt-Anchor" href="#取得用戶輸入"></a> 取得用戶輸入</h3>
<p>3-23 綁定基本的表單動作</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//routes/web.php</span></span><br><span class="line"> Route::get(<span class="string">'tasks/create'</span>,<span class="string">'TasksController@create'</span>);</span><br><span class="line"> Route::post(<span class="string">'tasks'</span>,<span class="string">'TasksController@store'</span>);</span><br></pre></td></tr></table></figure>
<p>3-24 常用的表單輸入控制方法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//TasksController.php</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">store</span><span class="params">()</span></span>&#123;</span><br><span class="line">    $tasks = <span class="keyword">new</span> Task;</span><br><span class="line">    $tasks-&gt;title =Input::get(<span class="string">'title'</span>);</span><br><span class="line">    $tasks-&gt;description = Input::get(<span class="string">'description'</span>);</span><br><span class="line">    $tasks-&gt;save();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">'tasks'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">facades</span>\<span class="title">Input</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TasksController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">store</span><span class="params">()</span></span>&#123;</span><br><span class="line">        $tasks = <span class="keyword">new</span> Task;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="將相依關係注入控制器"><a class="markdownIt-Anchor" href="#將相依關係注入控制器"></a> 將相依關係注入控制器</h3>
<p>3-25 藉由型態提示來做控制器方法注入</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//TasksController.php</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">store</span><span class="params">(\Illuminate\Http\Request $request\)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $task = <span class="keyword">new</span> Task;</span><br><span class="line">    $task-&gt;title = $request-&gt;input(<span class="string">'title'</span>);</span><br><span class="line">    $task-&gt;description = $request-&gt;input(<span class="string">'description'</span>);</span><br><span class="line">    $task-&gt;save();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">'task'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="資源控制器"><a class="markdownIt-Anchor" href="#資源控制器"></a> 資源控制器</h3>
<h3 id="laravel-資源控制器的方法"><a class="markdownIt-Anchor" href="#laravel-資源控制器的方法"></a> Laravel 資源控制器的方法</h3>
<p>Laravel 資源控制器方法</p>
<table>
<thead>
<tr>
<th>動詞</th>
<th>URL</th>
<th>控制器方法</th>
<th>名稱</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>tasks</td>
<td>index()</td>
<td>tasks.index</td>
<td>顯示所有工作</td>
</tr>
<tr>
<td>GET</td>
<td>tasks/create</td>
<td>create()</td>
<td>tasks.create</td>
<td>顯示建立工作表單</td>
</tr>
<tr>
<td>POST</td>
<td>tasks</td>
<td>store()</td>
<td>tasks.store</td>
<td>從建立工作表單接受表單提交</td>
</tr>
<tr>
<td>GET</td>
<td>tasks/{task}</td>
<td>show()</td>
<td>tasks.show</td>
<td>顯示一個工作</td>
</tr>
<tr>
<td>GET</td>
<td>tasks/{task}/edit</td>
<td>edit()</td>
<td>tasks.edit</td>
<td>編輯一個工作</td>
</tr>
<tr>
<td>PUT/PATCH</td>
<td>tasks/{task}</td>
<td>update()</td>
<td>tasks.update</td>
<td>從編輯工作表單接收表單提交</td>
</tr>
<tr>
<td>DELETE</td>
<td>tasks/{task}</td>
<td>destory()</td>
<td>tasks.destory</td>
<td>刪除一個工作</td>
</tr>
</tbody>
</table>
<h3 id="laravel-綁定資源控制器"><a class="markdownIt-Anchor" href="#laravel-綁定資源控制器"></a> Laravel 綁定資源控制器</h3>
<p>3-26 資源控制器綁定</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;routes&#x2F;web.php</span><br><span class="line">Route::resource(&#39;tasks&#39;,&#39;TasksController&#39;);</span><br></pre></td></tr></table></figure>
<h3 id="路由模型綁定"><a class="markdownIt-Anchor" href="#路由模型綁定"></a> 路由模型綁定</h3>
<p>3-27 為每一個路由取得資源</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">'conference/&#123;id&#125;'</span>,<span class="function"><span class="keyword">function</span><span class="params">($id)</span>)</span>&#123;</span><br><span class="line">    $conference = Conference::findOrFail($id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="隱式路由模型綁定"><a class="markdownIt-Anchor" href="#隱式路由模型綁定"></a> 隱式路由模型綁定</h3>
<p>3-28 使用隱式路由模型綁定</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">'conference/&#123;conference&#125;'</span>),<span class="function"><span class="keyword">function</span><span class="params">(Conference $conference)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> view(<span class="string">'conferences.show'</span>)-&gt;with(<span class="string">'conference'</span>,$conference);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="隱式路由模型綁定-2"><a class="markdownIt-Anchor" href="#隱式路由模型綁定-2"></a> 隱式路由模型綁定</h3>
<p>3-29 自訂路由模型綁定</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">Route</span>::<span class="title">get</span><span class="params">(<span class="string">'conference/&#123;conference&#125;'</span>)</span>,<span class="title">function</span><span class="params">(Conference $conference)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> view(<span class="string">'conferences.show'</span>)-&gt;with(<span class="string">'conference'</span>,$conference);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3-30 使用顯式路由模型綁定</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">'events/&#123;event&#125;'</span>),<span class="function"><span class="keyword">function</span><span class="params">(Conference $event)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> view(<span class="string">'events.show'</span>)-&gt;with(<span class="string">'event'</span>,$event);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="路由快取"><a class="markdownIt-Anchor" href="#路由快取"></a> 路由快取</h3>
<p>不使用任何路由closure，可以執行檔案序列化</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan route:cache</span><br></pre></td></tr></table></figure>
<p>刪除快取</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan route:clear</span><br></pre></td></tr></table></figure>
<h3 id="表單方法欺騙"><a class="markdownIt-Anchor" href="#表單方法欺騙"></a> 表單方法欺騙</h3>
<h4 id="http動詞簡介"><a class="markdownIt-Anchor" href="#http動詞簡介"></a> HTTP動詞簡介</h4>
<h4 id="laravel的http動詞"><a class="markdownIt-Anchor" href="#laravel的http動詞"></a> Laravel的HTTP動詞</h4>
<h4 id="在html表單內的http方法欺騙"><a class="markdownIt-Anchor" href="#在html表單內的http方法欺騙"></a> 在HTML表單內的HTTP方法欺騙</h4>
<p>3-31 表單方法欺騙</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=<span class="string">"/tasks/5"</span> method=<span class="string">"POST"</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">"hidden"</span> name=<span class="string">"_method"</span> value=<span class="string">"DELETE"</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>
<h3 id="csrf保護"><a class="markdownIt-Anchor" href="#csrf保護"></a> CSRF保護</h3>
<p>3-32 CSRF權杖</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=<span class="string">"/tasks/5"</span> method=<span class="string">"POST"</span>&gt;</span><br><span class="line">    <span class="meta">&lt;?php</span> <span class="keyword">echo</span> csrf_field(); <span class="meta">?&gt;</span></span><br><span class="line">    &lt;!-- <span class="keyword">or</span>: --&gt;</span><br><span class="line">    &lt;input type=<span class="string">"hidden"</span> name=<span class="string">"_token"</span> value=<span class="string">"&lt;?php echo csrf_token(); ?&gt;"</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>
<p>對於JavaScript框架的網站，最常見的解決方案就是在每一個網頁的<meta>標籤中儲存權杖。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta name=<span class="string">"csrf-token"</span> content=<span class="string">"&lt;?php echo csrf_token(); ?&gt;"</span> id=<span class="string">"token"</span>&gt;</span><br></pre></td></tr></table></figure>
<p>3-33 全域綁定標頭以預防CSRF</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//於jQuery</span></span><br><span class="line">$.ajaxSetup(&#123;</span><br><span class="line">    headers:&#123;</span><br><span class="line">        <span class="string">'X-CSRF-Token'</span>:$(<span class="string">'meta[name="csrf-token"]'</span>).a</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//於Vue</span></span><br><span class="line">Vue.http.interceptors.push((request,next))=&gt;&#123;</span><br><span class="line">    request.headers[<span class="string">'X-CSRF-TOKEN'</span>] = document.querySeletor()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3-34 各種轉址回傳方式</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用全域輔助函式來產生轉址回應</span></span><br><span class="line">Route::get(<span class="string">'redirect-with-helper'</span>,<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> redirect()-&gt;to(<span class="string">'login'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//使用全域輔助函式捷徑</span></span><br><span class="line">Route::get(<span class="string">'redirect-with-helper-shortcut'</span>,<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">'login'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//使用靜態介面來產生轉址回應</span></span><br><span class="line">Route::get(<span class="string">'redirect-with-facade'</span>,<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> redirect::to(<span class="string">'login'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>3-35 redirect()-&gt;to()</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">'redirect'</span>,<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> redirect()-&gt;to(<span class="string">'home'</span>);</span><br><span class="line">    <span class="comment">//或者使用捷徑</span></span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">'home'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>3-36 redirect()-&gt;route()</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">'redirect'</span>,<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> redirect()-&gt;route(<span class="string">'conferences.index'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//route() 有一個選用的第二參數供路由參數使用。</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">route</span><span class="params">($to = null, $parameters = [], $status = <span class="number">302</span>, $headers = [])</span></span></span><br></pre></td></tr></table></figure>
<p>3-37 帶參數的redict()-&gt;route()</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">'redirect'</span>,<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> redirect()-&gt;route(<span class="string">'conferences.show'</span>,[<span class="string">'conference'</span> =&gt; <span class="number">99</span>]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>redict()-&gt;back()</p>
<h4 id="其他轉址方法"><a class="markdownIt-Anchor" href="#其他轉址方法"></a> 其他轉址方法</h4>
<ul>
<li>home()</li>
<li>refresh()</li>
<li>away()</li>
<li>secure()</li>
<li>action()</li>
<li>guest()</li>
<li>intended()</li>
</ul>
<p>3-38 連同資料一起轉址</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">'redirect-with-key-value'</span>,<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">'dashboard'</span>)</span><br><span class="line">    -&gt;route(<span class="string">'error'</span>,<span class="keyword">true</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Route::get(<span class="string">'redirect-with-array'</span>,<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">'dashboard'</span>)</span><br><span class="line">    -&gt;with(<span class="string">'error'</span>=&gt; <span class="keyword">true</span>,<span class="string">'message'</span>=&gt;<span class="string">'Woops!'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>3-39 連同表單輸入一起轉址</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">'form'</span>,<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> view(<span class="string">'form'</span>);    </span><br><span class="line">&#125;);</span><br><span class="line">Route::get(<span class="string">'form'</span>,<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">'form'</span>)</span><br><span class="line">    -&gt;withInput()</span><br><span class="line">    -&gt;with(<span class="string">'error'</span>=&gt; <span class="keyword">true</span>,<span class="string">'message'</span>=&gt;<span class="string">'Woops!'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>連同 withInput() 一起傳遞輸入，使用old()輔助函式，取得關鍵值old(‘username’)，第二參數是無舊值的預設值。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input name=<span class="string">"username"</span> value=<span class="string">"&lt;?=old('username','Default username instructions here'); "</span>&gt;</span><br></pre></td></tr></table></figure>
<p>3-40 連同錯誤一起轉址</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Route::post(<span class="string">'form'</span>,<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">    $validator = Validator::make($request-&gt;all()),<span class="keyword">$this</span>-&gt;validationRules);</span><br><span class="line">    <span class="keyword">if</span> ($validator-&gt;fails())&#123;</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">'form'</span>)</span><br><span class="line">        -&gt;withErrors($validator)</span><br><span class="line">        -&gt;withInput();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="中止請求"><a class="markdownIt-Anchor" href="#中止請求"></a> 中止請求</h4>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Route::post(<span class="string">'something-you-cant-do'</span>),<span class="function"><span class="keyword">function</span><span class="params">(Illuminate\Http\Request)</span></span>&#123;</span><br><span class="line">    abort(<span class="number">403</span>,<span class="string">'You cannot do that!'</span>);</span><br><span class="line">    abort_unless($request-&gt;has(<span class="string">'magicToken'</span>),<span class="number">403</span>);</span><br><span class="line">    abort_if($request-&gt;user()-&gt;isBanned,<span class="number">403</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="自訂回應"><a class="markdownIt-Anchor" href="#自訂回應"></a> 自訂回應</h4>
<ul>
<li>
<p>response()-&gt;make()<br />
資料傳入，第二參數Http狀態碼，第三標頭</p>
</li>
<li>
<p>response()-&gt;json() 與 -&gt;jsonp()<br />
可以對json()方法，傳遞可編碼為JSON的內容</p>
</li>
<li>
<p>response()-&gt;download() 與 -&gt;file()<br />
傳遞一個SplFileInfo實例或字串檔名給download()，視情況傳入第二個選用的檔名參數。<br />
ex. return response()-&gt;download(‘file501751.pdf’,‘myFile.pdf’)。<br />
在瀏覽器顯示同一檔案response()-&gt;file();</p>
</li>
</ul>
<h3 id="測試"><a class="markdownIt-Anchor" href="#測試"></a> 測試</h3>
<p>3-42 編寫一個簡單的POST路由測試</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//AssignmentTest.php</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_post_creates_new_assignment</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">$this</span>-&gt;post(<span class="string">'/assignments'</span>,[</span><br><span class="line">       <span class="string">'title'</span> =&gt; <span class="string">'My great assignment'</span></span><br><span class="line">   ]);</span><br><span class="line">   <span class="keyword">$this</span>-&gt;seeInDatabase(<span class="string">'assignments'</span>,[</span><br><span class="line">       <span class="string">'title'</span> =&gt; <span class="string">'My great assignment'</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3-43 編寫一個簡單的GET路由測試</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//AssignmentTest.php</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test_list_page_shows_all_assignments</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   $assignment = Assignment::create([</span><br><span class="line">       <span class="string">'title'</span> =&gt; <span class="string">'My great assignment'</span></span><br><span class="line">   ]);</span><br><span class="line">   <span class="keyword">$this</span> -&gt; visit(<span class="string">'assignments'</span>)</span><br><span class="line">       -&gt; dee([<span class="string">'My great assignment'</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

        
    </section>
</article>


    <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            <a href="/2020/04/23/php/">PHP基礎</a>
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="http://vince115.github.io/index.html">
    
    <i class="icon-calendar"></i>
    
    <time datetime="2020-04-23T09:19:00.000Z" itemprop="datePublished">2020-04-23</time>
</a>

            

        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <h2 id="php基礎"><a class="markdownIt-Anchor" href="#php基礎"></a> PHP基礎</h2>
<p>PHP的全稱為” PHP：Hypertext Preprocessor”(PHP：超文字預處理器)。</p>
<h2 id="建立php開發環境"><a class="markdownIt-Anchor" href="#建立php開發環境"></a> 建立PHP開發環境</h2>
<ol>
<li>
<p>XAMPP</p>
</li>
<li>
<p><a href="https://www.mamp.info/" target="_blank" rel="noopener">MAMP</a></p>
</li>
<li>
<p>LAMP<br />
LAMP主打使用在Linux<br />
<a href="https://magiclen.org/lamp/" target="_blank" rel="noopener">安裝 LAMP Server + phpMyAdmin 在 Linux 系統上輕鬆架設網站</a></p>
</li>
</ol>
        
        <p class="article-more-link">
            <a href="/2020/04/23/php/#more">
                <span class="vm">閱讀更多</span>
                <i class="icon-arrow-double-right vm"></i>    
            </a>
        </p>
        
        
    </section>
</article>


    <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            <a href="/2020/04/21/aspnet/">Asp.Net</a>
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="http://vince115.github.io/index.html">
    
    <i class="icon-calendar"></i>
    
    <time datetime="2020-04-21T01:45:49.000Z" itemprop="datePublished">2020-04-21</time>
</a>

            

        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <h3 id="aspnet"><a class="markdownIt-Anchor" href="#aspnet"></a> <a href="http://ASP.NET" target="_blank" rel="noopener">ASP.NET</a> 支持三種開發模式：</h3>
<table>
<thead>
<tr>
<th>Web Pages</th>
<th>MVC</th>
<th>Web Forms</th>
</tr>
</thead>
<tbody>
<tr>
<td>單頁面模型</td>
<td>模型視圖控制器</td>
<td>事件驅動模型</td>
</tr>
</tbody>
</table>
<p>Web Pages <a href="http://xn--ASP-eh5em86e39ap08do5j.NET" target="_blank" rel="noopener">是最簡單的ASP.NET</a> 網頁開發編程模型。它提供了一種簡單的方法將HTML、CSS、JavaScript 以及服務器代碼結合起來：</p>
<blockquote>
<p>易於學習、閱讀和使用<br />
圍繞單一網頁進行構建<br />
類似PHP 和ASP<br />
服務器腳本使用Visual Basic 或C#<br />
對HTML、CSS、JavaScript 的完全控制</p>
</blockquote>
<h3 id="web-pages-教程"><a class="markdownIt-Anchor" href="#web-pages-教程"></a> Web Pages 教程</h3>
<p>初始化 WebSecurity 資料庫<br />
在web 更目錄中，創建或編輯_AppStart.cshtml 頁面。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@&#123;</span><br><span class="line">WebSecurity.InitializeDatabaseConnection(&quot;Users&quot;, &quot;UserProfile&quot;, &quot;UserId&quot;, &quot;Email&quot;, </span><br><span class="line">true);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>網站每次啟動時都會運行以上代碼。它會對WebSecurity 資料庫進行初始化。</p>
<blockquote>
<ul>
<li>“Users” 是WebSecurity 資料庫的名稱。(Users.sdf)</li>
<li>“UserProfile” 是包含用戶配置信息的資料庫表的名稱。</li>
<li>“UserId” 包含用戶ID 的列的名稱（主鍵）。</li>
<li>“Email” 是包含用戶的列的名稱。</li>
<li>最後一個參數true 是一個邏輯值，指示應創建用戶配置文件表和成員資格表（如果它們不存在），否則false。</li>
</ul>
</blockquote>
<h4 id="websecurity-資料庫"><a class="markdownIt-Anchor" href="#websecurity-資料庫"></a> WebSecurity 資料庫</h4>
<p>UserProfile 表中的每條記錄代表一個用戶，其中包括用戶ID （主鍵）和用戶名稱（email）：</p>
<table>
<thead>
<tr>
<th>UserId</th>
<th>Email</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td><a href="mailto:john@johnson.net">john@johnson.net</a></td>
</tr>
<tr>
<td>2</td>
<td><a href="mailto:peter@peterson.com">peter@peterson.com</a></td>
</tr>
<tr>
<td>3</td>
<td><a href="mailto:lars@larson.edu">lars@larson.edu</a></td>
</tr>
</tbody>
</table>
<p>Membership 表包含會員信息，比如用戶是什麼時候創建的，該會員是否已認證，會員是什麼時候認證的，等等。<br />
具體如下所示（一些列不顯示）：</p>
<table>
<thead>
<tr>
<th>UserId</th>
<th>CreateDate</th>
<th>Confirmation Token</th>
<th>Is Confirmed</th>
<th>LastPassword Failure</th>
<th>Password</th>
<th>Password Change</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>12.04.2012 16:12:17</td>
<td>NULL</td>
<td>True</td>
<td>NULL</td>
<td>AFNQhWfy…</td>
<td>12.04.2012 16:12:17</td>
</tr>
</tbody>
</table>
<h4 id="簡單的成員資格配置"><a class="markdownIt-Anchor" href="#簡單的成員資格配置"></a> 簡單的成員資格配置</h4>
<p>在您使用 WebSecurity 對象時，如果您的站點沒有配置使用 <a href="http://ASP.NET" target="_blank" rel="noopener">ASP.NET</a> Web Pages 會員系統 SimpleMembership，可能會報錯。</p>
<p>如果託管服務提供商的伺服器的配置與您本地伺服器的配置不同，也可能會報錯。為了解決這個問題，請在網站的 Web.config 文件中添加以下元素：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;appSettings&gt;</span><br><span class="line">&lt;add key&#x3D;&quot;enableSimpleMembership&quot; value&#x3D;&quot;true&quot; &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;appSettings&gt;</span><br></pre></td></tr></table></figure>
<h3 id="mvc-教程"><a class="markdownIt-Anchor" href="#mvc-教程"></a> MVC 教程</h3>
<p>MVC 是通過使用MVC (Model View Controller) 設計來構建web 應用程序的一種模型。<br />
<a href="http://xn--ASP-ob1es61bvvd1pkgrkmheqt2c44ov97ajx0b.NET" target="_blank" rel="noopener">如果您需要相對於傳統ASP.NET</a> 更輕的替代方案，MVC 是很好的選擇。</p>
<p>MVC 是用於構建web 應用程序的一種框架，使用MVC (Model View Controller) 設計：</p>
<ul>
<li>Model（模型）表示應用程序核心（比如資料庫記錄列表）</li>
<li>View（視圖）對數據（資料庫記錄）進行顯示</li>
<li>Controller（控制器）處理輸入（寫入資料庫記錄）</li>
</ul>
<p>MVC 模型通過三個邏輯層來定義web 應用程序：</p>
<ul>
<li>business layer（業務層、模型邏輯）</li>
<li>display layer（顯示層、視圖邏輯）</li>
<li>input control（輸入控件、控制器邏輯）</li>
</ul>
<h4 id="模型model"><a class="markdownIt-Anchor" href="#模型model"></a> 模型（Model）</h4>
<p>模型（Model）是應用程序中用於處理應用程序數據邏輯的部分。</p>
<p>通常模型對像在數據庫中存取數據。</p>
<h4 id="view視圖"><a class="markdownIt-Anchor" href="#view視圖"></a> View（視圖）</h4>
<p>View（視圖）是應用程序中處理數據顯示的部分。</p>
<p>通常從模型數據中創建視圖。</p>
<h4 id="控制器"><a class="markdownIt-Anchor" href="#控制器"></a> 控制器</h4>
<p>控制器是應用程序中處理用戶交互的部分。</p>
<p>通常控制器從視圖讀取數據、控制用戶輸入，並向模型發送數據數據。</p>
<h3 id="web-forms-教程"><a class="markdownIt-Anchor" href="#web-forms-教程"></a> Web Forms 教程</h3>
<p>Web Forms <a href="http://xn--ASP-ob1e559g1quuyk.NET" target="_blank" rel="noopener">是傳統的ASP.NET</a> 模型，基於事件驅動的Web Forms 和post backs。<br />
在過去的數年中，<a href="http://xn--ASP-hb0eo47dx05a66b5sw6kfiy6d.NET" target="_blank" rel="noopener">開發者已經使用ASP.NET</a> Web Forms 創建了全球多個大型網站。</p>
<style type='text/css'>
.markdown-body table th { background-color:#3366BB;color:#ffffff;border-color:#225588; }
</style>
        
    </section>
</article>




<nav class="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">Next »</a>
</nav>



            </div>
        </div>
        <footer class="footer">
    Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, Theme by <a href="https://github.com/sanonz/hexo-theme-concise" target="_blank">Concise</a>

    
</footer>

    </main>

    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/1.9.0/jquery.min.js"></script>
    <script type="text/javascript">
    $(function() {
        var nodes = {
            nav: $('#nav'),
            aside: $('#aside'),
            asideInner: $('#aside-inner'),
            navInner: $('#nav-inner')
        };

        var doing = false;
        nodes.asideInner.on('webkitAnimationEnd mozAnimationEnd oAnimationEnd oanimationend animationend', function() {
            if (nodes.aside.hasClass('mobile-open')) {
                nodes.aside.removeClass('mobile-open');
            } else {
                nodes.aside.removeClass('mobile-close panel-show');
            }
            doing = false;
        });
        $('#open-panel, #aside-mask').on('click', function() {
            if (doing) {
                return;
            }

            if (nodes.aside.hasClass('panel-show')) {
                nodes.aside.addClass('mobile-close');
            } else {
                nodes.aside.addClass('mobile-open panel-show');
            }
        });
        $('#open-menus').on('click', function() {
            nodes.navInner.slideToggle();
        });

        if (window.innerWidth <= 960) {
            setTimeout(function() {
                nodes.navInner.slideUp();
            }, 3000);
        }
    });
    </script>
    

</body>
</html>
